-- Variables 
    local uis = game:GetService("UserInputService") 
    local players = game:GetService("Players") 
    local ws = game:GetService("Workspace")
    local rs = game:GetService("ReplicatedStorage")
    local http_service = game:GetService("HttpService")
    local gui_service = game:GetService("GuiService")
    local lighting = game:GetService("Lighting")
    local run = game:GetService("RunService")
    local stats = game:GetService("Stats")
    local coregui = game:GetService("CoreGui")
    local debris = game:GetService("Debris")
    local tween_service = game:GetService("TweenService")
    local sound_service = game:GetService("SoundService")

    local vec2 = Vector2.new
    local vec3 = Vector3.new
    local dim2 = UDim2.new
    local dim = UDim.new 
    local rect = Rect.new
    local cfr = CFrame.new
    local empty_cfr = cfr()
    local point_object_space = empty_cfr.PointToObjectSpace
    local angle = CFrame.Angles
    local dim_offset = UDim2.fromOffset

    local color = Color3.new
    local rgb = Color3.fromRGB
    local hex = Color3.fromHex
    local hsv = Color3.fromHSV
    local rgbseq = ColorSequence.new
    local rgbkey = ColorSequenceKeypoint.new
    local numseq = NumberSequence.new
    local numkey = NumberSequenceKeypoint.new

    local camera = ws.CurrentCamera
    local lp = players.LocalPlayer 
    local mouse = lp:GetMouse() 
    local gui_offset = gui_service:GetGuiInset().Y

    local max = math.max 
    local floor = math.floor 
    local min = math.min 
    local abs = math.abs 
    local noise = math.noise
    local rad = math.rad 
    local random = math.random 
    local pow = math.pow 
    local sin = math.sin 
    local pi = math.pi 
    local tan = math.tan 
    local atan2 = math.atan2 
    local clamp = math.clamp 

    local insert = table.insert 
    local find = table.find 
    local remove = table.remove
    local concat = table.concat
-- 

-- Library init
    getgenv().library = {
        directory = "vaderhaxx",
        folders = {
            "/fonts",
            "/configs",
            "/themes",
        },
        flags = {},
        config_flags = {},
        options = {},

        connections = {},   
        notifications = {},
        playerlist_data = {
            players = {},
            player = {}, 
        },
        colorpicker_open = false,
        gui = nil,
        watermark_gui = nil,
        keybind_gui = nil,
        
        config = {
            selected = nil,
            autoload = nil,
            list = {},
        },
        
        current_theme = "default",
    }

    -- THEME PRESETS - Dark black with purple accent
    local theme_presets = {
        default = {
            accent = rgb(147, 112, 219),
            text = rgb(255, 255, 255),
            text_outline = rgb(0, 0, 0),
            a = rgb(8, 8, 8),
            b = rgb(18, 18, 18),
            c = rgb(14, 14, 14),
            d = rgb(6, 6, 6),
            e = rgb(10, 10, 10),
            f = rgb(35, 35, 35),
            g = rgb(25, 25, 25),
        },
        fatality = {
            accent = rgb(255, 85, 85),
            text = rgb(255, 255, 255),
            text_outline = rgb(0, 0, 0),
            a = rgb(5, 5, 5),
            b = rgb(15, 15, 15),
            c = rgb(12, 12, 12),
            d = rgb(4, 4, 4),
            e = rgb(8, 8, 8),
            f = rgb(30, 30, 30),
            g = rgb(20, 20, 20),
        },
        bbot = {
            accent = rgb(0, 170, 255),
            text = rgb(255, 255, 255),
            text_outline = rgb(0, 0, 0),
            a = rgb(10, 10, 10),
            b = rgb(20, 20, 20),
            c = rgb(15, 15, 15),
            d = rgb(5, 5, 5),
            e = rgb(12, 12, 12),
            f = rgb(35, 35, 35),
            g = rgb(25, 25, 25),
        },
        purple = {
            accent = rgb(138, 43, 226),
            text = rgb(255, 255, 255),
            text_outline = rgb(0, 0, 0),
            a = rgb(5, 5, 10),
            b = rgb(15, 15, 20),
            c = rgb(10, 10, 15),
            d = rgb(3, 3, 8),
            e = rgb(8, 8, 12),
            f = rgb(30, 30, 40),
            g = rgb(20, 20, 30),
        },
        midnight = {
            accent = rgb(180, 120, 255),
            text = rgb(255, 255, 255),
            text_outline = rgb(0, 0, 0),
            a = rgb(2, 2, 5),
            b = rgb(12, 12, 18),
            c = rgb(8, 8, 14),
            d = rgb(1, 1, 3),
            e = rgb(5, 5, 10),
            f = rgb(25, 25, 35),
            g = rgb(18, 18, 25),
        },
        rose = {
            accent = rgb(255, 105, 180),
            text = rgb(255, 255, 255),
            text_outline = rgb(0, 0, 0),
            a = rgb(8, 5, 8),
            b = rgb(18, 12, 18),
            c = rgb(14, 10, 14),
            d = rgb(6, 3, 6),
            e = rgb(10, 6, 10),
            f = rgb(35, 25, 35),
            g = rgb(25, 18, 25),
        },
    }

    local themes = {
        preset = {},
        utility = {
            accent = {BackgroundColor3 = {}, Color = {}, ScrollBarImageColor3 = {}, TextColor3 = {}},
            text = {TextColor3 = {}, BackgroundColor3 = {}},
            text_outline = {Color = {}},
            a = {BackgroundColor3 = {}, Color = {}},
            b = {BackgroundColor3 = {}, Color = {}},
            c = {BackgroundColor3 = {}, Color = {}},
            d = {BackgroundColor3 = {}, Color = {}},
            e = {BackgroundColor3 = {}, Color = {}},
            f = {BackgroundColor3 = {}, Color = {}},
            g = {BackgroundColor3 = {}, Color = {}},
        }
    }

    -- Initialize with default theme
    for key, value in pairs(theme_presets.default) do
        themes.preset[key] = value
    end

    local keys = {
        [Enum.KeyCode.LeftShift] = "LS",
        [Enum.KeyCode.RightShift] = "RS",
        [Enum.KeyCode.LeftControl] = "LC",
        [Enum.KeyCode.RightControl] = "RC",
        [Enum.KeyCode.Insert] = "INS",
        [Enum.KeyCode.Backspace] = "BS",
        [Enum.KeyCode.Return] = "Ent",
        [Enum.KeyCode.LeftAlt] = "LA",
        [Enum.KeyCode.RightAlt] = "RA",
        [Enum.KeyCode.CapsLock] = "CAPS",
        [Enum.KeyCode.One] = "1",
        [Enum.KeyCode.Two] = "2",
        [Enum.KeyCode.Three] = "3",
        [Enum.KeyCode.Four] = "4",
        [Enum.KeyCode.Five] = "5",
        [Enum.KeyCode.Six] = "6",
        [Enum.KeyCode.Seven] = "7",
        [Enum.KeyCode.Eight] = "8",
        [Enum.KeyCode.Nine] = "9",
        [Enum.KeyCode.Zero] = "0",
        [Enum.KeyCode.KeypadOne] = "Num1",
        [Enum.KeyCode.KeypadTwo] = "Num2",
        [Enum.KeyCode.KeypadThree] = "Num3",
        [Enum.KeyCode.KeypadFour] = "Num4",
        [Enum.KeyCode.KeypadFive] = "Num5",
        [Enum.KeyCode.KeypadSix] = "Num6",
        [Enum.KeyCode.KeypadSeven] = "Num7",
        [Enum.KeyCode.KeypadEight] = "Num8",
        [Enum.KeyCode.KeypadNine] = "Num9",
        [Enum.KeyCode.KeypadZero] = "Num0",
        [Enum.KeyCode.Minus] = "-",
        [Enum.KeyCode.Equals] = "=",
        [Enum.KeyCode.Tilde] = "~",
        [Enum.KeyCode.LeftBracket] = "[",
        [Enum.KeyCode.RightBracket] = "]",
        [Enum.KeyCode.RightParenthesis] = ")",
        [Enum.KeyCode.LeftParenthesis] = "(",
        [Enum.KeyCode.Semicolon] = ",",
        [Enum.KeyCode.Quote] = "'",
        [Enum.KeyCode.BackSlash] = "\\",
        [Enum.KeyCode.Comma] = ",",
        [Enum.KeyCode.Period] = ".",
        [Enum.KeyCode.Slash] = "/",
        [Enum.KeyCode.Asterisk] = "*",
        [Enum.KeyCode.Plus] = "+",
        [Enum.KeyCode.Backquote] = "`",
        [Enum.UserInputType.MouseButton1] = "MB1",
        [Enum.UserInputType.MouseButton2] = "MB2",
        [Enum.UserInputType.MouseButton3] = "MB3",
        [Enum.KeyCode.Escape] = "ESC",
        [Enum.KeyCode.Space] = "SPC",
    }
        
    library.__index = library

    -- Create base folders
    pcall(function()
        if not isfolder(library.directory) then
            makefolder(library.directory)
        end
        for _, path in next, library.folders do 
            if not isfolder(library.directory .. path) then
                makefolder(library.directory .. path)
            end
        end
        local gameFolder = library.directory .. "/configs/" .. tostring(game.PlaceId)
        if not isfolder(gameFolder) then
            makefolder(gameFolder)
        end
    end)

    local flags = library.flags 
    local config_flags = library.config_flags

    -- Font importing system 
    pcall(function()
        if not isfile(library.directory .. "/fonts/main.ttf") then 
            writefile(library.directory .. "/fonts/main.ttf", game:HttpGet("https://github.com/i77lhm/storage/raw/refs/heads/main/fonts/ProggyClean.ttf"))
        end
        
        local proggy_clean = {
            name = "ProggyClean",
            faces = {
                {
                    name = "Regular",
                    weight = 400,
                    style = "normal",
                    assetId = getcustomasset(library.directory .. "/fonts/main.ttf")
                }
            }
        }
        
        if not isfile(library.directory .. "/fonts/main_encoded.ttf") then 
            writefile(library.directory .. "/fonts/main_encoded.ttf", http_service:JSONEncode(proggy_clean))
        end 
        
        library.font = Font.new(getcustomasset(library.directory .. "/fonts/main_encoded.ttf"), Enum.FontWeight.Regular)
    end)
    
    if not library.font then
        library.font = Font.fromEnum(Enum.Font.Code)
    end
-- 

-- Library functions
    function library:tween(obj, properties) 
        local tween = tween_service:Create(obj, TweenInfo.new(0.25, Enum.EasingStyle.Quad, Enum.EasingDirection.InOut, 0, false, 0), properties):Play()
        return tween
    end 

    function library:close_current_element(cfg) 
        local path = library.current_element_open
        if path then
            path.set_visible(false)
            path.open = false 
        end
    end 

    function library:resizify(frame) 
        local Frame = Instance.new("TextButton")
        Frame.Position = dim2(1, -10, 1, -10)
        Frame.BorderColor3 = rgb(0, 0, 0)
        Frame.Size = dim2(0, 10, 0, 10)
        Frame.BorderSizePixel = 0
        Frame.BackgroundColor3 = rgb(255, 255, 255)
        Frame.Parent = frame
        Frame.BackgroundTransparency = 1 
        Frame.Text = ""

        local resizing = false 
        local start_size 
        local start 
        local og_size = frame.Size  

        Frame.InputBegan:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 then
                resizing = true
                start = input.Position
                start_size = frame.Size
            end
        end)

        Frame.InputEnded:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 then
                resizing = false
            end
        end)

        library:connection(uis.InputChanged, function(input, game_event) 
            if resizing and input.UserInputType == Enum.UserInputType.MouseMovement then
                local viewport_x = camera.ViewportSize.X
                local viewport_y = camera.ViewportSize.Y

                local current_size = dim2(
                    start_size.X.Scale,
                    math.clamp(start_size.X.Offset + (input.Position.X - start.X), og_size.X.Offset, viewport_x),
                    start_size.Y.Scale,
                    math.clamp(start_size.Y.Offset + (input.Position.Y - start.Y), og_size.Y.Offset, viewport_y)
                )
                frame.Size = current_size
            end
        end)
    end

    function library:mouse_in_frame(uiobject)
        if not uiobject or not uiobject.Parent then return false end
        local y_cond = uiobject.AbsolutePosition.Y <= mouse.Y and mouse.Y <= uiobject.AbsolutePosition.Y + uiobject.AbsoluteSize.Y
        local x_cond = uiobject.AbsolutePosition.X <= mouse.X and mouse.X <= uiobject.AbsolutePosition.X + uiobject.AbsoluteSize.X
        return (y_cond and x_cond)
    end

    library.lerp = function(start, finish, t)
        t = t or 1 / 8
        return start * (1 - t) + finish * t
    end

    function library:draggify(frame)
        local dragging = false 
        local start_size = frame.Position
        local start 

        frame.InputBegan:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 then
                dragging = true
                start = input.Position
                start_size = frame.Position
            end
        end)

        frame.InputEnded:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 then
                dragging = false
            end
        end)

        library:connection(uis.InputChanged, function(input, game_event) 
            if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
                local viewport_x = camera.ViewportSize.X
                local viewport_y = camera.ViewportSize.Y

                local current_position = dim2(
                    0,
                    clamp(start_size.X.Offset + (input.Position.X - start.X), 0, viewport_x - frame.Size.X.Offset),
                    0,
                    math.clamp(start_size.Y.Offset + (input.Position.Y - start.Y), 0, viewport_y - frame.Size.Y.Offset)
                )

                frame.Position = current_position
            end
        end)
    end 

    function library:convert(str)
        local values = {}
        for value in string.gmatch(str, "[^,]+") do
            insert(values, tonumber(value))
        end
        if #values == 4 then              
            return unpack(values)
        else 
            return
        end
    end
    
    function library:convert_enum(enum)
        local enum_parts = {}
        for part in string.gmatch(enum, "[%w_]+") do
            insert(enum_parts, part)
        end
        local enum_table = Enum
        for i = 2, #enum_parts do
            local enum_item = enum_table[enum_parts[i]]
            enum_table = enum_item
        end
        return enum_table
    end

    -- THEME SYSTEM FUNCTIONS
    function library:set_theme(theme_name)
        local preset = theme_presets[theme_name]
        if not preset then
            preset = theme_presets.default
            theme_name = "default"
        end
        
        library.current_theme = theme_name
        
        for key, color_value in pairs(preset) do
            library:update_theme(key, color_value)
        end
        
        pcall(function()
            writefile(library.directory .. "/themes/current.txt", theme_name)
        end)
    end
    
    function library:get_theme_names()
        local names = {}
        for name, _ in pairs(theme_presets) do
            table.insert(names, name)
        end
        table.sort(names)
        return names
    end
    
    function library:set_accent(new_color)
        library:update_theme("accent", new_color)
        themes.preset.accent = new_color
    end
    
    function library:load_saved_theme()
        pcall(function()
            if isfile(library.directory .. "/themes/current.txt") then
                local saved_theme = readfile(library.directory .. "/themes/current.txt")
                if theme_presets[saved_theme] then
                    library:set_theme(saved_theme)
                end
            end
        end)
    end

    function library:save_default_theme(theme_name)
        pcall(function()
            if not isfolder(library.directory .. "/themes") then
                makefolder(library.directory .. "/themes")
            end
            writefile(library.directory .. "/themes/default.txt", theme_name)
        end)
    end

    function library:load_default_theme()
        local success, result = pcall(function()
            if isfile(library.directory .. "/themes/default.txt") then
                return readfile(library.directory .. "/themes/default.txt")
            end
            return nil
        end)
        if success and result and theme_presets[result] then
            library:set_theme(result)
            return result
        end
        return "default"
    end

    -- CONFIG SYSTEM FUNCTIONS
    function library:get_config_path()
        return library.directory .. "/configs/" .. tostring(game.PlaceId)
    end

    function library:get_autoload_path()
        return library:get_config_path() .. "/autoload.txt"
    end

    function library:get_config_path()
    return library.directory .. "/configs/" .. tostring(game.PlaceId)
end

function library:get_autoload_path()
    return library:get_config_path() .. "/autoload.txt"
end

function library:refresh_configs()
    local configs = {}
    local path = library:get_config_path()
    
    -- Ensure folder exists
    pcall(function()
        if not isfolder(path) then
            makefolder(path)
        end
    end)
    
    local success, files = pcall(function()
        return listfiles(path)
    end)
    
    if success and files then
        for i = 1, #files do
            local file = files[i]
            if type(file) == "string" then
                local name = file:match("([^/\\]+)$")
                if name and type(name) == "string" and string.match(name, "%.json$") then
                    local configName = string.gsub(name, "%.json$", "")
                    if configName and configName ~= "" then
                        configs[#configs + 1] = configName
                    end
                end
            end
        end
    end
    
    table.sort(configs)
    library.config.list = configs
    
    return configs
end

function library:notify(message)
    if notifications and notifications.create_notification then
        notifications:create_notification({name = tostring(message), duration = 3})
    else
        print("[Notification]:", message)
    end
end

function library:save_config(name)
    if not name or name == "" then
        library:notify("Please enter a config name")
        return false
    end
    
    -- Ensure folder exists
    pcall(function()
        if not isfolder(library:get_config_path()) then
            makefolder(library:get_config_path())
        end
    end)
    
    local path = library:get_config_path() .. "/" .. name .. ".json"
    local data = {}
    
    for flag, value in pairs(flags) do
        -- Skip internal flags
        if type(flag) == "string" and not flag:match("^_") then
            if type(value) == "table" and value.key then
                -- Keybind
                data[flag] = {active = value.active, mode = value.mode, key = tostring(value.key)}
            elseif type(value) == "table" and value["Transparency"] ~= nil and value["Color"] then
                -- Colorpicker
                data[flag] = {Transparency = value["Transparency"], Color = value["Color"]:ToHex()}
            elseif type(value) ~= "table" then
                -- Simple values (string, number, boolean)
                data[flag] = value
            elseif type(value) == "table" then
                -- Check if table can be serialized
                local canSerialize = true
                for k, v in pairs(value) do
                    if type(v) == "function" or type(v) == "userdata" or type(v) == "thread" then
                        canSerialize = false
                        break
                    end
                end
                if canSerialize then
                    data[flag] = value
                end
            end
        end
    end
    
    local success, err = pcall(function()
        writefile(path, http_service:JSONEncode(data))
    end)
    
    if success then
        library:notify("Config saved: " .. name)
        library:refresh_configs()
        return true
    else
        library:notify("Failed to save config: " .. tostring(err))
        return false
    end
end

function library:load_config(name)
    if not name or name == "" or name == "none" then
        library:notify("Please select a config")
        return false
    end
    
    local path = library:get_config_path() .. "/" .. name .. ".json"
    
    local exists = pcall(function() return isfile(path) end)
    if not exists or not isfile(path) then
        library:notify("Config not found: " .. name)
        return false
    end
    
    local success, err = pcall(function()
        local content = readfile(path)
        local data = http_service:JSONDecode(content)
        
        for flag, value in pairs(data) do
            local setter = config_flags[flag]
            
            if setter and type(setter) == "function" then
                pcall(function()
                    if type(value) == "table" and value["Transparency"] ~= nil and value["Color"] then
                        -- Colorpicker
                        setter(hex(value["Color"]), value["Transparency"])
                    elseif type(value) == "table" and value["active"] ~= nil then
                        -- Keybind
                        setter(value)
                    else
                        -- Other values
                        setter(value)
                    end
                end)
            end
        end
    end)
    
    if success then
        library:notify("Config loaded: " .. name)
        library.config.selected = name
        return true
    else
        library:notify("Failed to load config: " .. tostring(err))
        return false
    end
end

function library:delete_config(name)
    if not name or name == "" or name == "none" then
        library:notify("Please select a config")
        return false
    end
    
    local path = library:get_config_path() .. "/" .. name .. ".json"
    
    local exists = pcall(function() return isfile(path) end)
    if not exists or not isfile(path) then
        library:notify("Config not found: " .. name)
        return false
    end
    
    local success = pcall(function()
        delfile(path)
    end)
    
    if success then
        if library:get_autoload() == name then
            library:remove_autoload()
        end
        
        library:notify("Config deleted: " .. name)
        library:refresh_configs()
        return true
    else
        library:notify("Failed to delete config")
        return false
    end
end

function library:get_autoload()
    local path = library:get_autoload_path()
    local success, content = pcall(function()
        if isfile(path) then
            return readfile(path)
        end
        return nil
    end)
    if success and content and content ~= "" then
        return content
    end
    return nil
end

function library:set_autoload(name)
    if not name or name == "" or name == "none" then
        library:notify("Please select a config")
        return false
    end
    
    -- Ensure folder exists
    pcall(function()
        if not isfolder(library:get_config_path()) then
            makefolder(library:get_config_path())
        end
    end)
    
    local success = pcall(function()
        writefile(library:get_autoload_path(), name)
    end)
    
    if success then
        library.config.autoload = name
        library:notify("Autoload set: " .. name)
        return true
    else
        library:notify("Failed to set autoload")
        return false
    end
end

function library:remove_autoload()
    local path = library:get_autoload_path()
    
    local exists = pcall(function() return isfile(path) end)
    if exists and isfile(path) then
        pcall(function()
            delfile(path)
        end)
        library.config.autoload = nil
        library:notify("Autoload removed")
        return true
    else
        library:notify("No autoload set")
        return false
    end
end

function library:run_autoload()
    local autoload = library:get_autoload()
    if autoload and autoload ~= "" then
        library:refresh_configs()
        local found = false
        for _, cfg in ipairs(library.config.list) do
            if cfg == autoload then
                found = true
                break
            end
        end
        if found then
            task.wait(0.3)
            library:load_config(autoload)
            return true
        end
    end
    return false
end

local config_holder = nil

function library:update_config_list() 
    if not config_holder then 
        return 
    end
    local list = library:refresh_configs()
    if #list == 0 then
        list = {"none"}
    end
    config_holder.refresh_options(list)
end

    function library:get_config()
        local Config = {}
        for _, v in flags do
            if type(v) == "table" and v.key then
                Config[_] = {active = v.active, mode = v.mode, key = tostring(v.key)}
            elseif type(v) == "table" and v["Transparency"] and v["Color"] then
                Config[_] = {Transparency = v["Transparency"], Color = v["Color"]:ToHex()}
            else
                Config[_] = v
            end
        end 
        return http_service:JSONEncode(Config)
    end
    
    function library:round(number, float) 
        local multiplier = 1 / (float or 1)
        return floor(number * multiplier + 0.5) / multiplier
    end 

    function library:apply_theme(instance, theme, property) 
        if themes.utility[theme] and themes.utility[theme][property] then
            insert(themes.utility[theme][property], instance)
            instance[property] = themes.preset[theme]
        end
    end

    function library:update_theme(theme, color)
        if themes.utility[theme] then
            for property, objects in pairs(themes.utility[theme]) do 
                for i = #objects, 1, -1 do
                    local object = objects[i]
                    if object and object.Parent then
                        pcall(function()
                            object[property] = color
                        end)
                    else
                        table.remove(objects, i)
                    end
                end 
            end 
        end
        themes.preset[theme] = color 
    end 

    function library:connection(signal, callback)
        local connection = signal:Connect(callback)
        insert(library.connections, connection)
        return connection 
    end

    function library:apply_stroke(parent) end

    function library:create(instance, options)
        local ins = Instance.new(instance) 
        for prop, value in next, options do 
            ins[prop] = value
        end
        if instance == "TextLabel" or instance == "TextButton" or instance == "TextBox" then 	
            library:apply_theme(ins, "text", "TextColor3")
            library:apply_stroke(ins)
        end
        return ins 
    end

    function library:unload_menu() 
        if library.gui then 
            library.gui:Destroy()
        end
        if library.watermark_gui then
            library.watermark_gui:Destroy()
        end
        if library.keybind_gui then
            library.keybind_gui:Destroy()
        end
        for index, connection in next, library.connections do 
            connection:Disconnect() 
            connection = nil 
        end     
        library = nil 
    end 

    -- WINDOW
    function library:window(properties)
        local cfg = {
            name = properties.name or "vaderhaxx",
            size = properties.size or dim2(0, 560, 0, 740),
            selected_tab = nil
        }

        -- Main UI ScreenGui
        library.gui = library:create("ScreenGui", {
            Parent = coregui,
            Name = "MainUI",
            Enabled = true,
            ZIndexBehavior = Enum.ZIndexBehavior.Sibling,
            IgnoreGuiInset = true,
        })
        
        -- SEPARATE ScreenGui for Watermark
        library.watermark_gui = library:create("ScreenGui", {
            Parent = coregui,
            Name = "WatermarkUI",
            Enabled = true,
            ZIndexBehavior = Enum.ZIndexBehavior.Sibling,
            IgnoreGuiInset = true,
        })
        
        -- SEPARATE ScreenGui for Keybind List
        library.keybind_gui = library:create("ScreenGui", {
            Parent = coregui,
            Name = "KeybindUI",
            Enabled = true,
            ZIndexBehavior = Enum.ZIndexBehavior.Sibling,
            IgnoreGuiInset = true,
        })

        local a = library:create("Frame", {
            Parent = library.gui,
            BackgroundTransparency = 1,
            Position = dim2(0.5, -cfg.size.X.Offset / 2, 0.5, -cfg.size.Y.Offset / 2),
            BorderColor3 = rgb(0, 0, 0),
            Size = cfg.size,
            BorderSizePixel = 0,
            BackgroundColor3 = rgb(255, 255, 255)
        })
        library:resizify(a)
        library:draggify(a)
        a.Position = dim2(0, a.AbsolutePosition.X, 0, a.AbsolutePosition.Y)
        
        library.main_frame = a

        local main_stroke = library:create("UIStroke", {
            Parent = a,
            LineJoinMode = Enum.LineJoinMode.Miter,
            Color = themes.preset.accent
        })
        library:apply_theme(main_stroke, "accent", "Color")
        
        local b = library:create("Frame", {
            Parent = a,
            BackgroundTransparency = 1,
            Position = dim2(0, 1, 0, 1),
            BorderColor3 = rgb(0, 0, 0),
            Size = dim2(1, -2, 1, -2),
            BorderSizePixel = 0,
            BackgroundColor3 = themes.preset.b
        })
        library:apply_theme(b, "b", "BackgroundColor3")
        
        library:create("UIStroke", {
            Color = themes.preset.b,
            LineJoinMode = Enum.LineJoinMode.Miter,
            Parent = b,
            Transparency = 0.25
        })
        
        local c = library:create("Frame", {
            Parent = b,
            BackgroundTransparency = 1,
            Position = dim2(0, 1, 0, 1),
            BorderColor3 = rgb(0, 0, 0),
            Size = dim2(1, -2, 1, -2),
            BorderSizePixel = 0,
            BackgroundColor3 = themes.preset.c
        })
        library:apply_theme(c, "c", "BackgroundColor3")
        
        library:create("UIStroke", {
            Color = themes.preset.c,
            LineJoinMode = Enum.LineJoinMode.Miter,
            Parent = c,
            Transparency = 0.25
        })
        
        local c2 = library:create("Frame", {
            Parent = c,
            BackgroundTransparency = 1,
            Position = dim2(0, 1, 0, 1),
            BorderColor3 = rgb(0, 0, 0),
            Size = dim2(1, -2, 1, -2),
            BorderSizePixel = 0,
            BackgroundColor3 = themes.preset.c
        })
        library:apply_theme(c2, "c", "BackgroundColor3")
        
        library:create("UIStroke", {
            Color = themes.preset.c,
            LineJoinMode = Enum.LineJoinMode.Miter,
            Parent = c2,
            Transparency = 0.25
        })
        
        local b2 = library:create("Frame", {
            Parent = c2,
            BackgroundTransparency = 1,
            Position = dim2(0, 1, 0, 1),
            BorderColor3 = rgb(0, 0, 0),
            Size = dim2(1, -2, 1, -2),
            BorderSizePixel = 0,
            BackgroundColor3 = themes.preset.c
        })
        library:apply_theme(b2, "c", "BackgroundColor3")
        
        library:create("UIStroke", {
            Color = themes.preset.b,
            LineJoinMode = Enum.LineJoinMode.Miter,
            Parent = b2,
            Transparency = 0.25
        })
        
        local a2 = library:create("Frame", {
            Parent = b2,
            BackgroundTransparency = 0.35,
            BorderColor3 = rgb(0, 0, 0),
            Size = dim2(1, 0, 1, 0),
            BorderSizePixel = 0,
            BackgroundColor3 = themes.preset.a
        })
        library:apply_theme(a2, "a", "BackgroundColor3")
        
        local tab_holder = library:create("Frame", {
            Parent = a2,
            BackgroundTransparency = 1,
            Position = dim2(0, 17, 0, 0),
            BorderColor3 = rgb(0, 0, 0),
            Size = dim2(1, -34, 0, 28),
            BorderSizePixel = 0,
            BackgroundColor3 = rgb(255, 255, 255)
        })
        cfg.tab_holder = tab_holder
        
        library:create("UIListLayout", {
            FillDirection = Enum.FillDirection.Horizontal,
            HorizontalFlex = Enum.UIFlexAlignment.Fill,
            Parent = tab_holder,
            Padding = dim(0, 4),
            SortOrder = Enum.SortOrder.LayoutOrder,
            VerticalFlex = Enum.UIFlexAlignment.Fill
        })
        
        local content_frame = library:create("Frame", {
            Parent = a2,
            Position = dim2(0, 17, 0, 31),
            BorderColor3 = rgb(0, 0, 0),
            Size = dim2(1, -34, 1, -46),
            BorderSizePixel = 0,
            BackgroundColor3 = themes.preset.a
        })
        library:apply_theme(content_frame, "a", "BackgroundColor3")
        
        local inline = library:create("Frame", {
            Parent = content_frame,
            Position = dim2(0, 1, 0, 1),
            BorderColor3 = rgb(0, 0, 0),
            Size = dim2(1, -2, 1, -2),
            BorderSizePixel = 0,
            BackgroundColor3 = themes.preset.c
        })
        library:apply_theme(inline, "c", "BackgroundColor3")
        cfg.inline = inline

        -- Keybind list (in SEPARATE GUI)
        local keybindlist = library:create("Frame", {
            BorderColor3 = rgb(0, 0, 0),
            Parent = library.keybind_gui,
            BackgroundTransparency = 1,
            Position = dim2(0, 100, 0, 600),
            Size = dim2(0, 202, 0, 66),
            BorderSizePixel = 0,
            AutomaticSize = Enum.AutomaticSize.XY,
            BackgroundColor3 = rgb(255, 255, 255),
            Visible = false,
        })
        library:draggify(keybindlist)
        library.keybind_list_frame = keybindlist
        
        local kl_stroke = library:create("UIStroke", {
            Parent = keybindlist,
            LineJoinMode = Enum.LineJoinMode.Miter,
            Color = themes.preset.accent
        })
        library:apply_theme(kl_stroke, "accent", "Color")

        local kl_inline1 = library:create("Frame", {
            BorderColor3 = rgb(0, 0, 0),
            Parent = keybindlist,
            BackgroundTransparency = 1,
            Position = dim2(0, 1, 0, 1),
            Size = dim2(1, -2, 1, -2),
            BorderSizePixel = 0,
            AutomaticSize = Enum.AutomaticSize.XY,
            BackgroundColor3 = themes.preset.b
        })
        library:apply_theme(kl_inline1, "b", "BackgroundColor3")

        library:create("UIStroke", {
            Color = themes.preset.b,
            LineJoinMode = Enum.LineJoinMode.Miter,
            Parent = kl_inline1,
            Transparency = 0.25
        })

        local kl_inline2 = library:create("Frame", {
            BorderColor3 = rgb(0, 0, 0),
            Parent = kl_inline1,
            BackgroundTransparency = 1,
            Position = dim2(0, 1, 0, 1),
            Size = dim2(1, -2, 1, -2),
            BorderSizePixel = 0,
            AutomaticSize = Enum.AutomaticSize.XY,
            BackgroundColor3 = themes.preset.c
        })
        library:apply_theme(kl_inline2, "c", "BackgroundColor3")

        library:create("UIStroke", {
            Color = themes.preset.c,
            LineJoinMode = Enum.LineJoinMode.Miter,
            Parent = kl_inline2,
            Transparency = 0.25
        })

        local kl_inline3 = library:create("Frame", {
            BorderColor3 = rgb(0, 0, 0),
            Parent = kl_inline2,
            BackgroundTransparency = 1,
            Position = dim2(0, 1, 0, 1),
            Size = dim2(1, -2, 1, -2),
            BorderSizePixel = 0,
            AutomaticSize = Enum.AutomaticSize.XY,
            BackgroundColor3 = themes.preset.c
        })
        library:apply_theme(kl_inline3, "c", "BackgroundColor3")

        library:create("UIStroke", {
            Color = themes.preset.c,
            LineJoinMode = Enum.LineJoinMode.Miter,
            Parent = kl_inline3,
            Transparency = 0.25
        })

        local kl_inline4 = library:create("Frame", {
            BorderColor3 = rgb(0, 0, 0),
            Parent = kl_inline3,
            BackgroundTransparency = 1,
            Position = dim2(0, 1, 0, 1),
            Size = dim2(1, -2, 1, -2),
            BorderSizePixel = 0,
            AutomaticSize = Enum.AutomaticSize.XY,
            BackgroundColor3 = themes.preset.b
        })
        library:apply_theme(kl_inline4, "b", "BackgroundColor3")

        library:create("UIStroke", {
            Color = themes.preset.b,
            LineJoinMode = Enum.LineJoinMode.Miter,
            Parent = kl_inline4,
            Transparency = 0.25
        })

        local kl_inline5 = library:create("Frame", {
            Parent = kl_inline4,
            BackgroundTransparency = 0.35,
            Size = dim2(1, 0, 1, 0),
            BorderColor3 = rgb(0, 0, 0),
            BorderSizePixel = 0,
            AutomaticSize = Enum.AutomaticSize.XY,
            BackgroundColor3 = themes.preset.a
        })
        library:apply_theme(kl_inline5, "a", "BackgroundColor3")

        local kl_tab_holder = library:create("Frame", {
            Parent = kl_inline5,
            BackgroundTransparency = 1,
            Position = dim2(0, 17, 0, 0),
            BorderColor3 = rgb(0, 0, 0),
            Size = dim2(1, 0, 0, 28),
            BorderSizePixel = 0,
            BackgroundColor3 = rgb(255, 255, 255)
        })

        library:create("UIListLayout", {
            FillDirection = Enum.FillDirection.Horizontal,
            HorizontalFlex = Enum.UIFlexAlignment.Fill,
            Parent = kl_tab_holder,
            Padding = dim(0, 4),
            SortOrder = Enum.SortOrder.LayoutOrder,
            VerticalFlex = Enum.UIFlexAlignment.Fill
        })

        local kl_button = library:create("TextButton", {
            FontFace = library.font,
            TextColor3 = rgb(255, 255, 255),
            BorderColor3 = rgb(0, 0, 0),
            Text = "keybinds",
            Parent = kl_tab_holder,
            BackgroundTransparency = 1,
            Size = dim2(0, 200, 0, 50),
            BorderSizePixel = 0,
            TextSize = 12,
            BackgroundColor3 = rgb(255, 255, 255)
        })

        local kl_accent = library:create("Frame", {
            AnchorPoint = vec2(0, 1),
            Parent = kl_button,
            Position = dim2(0, 0, 1, 0),
            BorderColor3 = rgb(0, 0, 0),
            Size = dim2(1, 0, 0, 4),
            BorderSizePixel = 0,
            BackgroundColor3 = themes.preset.accent
        })
        library:apply_theme(kl_accent, "accent", "BackgroundColor3")

        local kl_split = library:create("Frame", {
            AnchorPoint = vec2(0, 1),
            Parent = kl_accent,
            Position = dim2(0, 0, 1, 0),
            BorderColor3 = rgb(0, 0, 0),
            Size = dim2(1, 0, 0, 2),
            BorderSizePixel = 0,
            BackgroundColor3 = themes.preset.accent
        })

        library:create("UIGradient", {
            Color = rgbseq{rgbkey(0, rgb(167, 167, 167)), rgbkey(1, rgb(167, 167, 167))},
            Parent = kl_split
        })

        local kl_inline6 = library:create("Frame", {
            Parent = kl_inline5,
            Size = dim2(1, -34, 0, 0),
            Position = dim2(0, 17, 0, 31),
            BorderColor3 = rgb(0, 0, 0),
            BorderSizePixel = 0,
            AutomaticSize = Enum.AutomaticSize.XY,
            BackgroundColor3 = themes.preset.a
        })
        library:apply_theme(kl_inline6, "a", "BackgroundColor3")

        local kl_inline7 = library:create("Frame", {
            Parent = kl_inline6,
            Size = dim2(1, -2, 1, -2),
            Position = dim2(0, 1, 0, 1),
            BorderColor3 = rgb(0, 0, 0),
            BorderSizePixel = 0,
            AutomaticSize = Enum.AutomaticSize.XY,
            BackgroundColor3 = themes.preset.b
        })
        library:apply_theme(kl_inline7, "b", "BackgroundColor3")

        local kl_inline8 = library:create("Frame", {
            Parent = kl_inline7,
            Size = dim2(1, -2, 1, -2),
            Position = dim2(0, 1, 0, 1),
            BorderColor3 = rgb(0, 0, 0),
            BorderSizePixel = 0,
            AutomaticSize = Enum.AutomaticSize.XY,
            BackgroundColor3 = themes.preset.e
        })
        library:apply_theme(kl_inline8, "e", "BackgroundColor3")
        library.keybind_list = kl_inline8

        library:create("UIListLayout", {
            Parent = kl_inline8,
            Padding = dim(0, 10),
            SortOrder = Enum.SortOrder.LayoutOrder
        })

        library:create("UIPadding", {
            PaddingTop = dim(0, 8),
            PaddingBottom = dim(0, 8),
            Parent = kl_inline8,
            PaddingRight = dim(0, 2),
            PaddingLeft = dim(0, 8)
        })

        library:create("UIPadding", {
            PaddingBottom = dim(0, 2),
            PaddingRight = dim(0, 2),
            Parent = kl_inline7
        })

        library:create("UIPadding", {
            PaddingBottom = dim(0, 2),
            PaddingRight = dim(0, 2),
            Parent = kl_inline6
        })

        library:create("UIPadding", {
            PaddingBottom = dim(0, 10),
            PaddingRight = dim(0, 34),
            Parent = kl_inline5
        })

        library:create("UIPadding", {
            Parent = kl_inline4
        })

        library:create("UIPadding", {
            PaddingBottom = dim(0, 2),
            PaddingRight = dim(0, 2),
            Parent = kl_inline3
        })

        library:create("UIPadding", {
            PaddingBottom = dim(0, 2),
            PaddingRight = dim(0, 2),
            Parent = kl_inline2
        })

        library:create("UIPadding", {
            PaddingBottom = dim(0, 2),
            PaddingRight = dim(0, 2),
            Parent = kl_inline1
        })

        library:create("UIPadding", {
            PaddingBottom = dim(0, 2),
            PaddingRight = dim(0, 2),
            Parent = keybindlist
        })

        -- Menu toggle - ONLY toggles main UI
        library:connection(uis.InputBegan, function(input, gameProcessed)
            if input.KeyCode == Enum.KeyCode.RightShift and not gameProcessed then
                library.gui.Enabled = not library.gui.Enabled
            end
        end)

        return setmetatable(cfg, library)
    end 

    -- WATERMARK (in SEPARATE GUI)
    function library:watermark(options)
        local cfg = {
            name = options.name or "vaderhaxx",
            visible = true,
        }
        
        local outline = library:create("Frame", {
            Parent = library.watermark_gui,
            Size = dim2(0, 0, 0, 18),
            Position = dim2(0, 50, 0, 50),
            BorderColor3 = rgb(0, 0, 0),
            BorderSizePixel = 0,
            AutomaticSize = Enum.AutomaticSize.XY,
            BackgroundColor3 = themes.preset.c
        })
        library:apply_theme(outline, "c", "BackgroundColor3")
        library:draggify(outline)
        
        cfg.frame = outline

        local wm_stroke = library:create("UIStroke", {
            Parent = outline,
            LineJoinMode = Enum.LineJoinMode.Miter,
            Color = themes.preset.accent
        })
        library:apply_theme(wm_stroke, "accent", "Color")

        local wm_inline = library:create("Frame", {
            Parent = outline,
            Position = dim2(0, 1, 0, 1),
            BorderColor3 = rgb(0, 0, 0),
            BorderSizePixel = 0,
            AutomaticSize = Enum.AutomaticSize.XY,
            BackgroundColor3 = themes.preset.e
        })
        library:apply_theme(wm_inline, "e", "BackgroundColor3")
        
        local menu_title = library:create("TextLabel", {
            FontFace = library.font,
            Parent = wm_inline,
            TextColor3 = rgb(255, 255, 255),
            BorderColor3 = rgb(0, 0, 0),
            Text = "[ ] ",
            AutomaticSize = Enum.AutomaticSize.XY,
            Size = dim2(1, -4, 1, 0),
            Position = dim2(0, 4, 0, -2),
            BackgroundTransparency = 1,
            TextXAlignment = Enum.TextXAlignment.Left,
            BorderSizePixel = 0,
            ZIndex = 2,
            TextSize = 12,
            BackgroundColor3 = rgb(255, 255, 255)
        })
        
        local uigradient = library:create("UIGradient", {
            Color = rgbseq{rgbkey(0, rgb(255, 0, 0)), rgbkey(0.17, rgb(255, 255, 0)), rgbkey(0.33, rgb(0, 255, 0)), rgbkey(0.5, rgb(0, 255, 255)), rgbkey(0.67, rgb(0, 0, 255)), rgbkey(0.83, rgb(255, 0, 255)), rgbkey(1, rgb(255, 0, 0))},
            Transparency = numseq{numkey(0, -1), numkey(1, -1)},
            Parent = menu_title
        })
        
        library:create("UIPadding", {
            PaddingTop = dim(0, 7),
            PaddingBottom = dim(0, 6),
            Parent = wm_inline,
            PaddingRight = dim(0, 8),
            PaddingLeft = dim(0, 4)
        })
        
        local misc_text = library:create("TextLabel", {
            FontFace = library.font,
            Parent = wm_inline,
            TextColor3 = rgb(255, 255, 255),
            BorderColor3 = rgb(0, 0, 0),
            Text = "",
            AutomaticSize = Enum.AutomaticSize.XY,
            Size = dim2(1, -4, 1, 0),
            Position = dim2(0, 4, 0, -2),
            BackgroundTransparency = 1,
            TextXAlignment = Enum.TextXAlignment.Left,
            BorderSizePixel = 0,
            ZIndex = 2,
            TextSize = 12,
            BackgroundColor3 = rgb(255, 255, 255)
        })
        
        library:create("UIPadding", {
            PaddingBottom = dim(0, 1),
            PaddingRight = dim(0, 1),
            Parent = outline
        })

        function cfg.update_text()
            local spaces = ""
            for i = 1, string.len(cfg.name) do 
                spaces = spaces .. " "
            end  
            
            local fps = math.floor(1 / (run.RenderStepped:Wait() + 0.001))
            local ping = 0
            pcall(function()
                ping = math.floor(stats.Network.ServerStatsItem["Data Ping"]:GetValue())
            end)
            
            misc_text.Text = "[ " .. spaces .. " ] fps: " .. fps .. " | ping: " .. ping
            menu_title.Text = "[ " .. cfg.name .. " ]"
        end 
        
        function cfg:set_visible(bool)
            cfg.visible = bool
            outline.Visible = bool
        end
        
        function cfg:show()
            cfg:set_visible(true)
        end
        
        function cfg:hide()
            cfg:set_visible(false)
        end
        
        function cfg:toggle()
            cfg:set_visible(not cfg.visible)
        end

        cfg.update_text()

        task.spawn(function()
            while task.wait(0.5) do
                if cfg.visible and outline and outline.Parent then
                    local offset = tick() * 0.2
                    
                    uigradient.Color = rgbseq{
                        rgbkey(0, hsv(offset % 1, 1, 1)), 
                        rgbkey(0.17, hsv((offset + 0.17) % 1, 1, 1)), 
                        rgbkey(0.33, hsv((offset + 0.33) % 1, 1, 1)), 
                        rgbkey(0.5, hsv((offset + 0.5) % 1, 1, 1)), 
                        rgbkey(0.67, hsv((offset + 0.67) % 1, 1, 1)), 
                        rgbkey(0.83, hsv((offset + 0.83) % 1, 1, 1)), 
                        rgbkey(1, hsv((offset + 1) % 1, 1, 1))
                    }
                    
                    cfg.update_text()
                end
            end 
        end)

        return setmetatable(cfg, library)
    end 

    -- NOTIFICATIONS
    local notifications = {notifs = {}} 

    function notifications:refresh_notifs() 
        for i, v in notifications.notifs do 
            if v and v.Parent then
                local Position = vec2(20, 20)
                tween_service:Create(v, TweenInfo.new(1, Enum.EasingStyle.Exponential, Enum.EasingDirection.Out), {Position = dim_offset(Position.X, Position.Y + (i * 30))}):Play()
            end
        end
    end
    
    function notifications:fade(path, is_fading)
        local fading = is_fading and 1 or 0 
        
        tween_service:Create(path, TweenInfo.new(1, Enum.EasingStyle.Exponential, Enum.EasingDirection.Out), {BackgroundTransparency = fading}):Play()
    
        for _, instance in path:GetDescendants() do 
            if not instance:IsA("GuiObject") then 
                if instance:IsA("UIStroke") then
                    tween_service:Create(instance, TweenInfo.new(1, Enum.EasingStyle.Exponential, Enum.EasingDirection.Out), {Transparency = fading}):Play()
                end
                continue
            end 
    
            if instance:IsA("TextLabel") then
                tween_service:Create(instance, TweenInfo.new(1, Enum.EasingStyle.Exponential, Enum.EasingDirection.Out), {TextTransparency = fading}):Play()
            elseif instance:IsA("Frame") then
                tween_service:Create(instance, TweenInfo.new(1, Enum.EasingStyle.Exponential, Enum.EasingDirection.Out), {BackgroundTransparency = fading}):Play()
            end
        end
    end 
    
    local sgui = library:create("ScreenGui", {
        Name = "Notifications",
        Parent = (gethui and gethui()) or coregui
    })
    
    function notifications:create_notification(options)
        local cfg = {
            name = options.name or "Notification",
            duration = options.duration or 3,
        }

        local outline = library:create("Frame", {
            Parent = sgui,
            Size = dim2(0, 0, 0, 0),
            Position = dim_offset(20, 20 + (#notifications.notifs * 30)),
            BorderColor3 = rgb(0, 0, 0),
            BorderSizePixel = 0,
            AutomaticSize = Enum.AutomaticSize.XY,
            BackgroundColor3 = themes.preset.c
        })
        library:apply_theme(outline, "c", "BackgroundColor3")
        library:draggify(outline)

        local notif_stroke = library:create("UIStroke", {
            Parent = outline,
            LineJoinMode = Enum.LineJoinMode.Miter,
            Color = themes.preset.accent
        })
        library:apply_theme(notif_stroke, "accent", "Color")

        local notif_inline = library:create("Frame", {
            Parent = outline,
            Position = dim2(0, 1, 0, 1),
            BorderColor3 = rgb(0, 0, 0),
            BorderSizePixel = 0,
            AutomaticSize = Enum.AutomaticSize.XY,
            BackgroundColor3 = themes.preset.e
        })
        library:apply_theme(notif_inline, "e", "BackgroundColor3")
        
        library:create("UIPadding", {
            PaddingTop = dim(0, 7),
            PaddingBottom = dim(0, 6),
            Parent = notif_inline,
            PaddingRight = dim(0, 8),
            PaddingLeft = dim(0, 4)
        })
        
        library:create("TextLabel", {
            FontFace = library.font,
            Parent = notif_inline,
            TextColor3 = rgb(255, 255, 255),
            BorderColor3 = rgb(0, 0, 0),
            Text = cfg.name,
            AutomaticSize = Enum.AutomaticSize.XY,
            Size = dim2(1, -4, 1, 0),
            Position = dim2(0, 4, 0, -2),
            BackgroundTransparency = 1,
            TextXAlignment = Enum.TextXAlignment.Left,
            BorderSizePixel = 0,
            ZIndex = 2,
            TextSize = 12,
            BackgroundColor3 = rgb(255, 255, 255)
        })
        
        library:create("UIPadding", {
            PaddingBottom = dim(0, 1),
            PaddingRight = dim(0, 1),
            Parent = outline
        })
        
        local index = #notifications.notifs + 1
        notifications.notifs[index] = outline
        
        notifications:refresh_notifs()
        tween_service:Create(outline, TweenInfo.new(1, Enum.EasingStyle.Exponential, Enum.EasingDirection.Out), {AnchorPoint = vec2(0, 0)}):Play()
        
        notifications:fade(outline, false)
    
        task.spawn(function()
            task.wait(cfg.duration)
            
            notifications.notifs[index] = nil
    
            notifications:fade(outline, true)
    
            task.wait(1)
    
            if outline and outline.Parent then
                outline:Destroy()
            end
            
            notifications:refresh_notifs()
        end)
    end

    library.notifications = notifications

    -- TAB
    function library:tab(properties)
        local cfg = {
            name = properties.name or "tab", 
        } 

        local button = library:create("TextButton", {
            FontFace = library.font,
            TextColor3 = rgb(255, 255, 255),
            BorderColor3 = rgb(0, 0, 0),
            Parent = self.tab_holder,
            BackgroundTransparency = 1,
            Size = dim2(0, 200, 0, 50),
            BorderSizePixel = 0,
            TextSize = 12,
            Text = cfg.name,
            BackgroundColor3 = rgb(255, 255, 255)
        })
        
        local accent = library:create("Frame", {
            AnchorPoint = vec2(0, 1),
            Parent = button,
            Position = dim2(0, 0, 1, 0),
            BorderColor3 = rgb(0, 0, 0),
            Size = dim2(1, 0, 0, 4),
            BorderSizePixel = 0,
            BackgroundColor3 = themes.preset.f
        })
        library:apply_theme(accent, "f", "BackgroundColor3")
        
        local split = library:create("Frame", {
            AnchorPoint = vec2(0, 1),
            Parent = accent,
            Position = dim2(0, 0, 1, 0),
            BorderColor3 = rgb(0, 0, 0),
            Size = dim2(1, 0, 0, 2),
            BorderSizePixel = 0,
            BackgroundColor3 = themes.preset.f
        })
        library:apply_theme(split, "f", "BackgroundColor3")
        
        library:create("UIGradient", {
            Color = rgbseq{rgbkey(0, rgb(167, 167, 167)), rgbkey(1, rgb(167, 167, 167))},
            Parent = split
        })

        local e = library:create("Frame", {
            Parent = self.inline,
            Position = dim2(0, 1, 0, 1),
            BorderColor3 = rgb(0, 0, 0),
            Size = dim2(1, -2, 1, -2),
            Visible = false,
            BorderSizePixel = 0,
            BackgroundColor3 = themes.preset.e
        })
        library:apply_theme(e, "e", "BackgroundColor3")
        cfg.page_holder = e
        
        library:create("UIListLayout", {
            FillDirection = Enum.FillDirection.Horizontal,
            HorizontalFlex = Enum.UIFlexAlignment.Fill,
            Parent = e,
            Padding = dim(0, 12),
            SortOrder = Enum.SortOrder.LayoutOrder,
            VerticalFlex = Enum.UIFlexAlignment.Fill
        })
        
        library:create("UIPadding", {
            PaddingTop = dim(0, 22),
            PaddingBottom = dim(0, 22),
            Parent = e,
            PaddingRight = dim(0, 22),
            PaddingLeft = dim(0, 22)
        })

        local left_frame = library:create("Frame", {
            BackgroundTransparency = 1,
            Position = dim2(0, 22, 0, 22),
            BorderColor3 = rgb(0, 0, 0),
            Parent = e,
            BorderSizePixel = 0,
            BackgroundColor3 = rgb(255, 255, 255)
        })
        cfg.left = left_frame
        
        library:create("UIListLayout", {
            Parent = left_frame,
            Padding = dim(0, 12),
            SortOrder = Enum.SortOrder.LayoutOrder,
            HorizontalFlex = Enum.UIFlexAlignment.Fill,
            VerticalFlex = Enum.UIFlexAlignment.Fill,
        })

        local right_frame = library:create("Frame", {
            BackgroundTransparency = 1,
            Position = dim2(0, 22, 0, 22),
            BorderColor3 = rgb(0, 0, 0),
            Parent = e,
            BorderSizePixel = 0,
            BackgroundColor3 = rgb(255, 255, 255)
        })
        cfg.right = right_frame
        
        library:create("UIListLayout", {
            Parent = right_frame,
            Padding = dim(0, 12),
            SortOrder = Enum.SortOrder.LayoutOrder,
            HorizontalFlex = Enum.UIFlexAlignment.Fill,
            VerticalFlex = Enum.UIFlexAlignment.Fill,
        })

        function cfg.open_tab() 
            local selected_tab = self.selected_tab
            
            if selected_tab then 
                selected_tab[1].Visible = false
                selected_tab[2].BackgroundColor3 = themes.preset.f
                selected_tab[3].BackgroundColor3 = themes.preset.f
            end

            e.Visible = true
            accent.BackgroundColor3 = themes.preset.accent
            split.BackgroundColor3 = themes.preset.accent

            self.selected_tab = {e, accent, split}
        end

        button.MouseButton1Down:Connect(function()
            cfg.open_tab()
        end)

        if not self.selected_tab then 
            cfg.open_tab() 
        end

        return setmetatable(cfg, library)    
    end 

    -- SECTION
    function library:section(properties)
        local cfg = {
            name = properties.name or "section", 
            side = properties.side or "left",
            fill = properties.fill or 0.01,
        }   

        local parent = self[cfg.side] 

        local section = library:create("Frame", {
            Parent = parent,
            BackgroundTransparency = 1,
            BorderColor3 = rgb(0, 0, 0),
            Size = dim2(0, 0, cfg.fill, 0),
            BorderSizePixel = 0,
            BackgroundColor3 = rgb(255, 255, 255)
        })
        
        library:create("UIListLayout", {
            SortOrder = Enum.SortOrder.LayoutOrder,
            HorizontalFlex = Enum.UIFlexAlignment.Fill,
            Parent = section,
            Padding = dim(0, 12),
            VerticalFlex = Enum.UIFlexAlignment.Fill
        })
        
        local a = library:create("Frame", {
            Position = dim2(0, 22, 0, 22),
            BorderColor3 = rgb(0, 0, 0),
            Parent = section,
            BorderSizePixel = 0,
            BackgroundColor3 = themes.preset.a
        })
        library:apply_theme(a, "a", "BackgroundColor3")
        
        local c = library:create("Frame", {
            Parent = a,
            Position = dim2(0, 1, 0, 1),
            BorderColor3 = rgb(0, 0, 0),
            Size = dim2(1, -2, 1, -2),
            BorderSizePixel = 0,
            BackgroundColor3 = themes.preset.c
        })
        library:apply_theme(c, "c", "BackgroundColor3")
        
        local e = library:create("Frame", {
            Parent = c,
            Position = dim2(0, 1, 0, 1),
            BorderColor3 = rgb(0, 0, 0),
            Size = dim2(1, -2, 1, -2),
            BorderSizePixel = 0,
            BackgroundColor3 = themes.preset.e
        })
        library:apply_theme(e, "e", "BackgroundColor3")
        
        library:create("TextLabel", {
            FontFace = library.font,
            Parent = e,
            TextColor3 = rgb(255, 255, 255),
            BorderColor3 = rgb(0, 0, 0),
            Text = cfg.name,
            AutomaticSize = Enum.AutomaticSize.Y,
            Size = dim2(1, -10, 0, 0),
            Position = dim2(0, 10, 0, -7),
            BackgroundTransparency = 1,
            TextXAlignment = Enum.TextXAlignment.Left,
            BorderSizePixel = 0,
            ZIndex = 2,
            TextSize = 12,
            BackgroundColor3 = rgb(255, 255, 255)
        })
        
        local scrolling_frame = library:create("ScrollingFrame", {
            ScrollBarImageColor3 = themes.preset.accent,
            MidImage = "rbxassetid://72824869889812",
            Parent = e,
            Active = true,
            AutomaticCanvasSize = Enum.AutomaticSize.Y,
            ScrollBarThickness = 2,
            ZIndex = 2,
            Size = dim2(1, 0, 1, 0),
            BackgroundColor3 = rgb(255, 255, 255),
            TopImage = "rbxassetid://85156243582367",
            BorderColor3 = rgb(0, 0, 0),
            BackgroundTransparency = 1,
            BottomImage = "rbxassetid://139338441481766",
            BorderSizePixel = 0,
            CanvasSize = dim2(0, 0, 0, 0)
        })
        library:apply_theme(scrolling_frame, "accent", "ScrollBarImageColor3")
        
        local elements = library:create("Frame", {
            Parent = scrolling_frame,
            BackgroundTransparency = 1,
            Position = dim2(0, 8, 0, 10),
            AutomaticSize = Enum.AutomaticSize.Y,
            BorderColor3 = rgb(0, 0, 0),
            Size = dim2(1, -12, 0, 0),
            BorderSizePixel = 0,
            BackgroundColor3 = rgb(255, 255, 255)
        })
        cfg.elements = elements
        
        library:create("UIListLayout", {
            Parent = elements,
            Padding = dim(0, 5),
            SortOrder = Enum.SortOrder.LayoutOrder
        })
        
        local scrollbar_fill = library:create("Frame", {
            Visible = true,
            BorderColor3 = rgb(0, 0, 0),
            AnchorPoint = vec2(1, 0),
            Position = dim2(1, 0, 0, 0),
            Parent = e,
            Size = dim2(0, 3, 1, 0),
            BorderSizePixel = 0,
            ZIndex = -1,
            BackgroundColor3 = themes.preset.c
        })
        library:apply_theme(scrollbar_fill, "c", "BackgroundColor3")
        
        library:create("UIPadding", {
            PaddingBottom = dim(0, 15),
            Parent = scrolling_frame
        })

        scrolling_frame:GetPropertyChangedSignal("AbsoluteCanvasSize"):Connect(function()
            local is_scrollbar_visible = scrolling_frame.AbsoluteCanvasSize.Y < elements.AbsoluteSize.Y + 26
            scrollbar_fill.Visible = is_scrollbar_visible
        end)

        return setmetatable(cfg, library)
    end 

    -- LABEL
    function library:label(options)
        local cfg = {name = options.name or "Label"}

        local label = library:create("TextButton", {
            FontFace = library.font,
            TextColor3 = rgb(0, 0, 0),
            BorderColor3 = rgb(0, 0, 0),
            Text = "",
            Parent = self.elements,
            BackgroundTransparency = 1,
            Size = dim2(1, 0, 0, 10),
            BorderSizePixel = 0,
            TextSize = 14,
            BackgroundColor3 = rgb(255, 255, 255)
        })
        
        local label_text = library:create("TextLabel", {
            FontFace = library.font,
            TextColor3 = rgb(255, 255, 255),
            BorderColor3 = rgb(0, 0, 0),
            Text = cfg.name,
            Parent = label,
            AutomaticSize = Enum.AutomaticSize.XY,
            Position = dim2(0, 9, 0, -1),
            BackgroundTransparency = 1,
            TextXAlignment = Enum.TextXAlignment.Left,
            BorderSizePixel = 0,
            ZIndex = 2,
            TextSize = 12,
            BackgroundColor3 = rgb(255, 255, 255)
        })
        cfg.label_text = label_text
        
        local right_components = library:create("Frame", {
            Parent = label,
            Position = dim2(1, -7, 0, 0),
            BorderColor3 = rgb(0, 0, 0),
            Size = dim2(0, 0, 1, 0),
            BorderSizePixel = 0,
            BackgroundColor3 = rgb(255, 255, 255),
            BackgroundTransparency = 1,
        })
        cfg.right_components = right_components
        
        library:create("UIListLayout", {
            Parent = right_components,
            Padding = dim(0, 4),
            FillDirection = Enum.FillDirection.Horizontal,
            HorizontalAlignment = Enum.HorizontalAlignment.Right,
            SortOrder = Enum.SortOrder.LayoutOrder
        })

        function cfg:set_text(text)
            label_text.Text = text
        end
        
        return setmetatable(cfg, library)
    end 

    -- TOGGLE
    function library:toggle(options) 
        local cfg = {
            enabled = options.enabled or options.default or false,
            name = options.name or "Toggle",
            flag = options.flag or tostring(random(1, 9999999)),
            default = options.value or options.default or false,
            folding = options.folding or false, 
            callback = options.callback or function() end,
        }

        local toggle = library:create("TextButton", {
            FontFace = library.font,
            TextColor3 = rgb(0, 0, 0),
            BorderColor3 = rgb(0, 0, 0),
            Text = "",
            Parent = self.elements,
            BackgroundTransparency = 1,
            Size = dim2(1, 0, 0, 10),
            BorderSizePixel = 0,
            TextSize = 14,
            BackgroundColor3 = rgb(255, 255, 255)
        })
        
        local d = library:create("Frame", {
            Parent = toggle,
            Position = dim2(0, -1, 0, 0),
            BorderColor3 = rgb(0, 0, 0),
            Size = dim2(0, 10, 0, 10),
            BorderSizePixel = 0,
            BackgroundColor3 = themes.preset.d
        })
        library:apply_theme(d, "d", "BackgroundColor3")
        
        local f = library:create("Frame", {
            Parent = d,
            Position = dim2(0, 1, 0, 1),
            BorderColor3 = rgb(0, 0, 0),
            Size = dim2(1, -2, 1, -2),
            BorderSizePixel = 0,
            BackgroundColor3 = themes.preset.f
        })
        library:apply_theme(f, "f", "BackgroundColor3")
        
        library:create("TextLabel", {
            FontFace = library.font,
            TextColor3 = rgb(255, 255, 255),
            BorderColor3 = rgb(0, 0, 0),
            Text = cfg.name,
            Parent = toggle,
            AutomaticSize = Enum.AutomaticSize.XY,
            Position = dim2(0, 15, 0, -1),
            BackgroundTransparency = 1,
            TextXAlignment = Enum.TextXAlignment.Left,
            BorderSizePixel = 0,
            ZIndex = 2,
            TextSize = 12,
            BackgroundColor3 = rgb(255, 255, 255)
        })
        
        local right_components = library:create("Frame", {
            Parent = toggle,
            Position = dim2(1, -7, 0, 0),
            BorderColor3 = rgb(0, 0, 0),
            Size = dim2(0, 0, 1, 0),
            BorderSizePixel = 0,
            BackgroundColor3 = rgb(255, 255, 255),
            BackgroundTransparency = 1,
        })
        cfg.right_components = right_components
        
        library:create("UIListLayout", {
            Parent = right_components,
            Padding = dim(0, 4),
            FillDirection = Enum.FillDirection.Horizontal,
            HorizontalAlignment = Enum.HorizontalAlignment.Right,
            SortOrder = Enum.SortOrder.LayoutOrder
        })

        local elements
        if cfg.folding then
            elements = library:create("Frame", {
                Parent = self.elements,
                BackgroundTransparency = 1,
                Position = dim2(0, 4, 0, 21),
                Size = dim2(1, 0, 0, 0),
                BorderSizePixel = 0,
                AutomaticSize = Enum.AutomaticSize.Y,
                BackgroundColor3 = rgb(255, 255, 255)
            })
            cfg.elements = elements
            
            library:create("UIListLayout", {
                Parent = elements,
                Padding = dim(0, 7),
                HorizontalAlignment = Enum.HorizontalAlignment.Right,
                SortOrder = Enum.SortOrder.LayoutOrder
            })
        end

        function cfg.set(bool)
            cfg.enabled = bool
            f.BackgroundColor3 = bool and themes.preset.accent or themes.preset.f
            flags[cfg.flag] = bool
            cfg.callback(bool)
            if cfg.folding and elements then
                elements.Visible = bool
            end
        end

        cfg.set(cfg.default)
        config_flags[cfg.flag] = cfg.set
        library.options[cfg.flag] = cfg

        toggle.MouseButton1Click:Connect(function()
            cfg.enabled = not cfg.enabled
            cfg.set(cfg.enabled)
        end)
        
        return setmetatable(cfg, library)
    end 

    -- SLIDER
    function library:slider(options) 
        local cfg = {
            name = options.name or "Slider",
            suffix = options.suffix or "",
            flag = options.flag or tostring(random(1, 9999999)),
            callback = options.callback or function() end,
            min = tonumber(options.min) or tonumber(options.minimum) or 0,
            max = tonumber(options.max) or tonumber(options.maximum) or 100,
            intervals = tonumber(options.interval) or tonumber(options.decimal) or 1,
            default = tonumber(options.value) or tonumber(options.default) or 0,
            custom = options.custom or {},
            ignore = options.ignore or false,
            dragging = false,
        }

        if cfg.max == nil or cfg.max == 0 then cfg.max = 100 end
        if cfg.min == nil then cfg.min = 0 end
        if cfg.default == nil then cfg.default = cfg.min end
        if cfg.intervals == nil or cfg.intervals == 0 then cfg.intervals = 1 end
        
        cfg.default = clamp(cfg.default, cfg.min, cfg.max)
        cfg.value = cfg.default

        local object = library:create("TextButton", {
            FontFace = library.font,
            TextColor3 = rgb(0, 0, 0),
            BorderColor3 = rgb(0, 0, 0),
            Text = "",
            Parent = self.elements,
            BackgroundTransparency = 1,
            Size = dim2(1, 0, 0, 32),
            BorderSizePixel = 0,
            TextSize = 14,
            BackgroundColor3 = rgb(255, 255, 255)
        })
        
        library:create("TextLabel", {
            FontFace = library.font,
            TextColor3 = rgb(255, 255, 255),
            BorderColor3 = rgb(0, 0, 0),
            Text = cfg.name,
            Parent = object,
            AutomaticSize = Enum.AutomaticSize.XY,
            Position = dim2(0, 8, 0, 0),
            BackgroundTransparency = 1,
            TextXAlignment = Enum.TextXAlignment.Left,
            BorderSizePixel = 0,
            ZIndex = 2,
            TextSize = 12,
            BackgroundColor3 = rgb(255, 255, 255)
        })
        
        local slider_frame = library:create("TextButton", {
            Parent = object,
            Position = dim2(0, 8, 0, 16),
            BorderColor3 = rgb(0, 0, 0),
            Size = dim2(1, -14, 0, 8),
            AutoButtonColor = false,
            Text = "",
            BorderSizePixel = 0,
            BackgroundColor3 = themes.preset.d
        })
        library:apply_theme(slider_frame, "d", "BackgroundColor3")
        
        local background = library:create("Frame", {
            Parent = slider_frame,
            Position = dim2(0, 1, 0, 1),
            BorderColor3 = rgb(0, 0, 0),
            Size = dim2(1, -2, 1, -2),
            BorderSizePixel = 0,
            BackgroundColor3 = themes.preset.b
        })
        library:apply_theme(background, "b", "BackgroundColor3")
        
        local fill = library:create("Frame", {
            Parent = background,
            BorderColor3 = rgb(0, 0, 0),
            Size = dim2(0.5, 0, 1, 0),
            BorderSizePixel = 0,
            BackgroundColor3 = themes.preset.accent
        })
        library:apply_theme(fill, "accent", "BackgroundColor3")
        
        local output = library:create("TextLabel", {
            FontFace = library.font,
            Parent = fill,
            TextColor3 = rgb(255, 255, 255),
            BorderColor3 = rgb(0, 0, 0),
            Text = "0",
            AutomaticSize = Enum.AutomaticSize.XY,
            AnchorPoint = vec2(0.5, 0),
            Position = dim2(1, 0, 1, -1),
            BackgroundTransparency = 1,
            TextXAlignment = Enum.TextXAlignment.Left,
            BorderSizePixel = 0,
            ZIndex = 2,
            TextSize = 12,
            BackgroundColor3 = rgb(255, 255, 255)
        })
        
        local plus = library:create("ImageButton", {
            BorderColor3 = rgb(0, 0, 0),
            Parent = slider_frame,
            Image = "rbxassetid://126987373762224",
            BackgroundTransparency = 1,
            Position = dim2(1, -3, 0, 2),
            Size = dim2(0, 5, 0, 5),
            BorderSizePixel = 0,
            BackgroundColor3 = rgb(255, 255, 255)
        })
        
        local minus = library:create("ImageButton", {
            AnchorPoint = vec2(1, 0),
            Parent = slider_frame,
            Position = dim2(0, -3, 0, 4),
            BorderColor3 = rgb(0, 0, 0),
            Size = dim2(0, 5, 0, 1),
            BorderSizePixel = 0,
            BackgroundColor3 = rgb(255, 255, 255)
        })

        function cfg.set(value)
            local numValue = tonumber(value)
            if numValue == nil then return end

            local minVal = cfg.min or 0
            local maxVal = cfg.max or 100
            local intervalVal = cfg.intervals or 1

            cfg.value = clamp(library:round(numValue, intervalVal), minVal, maxVal)

            local range = maxVal - minVal
            if range == 0 then range = 1 end
            
            fill.Size = dim2((cfg.value - minVal) / range, 0, 1, 0)
            
            local displayText = tostring(cfg.value) .. cfg.suffix
            if cfg.custom and cfg.custom[tostring(cfg.value)] then
                displayText = cfg.custom[tostring(cfg.value)]
            end
            output.Text = displayText
            
            flags[cfg.flag] = cfg.value
            cfg.callback(flags[cfg.flag])
        end

        cfg.set(cfg.default)
        config_flags[cfg.flag] = cfg.set
        library.options[cfg.flag] = cfg

        slider_frame.MouseButton1Down:Connect(function()
            cfg.dragging = true
        end)

        minus.MouseButton1Down:Connect(function()
            local newValue = (cfg.value or cfg.default or 0) - (cfg.intervals or 1)
            cfg.set(newValue)
        end)

        plus.MouseButton1Down:Connect(function()
            local newValue = (cfg.value or cfg.default or 0) + (cfg.intervals or 1)
            cfg.set(newValue)
        end)

        library:connection(uis.InputChanged, function(input)
            if cfg.dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
                local size_x = (input.Position.X - slider_frame.AbsolutePosition.X) / slider_frame.AbsoluteSize.X
                local minVal = cfg.min or 0
                local maxVal = cfg.max or 100
                local value = ((maxVal - minVal) * size_x) + minVal
                cfg.set(value)
            end
        end)

        library:connection(uis.InputEnded, function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 then
                cfg.dragging = false
            end
        end)

        return setmetatable(cfg, library)
    end

    -- DROPDOWN
    function library:dropdown(options)
        local cfg = {
            name = options.name or "Dropdown",
            flag = options.flag or tostring(random(1, 9999999)),
            items = options.items or {"None"},
            callback = options.callback or function() end,
            multi = options.multi or false,
            open = false,
            option_instances = {},
            multi_items = {},
            ignore = options.ignore or false,
        }

        cfg.default = options.value or options.default or (cfg.multi and {cfg.items[1]}) or cfg.items[1] or "None"
        flags[cfg.flag] = {}

        local object = library:create("TextButton", {
            FontFace = library.font,
            TextColor3 = rgb(0, 0, 0),
            BorderColor3 = rgb(0, 0, 0),
            Text = "",
            Parent = self.elements,
            BackgroundTransparency = 1,
            Size = dim2(1, 0, 0, 35),
            BorderSizePixel = 0,
            TextSize = 14,
            BackgroundColor3 = rgb(255, 255, 255)
        })
        
        library:create("TextLabel", {
            FontFace = library.font,
            TextColor3 = rgb(255, 255, 255),
            BorderColor3 = rgb(0, 0, 0),
            Text = cfg.name,
            Parent = object,
            AutomaticSize = Enum.AutomaticSize.XY,
            Position = dim2(0, 8, 0, 2),
            BackgroundTransparency = 1,
            TextXAlignment = Enum.TextXAlignment.Left,
            BorderSizePixel = 0,
            ZIndex = 2,
            TextSize = 12,
            BackgroundColor3 = rgb(255, 255, 255)
        })
        
        local dropdown_holder = library:create("TextButton", {
            Parent = object,
            Text = "",
            Position = dim2(0, 8, 0, 17),
            BorderColor3 = rgb(0, 0, 0),
            Size = dim2(1, -14, 0, 18),
            BorderSizePixel = 0,
            BackgroundColor3 = themes.preset.d
        })
        library:apply_theme(dropdown_holder, "d", "BackgroundColor3")
        
        local inline = library:create("Frame", {
            Parent = dropdown_holder,
            Position = dim2(0, 1, 0, 1),
            BorderColor3 = rgb(0, 0, 0),
            Size = dim2(1, -2, 1, -2),
            BorderSizePixel = 0,
            BackgroundColor3 = themes.preset.c
        })
        library:apply_theme(inline, "c", "BackgroundColor3")
        
        local text = library:create("TextLabel", {
            FontFace = library.font,
            Parent = inline,
            TextColor3 = rgb(255, 255, 255),
            BorderColor3 = rgb(0, 0, 0),
            Text = tostring(cfg.default) or "None",
            AutomaticSize = Enum.AutomaticSize.XY,
            Size = dim2(1, -4, 1, 0),
            Position = dim2(0, 4, 0, -1),
            BackgroundTransparency = 1,
            TextXAlignment = Enum.TextXAlignment.Left,
            BorderSizePixel = 0,
            ZIndex = 2,
            TextSize = 12,
            BackgroundColor3 = rgb(255, 255, 255)
        })
        
        local plus = library:create("ImageLabel", {
            BorderColor3 = rgb(0, 0, 0),
            AnchorPoint = vec2(1, 0),
            Image = "rbxassetid://126987373762224",
            BackgroundTransparency = 1,
            Position = dim2(1, -4, 0, 6),
            Parent = inline,
            Size = dim2(0, 5, 0, 5),
            BorderSizePixel = 0,
            BackgroundColor3 = rgb(255, 255, 255)
        })

        local items = library:create("Frame", {
            Parent = library.gui,
            Visible = false,
            Size = dim2(0.09, 0, 0.006, 20),
            Position = dim2(0, 500, 0, 100),
            BorderColor3 = rgb(0, 0, 0),
            BorderSizePixel = 0,
            AutomaticSize = Enum.AutomaticSize.Y,
            BackgroundColor3 = themes.preset.d,
            ZIndex = 50,
        })
        library:apply_theme(items, "d", "BackgroundColor3")
        
        local holder_items = library:create("Frame", {
            Parent = items,
            Size = dim2(1, -2, 1, -2),
            Position = dim2(0, 1, 0, 1),
            BorderColor3 = rgb(0, 0, 0),
            BorderSizePixel = 0,
            AutomaticSize = Enum.AutomaticSize.Y,
            BackgroundColor3 = themes.preset.c,
            ZIndex = 50,
        })
        library:apply_theme(holder_items, "c", "BackgroundColor3")
        
        library:create("UIListLayout", {
            Parent = holder_items,
            Padding = dim(0, 6),
            SortOrder = Enum.SortOrder.LayoutOrder
        })
        
        library:create("UIPadding", {
            PaddingTop = dim(0, 5),
            PaddingBottom = dim(0, 6),
            Parent = holder_items,
            PaddingRight = dim(0, 6),
            PaddingLeft = dim(0, 6)
        })
        
        library:create("UIPadding", {
            PaddingBottom = dim(0, 2),
            Parent = items
        })

        function cfg.render_option(optionText)
            local option = library:create("TextButton", {
                FontFace = library.font,
                TextColor3 = rgb(255, 255, 255),
                BorderColor3 = rgb(0, 0, 0),
                Text = optionText,
                Parent = holder_items,
                Size = dim2(1, 0, 0, 0),
                Position = dim2(0, 0, 0, 1),
                BackgroundTransparency = 1,
                TextXAlignment = Enum.TextXAlignment.Left,
                BorderSizePixel = 0,
                AutomaticSize = Enum.AutomaticSize.Y,
                TextSize = 12,
                BackgroundColor3 = rgb(255, 255, 255),
                ZIndex = 51,
            })
            return option
        end
        
        function cfg.set_visible(bool)
            items.Visible = bool
            plus.Image = bool and "rbxassetid://0" or "rbxassetid://126987373762224"
            plus.Position = bool and dim2(1, -4, 0, 9) or dim2(1, -4, 0, 6)
            plus.Size = bool and dim2(0, 5, 0, 1) or dim2(0, 5, 0, 5)
            plus.BackgroundTransparency = bool and 0 or 1
        end
        
        function cfg.set(value)
            local selected = {}
            local isTable = type(value) == "table"

            if value == nil then return end

            for _, option in next, cfg.option_instances do
                if option.Text == value or (isTable and find(value, option.Text)) then
                    insert(selected, option.Text)
                    cfg.multi_items = selected
                    option.TextColor3 = themes.preset.accent
                else
                    option.TextColor3 = themes.preset.text
                end
            end

            text.Text = isTable and concat(selected, ", ") or (selected[1] or tostring(value))
            flags[cfg.flag] = isTable and selected or selected[1]
            cfg.callback(flags[cfg.flag])
        end
        
        function cfg.refresh_options(list)
            for _, option in next, cfg.option_instances do
                option:Destroy()
            end
            
            cfg.option_instances = {}
            cfg.items = list

            for _, optionName in next, list do
                local button = cfg.render_option(optionName)
                insert(cfg.option_instances, button)
                
                button.MouseButton1Down:Connect(function()
                    if cfg.multi then
                        local selected_index = find(cfg.multi_items, button.Text)
                        if selected_index then
                            remove(cfg.multi_items, selected_index)
                        else
                            insert(cfg.multi_items, button.Text)
                        end
                        cfg.set(cfg.multi_items)
                    else
                        cfg.set_visible(false)
                        cfg.open = false
                        cfg.set(button.Text)
                    end
                end)
            end
        end
        
        function cfg.set_items(list)
            cfg.refresh_options(list)
        end

        cfg.refresh_options(cfg.items)
        cfg.set(cfg.default)
        config_flags[cfg.flag] = cfg.set
        library.options[cfg.flag] = cfg

        dropdown_holder.MouseButton1Click:Connect(function()
            cfg.open = not cfg.open
            items.Size = dim2(0, dropdown_holder.AbsoluteSize.X, 0, items.Size.Y.Offset)
            items.Position = dim2(0, dropdown_holder.AbsolutePosition.X, 0, dropdown_holder.AbsolutePosition.Y + 80)
            cfg.set_visible(cfg.open)
        end)
        
        library:connection(uis.InputEnded, function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 then
                if not (library:mouse_in_frame(items) or library:mouse_in_frame(dropdown_holder)) then
                    cfg.open = false
                    cfg.set_visible(false)
                end
            end
        end)

        return setmetatable(cfg, library)
    end

    -- TEXTBOX
    function library:textbox(options)
        local cfg = {
            name = options.name or "Textbox",
            placeholder = options.placeholder or options.placeholdertext or "type here...",
            default = options.value or options.default or "",
            flag = options.flag or tostring(random(1, 9999999)),
            callback = options.callback or function() end,
        }

        local textbox_holder = library:create("Frame", {
            Parent = self.elements,
            Position = dim2(0, 0, 0, 0),
            BorderColor3 = rgb(0, 0, 0),
            Size = dim2(1, 0, 0, 32),
            BorderSizePixel = 0,
            BackgroundTransparency = 1,
            BackgroundColor3 = themes.preset.d
        })
        
        library:create("TextLabel", {
            FontFace = library.font,
            TextColor3 = rgb(255, 255, 255),
            BorderColor3 = rgb(0, 0, 0),
            Text = cfg.name,
            Parent = textbox_holder,
            AutomaticSize = Enum.AutomaticSize.XY,
            Position = dim2(0, 8, 0, 2),
            BackgroundTransparency = 1,
            TextXAlignment = Enum.TextXAlignment.Left,
            BorderSizePixel = 0,
            ZIndex = 2,
            TextSize = 12,
            BackgroundColor3 = rgb(255, 255, 255)
        })

        local textbox = library:create("Frame", {
            Parent = textbox_holder,
            Position = dim2(0, 8, 0, 16),
            BorderColor3 = rgb(0, 0, 0),
            Size = dim2(1, -14, 0, 18),
            BorderSizePixel = 0,
            BackgroundColor3 = themes.preset.d
        })
        library:apply_theme(textbox, "d", "BackgroundColor3")

        local tb_inline = library:create("Frame", {
            Parent = textbox,
            Position = dim2(0, 1, 0, 1),
            BorderColor3 = rgb(0, 0, 0),
            Size = dim2(1, -2, 1, -2),
            BorderSizePixel = 0,
            BackgroundColor3 = themes.preset.c
        })
        library:apply_theme(tb_inline, "c", "BackgroundColor3")

        local input = library:create("TextBox", {
            FontFace = library.font,
            TextColor3 = rgb(255, 255, 255),
            BorderColor3 = rgb(0, 0, 0),
            Text = "",
            PlaceholderText = cfg.placeholder,
            Parent = tb_inline,
            BackgroundTransparency = 1,
            PlaceholderColor3 = rgb(170, 170, 170),
            Size = dim2(1, -8, 1, 0),
            Position = dim2(0, 4, 0, 0),
            BorderSizePixel = 0,
            TextSize = 12,
            TextXAlignment = Enum.TextXAlignment.Left,
            ClearTextOnFocus = false,
            BackgroundColor3 = rgb(255, 255, 255)
        })

        function cfg.set(txt)
            flags[cfg.flag] = txt
            input.Text = txt
            cfg.callback(txt)
        end
        
        function cfg.get()
            return input.Text
        end
        
        config_flags[cfg.flag] = cfg.set
        library.options[cfg.flag] = cfg

        if cfg.default and cfg.default ~= "" then
            cfg.set(cfg.default)
        end

        input.FocusLost:Connect(function()
            flags[cfg.flag] = input.Text
            cfg.callback(input.Text)
        end)
        
        return setmetatable(cfg, library)
    end

    -- BUTTON
    function library:button(options)
        local cfg = {
            name = options.name or "Button",
            callback = options.callback or function() end,
        }

        local button_holder = library:create("Frame", {
            Parent = self.elements,
            Position = dim2(0, 0, 0, 0),
            BorderColor3 = rgb(0, 0, 0),
            Size = dim2(1, 0, 0, 20),
            BorderSizePixel = 0,
            BackgroundTransparency = 1,
            BackgroundColor3 = themes.preset.d
        })

        local button = library:create("TextButton", {
            Parent = button_holder,
            Text = "",
            Position = dim2(0, 8, 0, 0),
            BorderColor3 = rgb(0, 0, 0),
            Size = dim2(1, -14, 1, 0),
            BorderSizePixel = 0,
            BackgroundColor3 = themes.preset.d
        })
        library:apply_theme(button, "d", "BackgroundColor3")
        
        local btn_inline = library:create("Frame", {
            Parent = button,
            Position = dim2(0, 1, 0, 1),
            BorderColor3 = rgb(0, 0, 0),
            Size = dim2(1, -2, 1, -2),
            BorderSizePixel = 0,
            BackgroundColor3 = themes.preset.c
        })
        library:apply_theme(btn_inline, "c", "BackgroundColor3")
        
        library:create("TextLabel", {
            FontFace = library.font,
            TextColor3 = rgb(255, 255, 255),
            BorderColor3 = rgb(0, 0, 0),
            Text = cfg.name,
            Parent = btn_inline,
            BackgroundTransparency = 1,
            Size = dim2(1, 0, 1, 0),
            Position = dim2(0, 0, 0, -1),
            BorderSizePixel = 0,
            TextSize = 12,
            BackgroundColor3 = rgb(255, 255, 255)
        })

        button.MouseButton1Click:Connect(function()
            local originalColor = btn_inline.BackgroundColor3
            btn_inline.BackgroundColor3 = themes.preset.accent
            task.delay(0.1, function()
                btn_inline.BackgroundColor3 = themes.preset.c
            end)
            cfg.callback()
        end)
        
        return setmetatable(cfg, library)
    end

    -- COLORPICKER
    function library:colorpicker(options)
        local cfg = {
            name = options.name or "Color",
            flag = options.flag or tostring(random(1, 9999999)),
            color = options.color or color(1, 1, 1),
            alpha = options.alpha and 1 - options.alpha or 0,
            open = false,
            callback = options.callback or function() end,
        }

        if not self.right_components then
            cfg.label = self:label({name = cfg.name})
        end

        local colorpicker_element = library:create("TextButton", {
            Parent = self.right_components or cfg.label.right_components,
            BorderColor3 = rgb(0, 0, 0),
            Size = dim2(0, 24, 0, 12),
            Text = "",
            AutoButtonColor = false,
            BorderSizePixel = 0,
            BackgroundColor3 = themes.preset.d
        })
        library:apply_theme(colorpicker_element, "d", "BackgroundColor3")
        
        local colorpicker_element_color = library:create("Frame", {
            Parent = colorpicker_element,
            Position = dim2(0, 1, 0, 1),
            BorderColor3 = rgb(0, 0, 0),
            Size = dim2(1, -2, 1, -2),
            BorderSizePixel = 0,
            BackgroundColor3 = cfg.color
        })
        
        library:create("UIGradient", {
            Rotation = 90,
            Parent = colorpicker_element_color,
            Color = rgbseq{rgbkey(0, rgb(255, 255, 255)), rgbkey(1, rgb(182, 182, 182))}
        })

        local colorpicker = library:create("Frame", {
            Parent = library.gui,
            Position = dim2(0.68, 0, 0.24, 0),
            BorderColor3 = rgb(0, 0, 0),
            Visible = false,
            Size = dim2(0, 231, 0, 209),
            BorderSizePixel = 0,
            BackgroundColor3 = themes.preset.c,
            ZIndex = 100,
        })
        library:apply_theme(colorpicker, "c", "BackgroundColor3")
        
        local cp_e = library:create("Frame", {
            Parent = colorpicker,
            Position = dim2(0, 1, 0, 1),
            BorderColor3 = rgb(0, 0, 0),
            Size = dim2(1, -2, 1, -2),
            BorderSizePixel = 0,
            BackgroundColor3 = themes.preset.e,
            ZIndex = 100,
        })
        library:apply_theme(cp_e, "e", "BackgroundColor3")
        
        library:create("UIPadding", {
            PaddingTop = dim(0, 7),
            PaddingBottom = dim(0, -13),
            Parent = cp_e,
            PaddingRight = dim(0, 6),
            PaddingLeft = dim(0, 7)
        })
        
        local textbox_frame = library:create("Frame", {
            Parent = cp_e,
            Position = dim2(0, 0, 1, -36),
            BorderColor3 = rgb(0, 0, 0),
            Size = dim2(1, -1, 0, 16),
            BorderSizePixel = 0,
            BackgroundColor3 = themes.preset.d,
            ZIndex = 100,
        })
        library:apply_theme(textbox_frame, "d", "BackgroundColor3")
        
        local cp_b = library:create("Frame", {
            Parent = textbox_frame,
            Position = dim2(0, 1, 0, 1),
            BorderColor3 = rgb(0, 0, 0),
            Size = dim2(1, -2, 1, -2),
            BorderSizePixel = 0,
            BackgroundColor3 = themes.preset.b,
            ZIndex = 100,
        })
        library:apply_theme(cp_b, "b", "BackgroundColor3")
        
        local cp_textbox = library:create("TextBox", {
            FontFace = library.font,
            TextColor3 = rgb(255, 255, 255),
            BorderColor3 = rgb(0, 0, 0),
            Text = "",
            Parent = cp_b,
            BackgroundTransparency = 1,
            ClearTextOnFocus = false,
            PlaceholderColor3 = rgb(255, 255, 255),
            Size = dim2(1, 0, 1, 0),
            BorderSizePixel = 0,
            TextSize = 12,
            BackgroundColor3 = rgb(255, 255, 255),
            TextXAlignment = Enum.TextXAlignment.Center,
            ZIndex = 100,
        })

        local hue_button = library:create("TextButton", {
            AnchorPoint = vec2(1, 0),
            Text = "",
            AutoButtonColor = false,
            Parent = cp_e,
            Position = dim2(1, -1, 0, 0),
            BorderColor3 = rgb(0, 0, 0),
            Size = dim2(0, 14, 1, -60),
            BorderSizePixel = 0,
            BackgroundColor3 = themes.preset.d,
            ZIndex = 100,
        })
        library:apply_theme(hue_button, "d", "BackgroundColor3")
        
        local hue_drag = library:create("Frame", {
            Parent = hue_button,
            Position = dim2(0, 1, 0, 1),
            BorderColor3 = rgb(0, 0, 0),
            Size = dim2(1, -2, 1, -2),
            BorderSizePixel = 0,
            BackgroundColor3 = rgb(255, 255, 255),
            ZIndex = 100,
        })
        
        library:create("UIGradient", {
            Rotation = 90,
            Parent = hue_drag,
            Color = rgbseq{rgbkey(0, rgb(255, 0, 0)), rgbkey(0.17, rgb(255, 255, 0)), rgbkey(0.33, rgb(0, 255, 0)), rgbkey(0.5, rgb(0, 255, 255)), rgbkey(0.67, rgb(0, 0, 255)), rgbkey(0.83, rgb(255, 0, 255)), rgbkey(1, rgb(255, 0, 0))}
        })
        
        local hue_picker = library:create("Frame", {
            Parent = hue_drag,
            BorderMode = Enum.BorderMode.Inset,
            BorderColor3 = rgb(0, 0, 0),
            Size = dim2(1, 2, 0, 3),
            Position = dim2(0, -1, 0, -1),
            BackgroundColor3 = rgb(255, 255, 255),
            ZIndex = 100,
        })
        
        local alpha_button = library:create("TextButton", {
            AnchorPoint = vec2(0, 0.5),
            Text = "",
            AutoButtonColor = false,
            Parent = cp_e,
            Position = dim2(0, 0, 1, -48),
            BorderColor3 = rgb(0, 0, 0),
            Size = dim2(1, -1, 0, 14),
            BorderSizePixel = 0,
            BackgroundColor3 = themes.preset.d,
            ZIndex = 100,
        })
        library:apply_theme(alpha_button, "d", "BackgroundColor3")
        
        local alpha_color = library:create("Frame", {
            Parent = alpha_button,
            Position = dim2(0, 1, 0, 1),
            BorderColor3 = rgb(0, 0, 0),
            Size = dim2(1, -2, 1, -2),
            BorderSizePixel = 0,
            BackgroundColor3 = rgb(0, 221, 255),
            ZIndex = 100,
        })
        
        local alphaind = library:create("ImageLabel", {
            ScaleType = Enum.ScaleType.Tile,
            BorderColor3 = rgb(0, 0, 0),
            Parent = alpha_color,
            Image = "rbxassetid://18274452449",
            BackgroundTransparency = 1,
            Size = dim2(1, 0, 1, 0),
            TileSize = dim2(0, 4, 0, 4),
            BorderSizePixel = 0,
            BackgroundColor3 = rgb(255, 255, 255),
            ZIndex = 100,
        })
        
        library:create("UIGradient", {
            Parent = alphaind,
            Transparency = numseq{numkey(0, 0), numkey(1, 1)}
        })
        
        local alpha_picker = library:create("Frame", {
            Parent = alpha_color,
            BorderMode = Enum.BorderMode.Inset,
            BorderColor3 = rgb(0, 0, 0),
            Size = dim2(0, 3, 1, 2),
            Position = dim2(0, -1, 0, -1),
            BackgroundColor3 = rgb(255, 255, 255),
            ZIndex = 100,
        })
        
        local saturation_value_button = library:create("TextButton", {
            Parent = cp_e,
            BorderColor3 = rgb(0, 0, 0),
            Size = dim2(1, -20, 1, -60),
            Text = "",
            AutoButtonColor = false,
            BorderSizePixel = 0,
            BackgroundColor3 = themes.preset.d,
            ZIndex = 100,
        })
        library:apply_theme(saturation_value_button, "d", "BackgroundColor3")
        
        local colorpicker_color = library:create("Frame", {
            Parent = saturation_value_button,
            Position = dim2(0, 1, 0, 1),
            BorderColor3 = rgb(0, 0, 0),
            Size = dim2(1, -2, 1, -2),
            BorderSizePixel = 0,
            BackgroundColor3 = rgb(0, 221, 255),
            ZIndex = 100,
        })
        
        local val = library:create("TextButton", {
            Parent = colorpicker_color,
            Text = "",
            AutoButtonColor = false,
            BorderColor3 = rgb(0, 0, 0),
            Size = dim2(1, 0, 1, 0),
            BorderSizePixel = 0,
            BackgroundColor3 = rgb(255, 255, 255),
            ZIndex = 100,
        })
        
        library:create("UIGradient", {
            Parent = val,
            Transparency = numseq{numkey(0, 0), numkey(1, 1)}
        })
        
        local saturation_value_picker = library:create("Frame", {
            Parent = colorpicker_color,
            BorderColor3 = rgb(0, 0, 0),
            Size = dim2(0, 3, 0, 3),
            BorderSizePixel = 0,
            BackgroundColor3 = rgb(0, 0, 0),
            ZIndex = 100,
        })
        
        library:create("Frame", {
            Parent = saturation_value_picker,
            Position = dim2(0, 1, 0, 1),
            BorderColor3 = rgb(0, 0, 0),
            Size = dim2(1, -2, 1, -2),
            BorderSizePixel = 0,
            BackgroundColor3 = rgb(255, 255, 255),
            ZIndex = 100,
        })
        
        local saturation_button = library:create("TextButton", {
            Parent = colorpicker_color,
            Text = "",
            AutoButtonColor = false,
            Size = dim2(1, 0, 1, 0),
            BorderColor3 = rgb(0, 0, 0),
            ZIndex = 101,
            BorderSizePixel = 0,
            BackgroundColor3 = rgb(255, 255, 255)
        })
        
        library:create("UIGradient", {
            Rotation = 270,
            Transparency = numseq{numkey(0, 0), numkey(1, 1)},
            Parent = saturation_button,
            Color = rgbseq{rgbkey(0, rgb(0, 0, 0)), rgbkey(1, rgb(0, 0, 0))}
        })

        local dragging_sat = false
        local dragging_hue = false
        local dragging_alpha = false

        local h, s, v = cfg.color:ToHSV()
        local a = cfg.alpha

        flags[cfg.flag] = {}

        function cfg.set_visible(bool)
            colorpicker.Visible = bool
            colorpicker.Position = dim_offset(colorpicker_element.AbsolutePosition.X, colorpicker_element.AbsolutePosition.Y + colorpicker_element.AbsoluteSize.Y + 65)
        end

        function cfg.set(colorValue, alpha)
            if colorValue then
                h, s, v = colorValue:ToHSV()
            end
            
            if alpha then
                a = alpha
            end
            
            local Color = Color3.fromHSV(h, s, v)
            
            hue_picker.Position = dim2(0, -1, 1 - h, -1)
            alpha_picker.Position = dim2(1 - a, -1, 0, -1)
            saturation_value_picker.Position = dim2(s, -1, 1 - v, -1)

            alpha_color.BackgroundColor3 = Color3.fromHSV(h, 1, 1)
            colorpicker_element_color.BackgroundColor3 = Color
            colorpicker_color.BackgroundColor3 = Color3.fromHSV(h, 1, 1)
            
            flags[cfg.flag] = {
                Color = Color,
                Transparency = a
            }
            
            local clr = colorpicker_element_color.BackgroundColor3
            cp_textbox.Text = string.format("%s, %s, %s, %s", library:round(clr.R * 255), library:round(clr.G * 255), library:round(clr.B * 255), library:round(1 - a, 0.01))
            
            cfg.callback(Color, a)
        end

        function cfg.update_color()
            local mousePos = uis:GetMouseLocation()
            local offset = vec2(mousePos.X, mousePos.Y - gui_offset)

            if dragging_sat then
                s = math.clamp((offset - saturation_value_button.AbsolutePosition).X / saturation_value_button.AbsoluteSize.X, 0, 1)
                v = 1 - math.clamp((offset - saturation_value_button.AbsolutePosition).Y / saturation_value_button.AbsoluteSize.Y, 0, 1)
            elseif dragging_hue then
                h = 1 - math.clamp((offset - hue_button.AbsolutePosition).Y / hue_button.AbsoluteSize.Y, 0, 1)
            elseif dragging_alpha then
                a = 1 - math.clamp((offset - alpha_button.AbsolutePosition).X / alpha_button.AbsoluteSize.X, 0, 1)
            end

            cfg.set(nil, nil)
        end

        cfg.set(cfg.color, cfg.alpha)
        config_flags[cfg.flag] = cfg.set
        library.options[cfg.flag] = cfg

        colorpicker_element.MouseButton1Click:Connect(function()
            cfg.open = not cfg.open
            cfg.set_visible(cfg.open)
        end)

        uis.InputChanged:Connect(function(input)
            if (dragging_sat or dragging_hue or dragging_alpha) and input.UserInputType == Enum.UserInputType.MouseMovement then
                cfg.update_color()
            end
        end)

        library:connection(uis.InputEnded, function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 then
                dragging_sat = false
                dragging_hue = false
                dragging_alpha = false

                if not (library:mouse_in_frame(colorpicker_element) or library:mouse_in_frame(colorpicker)) then
                    cfg.open = false
                    cfg.set_visible(false)
                end
            end
        end)

        alpha_button.MouseButton1Down:Connect(function()
            dragging_alpha = true
        end)
        
        hue_button.MouseButton1Down:Connect(function()
            dragging_hue = true
        end)
        
        saturation_button.MouseButton1Down:Connect(function()
            dragging_sat = true
        end)
        
        cp_textbox.FocusLost:Connect(function()
            local r, g, b, alpha_val = library:convert(cp_textbox.Text)
            if r and g and b and alpha_val then
                cfg.set(rgb(r, g, b), 1 - alpha_val)
            end
        end)

        return setmetatable(cfg, library)
    end

    -- KEYBIND
    function library:keybind(options)
        local cfg = {
            flag = options.flag or tostring(random(1, 9999999)),
            callback = options.callback or function() end,
            name = options.name or nil,
            ignore_key = options.ignore or false,
            key = options.key or options.default or nil,
            mode = options.mode or "Hold",
            active = options.active or false,
            hold_instances = {},
            open = false,
            binding = nil,
        }

        flags[cfg.flag] = {}

        if not self.right_components then
            cfg.label = self:label({name = cfg.name or "Keybind"})
        end

        local keybind_element = library:create("TextButton", {
            Parent = self.right_components or cfg.label.right_components,
            Size = dim2(0, 40, 0, 16),
            BorderColor3 = rgb(0, 0, 0),
            Text = "",
            AutoButtonColor = false,
            BorderSizePixel = 0,
            BackgroundColor3 = themes.preset.a
        })
        library:apply_theme(keybind_element, "a", "BackgroundColor3")
        
        local kb_b = library:create("Frame", {
            Parent = keybind_element,
            Size = dim2(1, -2, 1, -2),
            Position = dim2(0, 1, 0, 1),
            BorderColor3 = rgb(0, 0, 0),
            BorderSizePixel = 0,
            AutomaticSize = Enum.AutomaticSize.X,
            BackgroundColor3 = themes.preset.c
        })
        library:apply_theme(kb_b, "c", "BackgroundColor3")

        library:create("UIPadding", {
            PaddingRight = dim(0, 2),
            PaddingBottom = dim(0, 2),
            PaddingLeft = dim(0, 8),
            PaddingTop = dim(0, 4),
            Parent = kb_b
        })
        
        local toggle_text = library:create("TextLabel", {
            FontFace = library.font,
            TextColor3 = rgb(255, 255, 255),
            BorderColor3 = rgb(0, 0, 0),
            Text = " ... ",
            Parent = kb_b,
            Position = dim2(0, 0, 0, -1),
            BackgroundTransparency = 1,
            TextXAlignment = Enum.TextXAlignment.Left,
            BorderSizePixel = 0,
            ZIndex = 2,
            Size = dim2(1, 0, 1, 0),
            TextSize = 12,
            BackgroundColor3 = rgb(255, 255, 255)
        })
        
        library:create("UIPadding", {
            PaddingRight = dim(0, 2),
            Parent = keybind_element
        })

        local items = library:create("Frame", {
            Parent = library.gui,
            Selectable = true,
            Visible = false,
            Position = dim2(0, 500, 0, 100),
            BorderColor3 = rgb(0, 0, 0),
            BorderSizePixel = 0,
            AutomaticSize = Enum.AutomaticSize.XY,
            BackgroundColor3 = themes.preset.d,
            ZIndex = 100,
        })
        library:apply_theme(items, "d", "BackgroundColor3")
        
        local item_holder = library:create("Frame", {
            Parent = items,
            Size = dim2(1, -2, 1, -2),
            Position = dim2(0, 1, 0, 1),
            BorderColor3 = rgb(0, 0, 0),
            BorderSizePixel = 0,
            AutomaticSize = Enum.AutomaticSize.Y,
            BackgroundColor3 = themes.preset.b,
            ZIndex = 100,
        })
        library:apply_theme(item_holder, "b", "BackgroundColor3")
        
        library:create("UIListLayout", {
            Parent = item_holder,
            Padding = dim(0, 6),
            SortOrder = Enum.SortOrder.LayoutOrder
        })
        
        library:create("UIPadding", {
            PaddingTop = dim(0, 5),
            PaddingBottom = dim(0, 2),
            Parent = item_holder,
            PaddingRight = dim(0, 6),
            PaddingLeft = dim(0, 6)
        })
        
        library:create("UIPadding", {
            PaddingBottom = dim(0, 2),
            Parent = items
        })
        
        local modeOptions = {"Hold", "Toggle", "Always"}
        
        for _, v in modeOptions do
            local option = library:create("TextButton", {
                FontFace = library.font,
                TextColor3 = rgb(255, 255, 255),
                BorderColor3 = rgb(0, 0, 0),
                Text = v,
                Parent = item_holder,
                Position = dim2(0, 0, 0, 1),
                BackgroundTransparency = 1,
                TextXAlignment = Enum.TextXAlignment.Left,
                BorderSizePixel = 0,
                AutomaticSize = Enum.AutomaticSize.XY,
                TextSize = 12,
                BackgroundColor3 = rgb(255, 255, 255),
                ZIndex = 100,
            })
            cfg.hold_instances[v] = option

            option.MouseButton1Click:Connect(function()
                cfg.set(v)
                cfg.set_visible(false)
                cfg.open = false
            end)
        end

        local keybind_list_text
        if cfg.name then
            keybind_list_text = library:create("TextLabel", {
                FontFace = library.font,
                TextColor3 = rgb(255, 255, 255),
                BorderColor3 = rgb(0, 0, 0),
                Text = "[ ... ] " .. cfg.name .. ": hold",
                Parent = library.keybind_list,
                AutomaticSize = Enum.AutomaticSize.XY,
                Position = dim2(0, 18, 0, -3),
                BackgroundTransparency = 1,
                TextXAlignment = Enum.TextXAlignment.Left,
                BorderSizePixel = 0,
                ZIndex = 2,
                TextSize = 12,
                BackgroundColor3 = rgb(255, 255, 255),
                Visible = false,
            })
        end

        function cfg.modify_mode_color(path)
            for _, v in item_holder:GetChildren() do
                if v:IsA("TextButton") then
                    v.TextColor3 = themes.preset.text
                end
            end
            if cfg.hold_instances[path] then
                cfg.hold_instances[path].TextColor3 = themes.preset.accent
            end
        end

        function cfg.set_mode(mode)
            cfg.mode = mode
            if mode == "Always" then
                cfg.set(true)
            elseif mode == "Hold" then
                cfg.set(false)
            end
            flags[cfg.flag]["mode"] = mode
            cfg.modify_mode_color(mode)
        end

        function cfg.set(input)
            if type(input) == "boolean" then
                local __cached = input
                if cfg.mode == "Always" then
                    __cached = true
                end
                cfg.active = __cached
                cfg.callback(__cached)
            elseif tostring(input):find("Enum") then
                input = input.Name == "Escape" and "..." or input
                cfg.key = input or "..."
                cfg.callback(cfg.active or false)
            elseif find({"Toggle", "Hold", "Always"}, input) then
                cfg.set_mode(input)
                if input == "Always" then
                    cfg.active = true
                end
                cfg.callback(cfg.active or false)
            elseif type(input) == "table" then
                input.key = type(input.key) == "string" and input.key ~= "..." and library:convert_enum(input.key) or input.key
                input.key = input.key == Enum.KeyCode.Escape and "..." or input.key
                cfg.key = input.key or "..."
                cfg.mode = input.mode or "Toggle"
                cfg.set_mode(input.mode)
                if input.active then
                    cfg.active = input.active
                end
            end

            flags[cfg.flag] = {
                mode = cfg.mode,
                key = cfg.key,
                active = cfg.active
            }

            local text = tostring(cfg.key) ~= "Enums" and (keys[cfg.key] or tostring(cfg.key):gsub("Enum.", "")) or nil
            local __text = text and (tostring(text):gsub("KeyCode.", ""):gsub("UserInputType.", "")) or "..."
            
            toggle_text.Text = " " .. __text .. " "

            if keybind_list_text then
                keybind_list_text.Text = "[ " .. __text .. " ] " .. cfg.name .. ": " .. string.lower(cfg.mode)
                keybind_list_text.Visible = cfg.active
            end
        end

        function cfg.set_visible(bool)
            items.Visible = bool
            items.Position = dim_offset(keybind_element.AbsolutePosition.X, keybind_element.AbsolutePosition.Y + keybind_element.AbsoluteSize.Y + 60)
        end

        keybind_element.MouseButton1Down:Connect(function()
            task.wait()
            toggle_text.Text = "..."

            cfg.binding = library:connection(uis.InputBegan, function(keycode, game_event)
                local selected_key = keycode.UserInputType == Enum.UserInputType.Keyboard and keycode.KeyCode or keycode.UserInputType
                cfg.set(selected_key)
                cfg.binding:Disconnect()
                cfg.binding = nil
            end)
        end)

        keybind_element.MouseButton2Down:Connect(function()
            cfg.open = not cfg.open
            cfg.set_visible(cfg.open)
        end)

        library:connection(uis.InputBegan, function(input, game_event)
            if not game_event then
                local selected_key = input.UserInputType == Enum.UserInputType.Keyboard and input.KeyCode or input.UserInputType
                
                if selected_key == cfg.key then
                    if cfg.mode == "Toggle" then
                        cfg.active = not cfg.active
                        cfg.set(cfg.active)
                    elseif cfg.mode == "Hold" then
                        cfg.set(true)
                    end
                end
            end
        end)

        library:connection(uis.InputEnded, function(input, game_event)
            if game_event then return end

            local selected_key = input.UserInputType == Enum.UserInputType.Keyboard and input.KeyCode or input.UserInputType

            if selected_key == cfg.key then
                if cfg.mode == "Hold" then
                    cfg.set(false)
                end
            end

            if input.UserInputType == Enum.UserInputType.MouseButton1 then
                if not (library:mouse_in_frame(keybind_element) or library:mouse_in_frame(item_holder)) then
                    cfg.open = false
                    cfg.set_visible(false)
                end
            end
        end)

        config_flags[cfg.flag] = cfg.set
        library.options[cfg.flag] = cfg
        cfg.set({mode = cfg.mode, active = cfg.active, key = cfg.key})
                
        return setmetatable(cfg, library)
    end

    -- CONFIG TAB BUILDER (ENHANCED with theme system)
    function library:build_config_section(tab)
        library:refresh_configs()
        
        local configSection = tab:section({name = "configuration"})
        local uiSection = tab:section({name = "ui settings", side = "right"})
        
        -- Config name textbox
        configSection:textbox({
            name = "config name",
            flag = "_config_name",
            placeholder = "enter config name...",
            default = "",
        })
        
                -- Config list dropdown
        local configs = library.config.list
        if #configs == 0 then
            configs = {"none"}
        end
        
        local configDropdown = configSection:dropdown({
            name = "select config",
            flag = "_config_selected",
            items = configs,
            default = configs[1],
            callback = function(value)
                library.config.selected = value
            end
        })
        
        config_holder = configDropdown
        
        -- Save button
        configSection:button({
            name = "save config",
            callback = function()
                local name = flags["_config_name"] or ""
                if name == "" then
                    name = library.config.selected or "config_" .. os.time()
                end
                library:save_config(name)
                library:refresh_configs()
                local newConfigs = library.config.list
                if #newConfigs == 0 then
                    newConfigs = {"none"}
                end
                configDropdown.refresh_options(newConfigs)
            end
        })
        
        -- Load button
        configSection:button({
            name = "load config",
            callback = function()
                local selected = library.config.selected or flags["_config_selected"]
                if selected and selected ~= "none" then
                    library:load_config(selected)
                else
                    notifications:create_notification({name = "Please select a config"})
                end
            end
        })
        
        -- Delete button
        configSection:button({
            name = "delete config",
            callback = function()
                local selected = library.config.selected or flags["_config_selected"]
                if selected and selected ~= "none" then
                    library:delete_config(selected)
                    library:refresh_configs()
                    local newConfigs = library.config.list
                    if #newConfigs == 0 then
                        newConfigs = {"none"}
                    end
                    configDropdown.refresh_options(newConfigs)
                else
                    notifications:create_notification({name = "Please select a config"})
                end
            end
        })
        
        -- Refresh button
        configSection:button({
            name = "refresh configs",
            callback = function()
                library:refresh_configs()
                local newConfigs = library.config.list
                if #newConfigs == 0 then
                    newConfigs = {"none"}
                end
                configDropdown.refresh_options(newConfigs)
                notifications:create_notification({name = "Config list refreshed"})
            end
        })
        
        -- Autoload Section
        local currentAutoload = library:get_autoload() or "none"
        
        autoloadSection:label({name = "current: " .. currentAutoload})
        
        -- Set autoload button
        autoloadSection:button({
            name = "set as autoload",
            callback = function()
                local selected = library.config.selected or flags["_config_selected"]
                if selected and selected ~= "none" then
                    library:set_autoload(selected)
                else
                    notifications:create_notification({name = "Please select a config"})
                end
            end
        })
        
        -- Remove autoload button
        autoloadSection:button({
            name = "remove autoload",
            callback = function()
                library:remove_autoload()
            end
        })
        
        -- UI Settings Section
        uiSection:toggle({
            name = "show watermark",
            flag = "_ui_watermark",
            default = true,
            callback = function(value)
                if library.watermark_gui then
                    library.watermark_gui.Enabled = value
                end
            end
        })
        
        uiSection:toggle({
            name = "show keybind list",
            flag = "_ui_keybindlist",
            default = false,
            callback = function(value)
                if library.keybind_list_frame then
                    library.keybind_list_frame.Visible = value
                end
            end
        })
        
        -- Theme dropdown
        local themeNames = library:get_theme_names()
        uiSection:dropdown({
            name = "theme",
            flag = "_ui_theme",
            items = themeNames,
            default = library.current_theme or "default",
            callback = function(value)
                library:set_theme(value)
                notifications:create_notification({name = "Theme set to: " .. value})
            end
        })
        
        -- Accent color picker
        uiSection:colorpicker({
            name = "accent color",
            flag = "_ui_accent",
            color = themes.preset.accent,
            alpha = 0,
            callback = function(clr, alpha)
                library:set_accent(clr)
            end
        })
        
        -- Set current theme as default button
        uiSection:button({
            name = "set theme as default",
            callback = function()
                pcall(function()
                    if not isfolder(library.directory .. "/themes") then
                        makefolder(library.directory .. "/themes")
                    end
                    writefile(library.directory .. "/themes/current.txt", library.current_theme)
                    notifications:create_notification({name = "Default theme saved"})
                end)
            end
        })
        
        return {
            configSection = configSection,
            autoloadSection = autoloadSection,
            uiSection = uiSection,
            configDropdown = configDropdown,
        }
    end

    -- THEME PRESETS (add this near the top themes table if not already there)
    local theme_presets = {
        default = {
            accent = rgb(147, 112, 219), -- Purple accent
            text = rgb(255, 255, 255),
            text_outline = rgb(0, 0, 0),
            a = rgb(8, 8, 8),        -- Very dark black
            b = rgb(18, 18, 18),     -- Dark gray
            c = rgb(14, 14, 14),     -- Darker gray
            d = rgb(6, 6, 6),        -- Almost black
            e = rgb(10, 10, 10),     -- Very dark
            f = rgb(35, 35, 35),     -- Medium dark
            g = rgb(25, 25, 25),     -- Dark
        },
        fatality = {
            accent = rgb(255, 85, 85),  -- Red accent
            text = rgb(255, 255, 255),
            text_outline = rgb(0, 0, 0),
            a = rgb(5, 5, 5),
            b = rgb(15, 15, 15),
            c = rgb(12, 12, 12),
            d = rgb(4, 4, 4),
            e = rgb(8, 8, 8),
            f = rgb(30, 30, 30),
            g = rgb(20, 20, 20),
        },
        bbot = {
            accent = rgb(0, 170, 255),  -- Blue accent
            text = rgb(255, 255, 255),
            text_outline = rgb(0, 0, 0),
            a = rgb(10, 10, 10),
            b = rgb(20, 20, 20),
            c = rgb(15, 15, 15),
            d = rgb(5, 5, 5),
            e = rgb(12, 12, 12),
            f = rgb(35, 35, 35),
            g = rgb(25, 25, 25),
        },
        purple = {
            accent = rgb(138, 43, 226),  -- Bright purple
            text = rgb(255, 255, 255),
            text_outline = rgb(0, 0, 0),
            a = rgb(5, 5, 10),
            b = rgb(15, 15, 20),
            c = rgb(10, 10, 15),
            d = rgb(3, 3, 8),
            e = rgb(8, 8, 12),
            f = rgb(30, 30, 40),
            g = rgb(20, 20, 30),
        },
        midnight = {
            accent = rgb(180, 120, 255),  -- Light purple
            text = rgb(255, 255, 255),
            text_outline = rgb(0, 0, 0),
            a = rgb(2, 2, 5),
            b = rgb(12, 12, 18),
            c = rgb(8, 8, 14),
            d = rgb(1, 1, 3),
            e = rgb(5, 5, 10),
            f = rgb(25, 25, 35),
            g = rgb(18, 18, 25),
        },
    }

    -- THEME SYSTEM FUNCTIONS (add these to library functions section)
    function library:set_theme(theme_name)
        local preset = theme_presets[theme_name]
        if not preset then
            preset = theme_presets.default
            theme_name = "default"
        end
        
        library.current_theme = theme_name
        
        for key, color_value in pairs(preset) do
            library:update_theme(key, color_value)
        end
        
        -- Save theme preference
        pcall(function()
            if not isfolder(library.directory .. "/themes") then
                makefolder(library.directory .. "/themes")
            end
            writefile(library.directory .. "/themes/current.txt", theme_name)
        end)
    end
    
    function library:get_theme_names()
        local names = {}
        for name, _ in pairs(theme_presets) do
            table.insert(names, name)
        end
        table.sort(names)
        return names
    end
    
    function library:set_accent(new_color)
        library:update_theme("accent", new_color)
        themes.preset.accent = new_color
    end
    
    function library:load_saved_theme()
        pcall(function()
            if isfile(library.directory .. "/themes/current.txt") then
                local saved_theme = readfile(library.directory .. "/themes/current.txt")
                if theme_presets[saved_theme] then
                    library:set_theme(saved_theme)
                end
            end
        end)
    end

    -- FIX: Update the update_theme function to properly update all elements
    function library:update_theme(theme, color)
        if themes.utility[theme] then
            for property, objects in pairs(themes.utility[theme]) do 
                for i, object in pairs(objects) do 
                    if object and typeof(object) == "Instance" and object.Parent then
                        pcall(function()
                            object[property] = color
                        end)
                    end
                end 
            end 
        end
        themes.preset[theme] = color 
    end

-- Run autoload and load saved theme on initialization
task.spawn(function()
    task.wait(0.5)
    library:load_saved_theme()
    task.wait(0.5)
    library:run_autoload()
end)

return library, notifications
