if getgenv().Loaded then return getgenv().Library end
getgenv().Loaded = true

-- Variables 
    -- Services
    local InputService, HttpService, GuiService, RunService, Stats, CoreGui, TweenService, SoundService, Workspace, Players = game:GetService("UserInputService"), game:GetService("HttpService"), game:GetService("GuiService"), game:GetService("RunService"), game:GetService("Stats"), game:GetService("CoreGui"), game:GetService("TweenService"), game:GetService("SoundService"), game:GetService("Workspace"), game:GetService("Players")
    local Camera, lp, gui_offset = Workspace.CurrentCamera, Players.LocalPlayer, GuiService:GetGuiInset().Y
    local mouse = lp:GetMouse()

    -- Data types
    local vec2, vec3, dim2, dim, rect, dim_offset = Vector2.new, Vector3.new, UDim2.new, UDim.new, Rect.new, UDim2.fromOffset

    -- Extra data types
    local color, rgb, hex, hsv, rgbseq, rgbkey, numseq, numkey = Color3.new, Color3.fromRGB, Color3.fromHex, Color3.fromHSV, ColorSequence.new, ColorSequenceKeypoint.new, NumberSequence.new, NumberSequenceKeypoint.new
-- 

-- Library init
    getgenv().Library = {
        Directory = "xezios",
        Folders = {
            "/fonts",
            "/configs",
        },
        Flags = {},
        ConfigFlags = {},
        Connections = {},   
        Notifications = {Notifs = {}},
        OpenElement = {},
    }

    -- NEW THEME - More modern/sleek
    local themes = {
        preset = {
            accent = rgb(134, 96, 255),              -- Purple accent
            accent_dark = rgb(108, 72, 219),         -- Darker purple
            accent_light = rgb(160, 128, 255),       -- Lighter purple
            window_outline = rgb(30, 30, 35),        -- Dark outline
            window_border = rgb(45, 45, 55),         -- Border color
            inline = rgb(35, 35, 42),                -- Inner borders
            background = rgb(22, 22, 28),            -- Main background
            background_dark = rgb(18, 18, 22),       -- Darker background
            visible_backgrounds = rgb(28, 28, 35),   -- Section backgrounds
            topbar = rgb(26, 26, 32),                -- Top bar
            sidebar = rgb(24, 24, 30),               -- Sidebar
            text_color = rgb(235, 235, 240),         -- Primary text
            text_dark = rgb(180, 180, 190),          -- Secondary text
            glow = rgb(134, 96, 255),                -- Glow effect
            deselected = rgb(100, 100, 115),         -- Deselected items
            hover = rgb(40, 40, 50),                 -- Hover state
            divider = rgb(50, 50, 60),               -- Dividers
            success = rgb(80, 200, 120),             -- Success color
            error = rgb(255, 85, 85),                -- Error color
        },
        utility = {},
        gradients = {
            Selected = {},
            Deselected = {},
        },
    }

    for theme, clr in pairs(themes.preset) do 
        themes.utility[theme] = {
            BackgroundColor3 = {},
            TextColor3 = {},
            ImageColor3 = {},
            ScrollBarImageColor3 = {},
            Color = {},
        }
    end 

    local Keys = {
        [Enum.KeyCode.LeftShift] = "L-SHIFT",
        [Enum.KeyCode.RightShift] = "R-SHIFT",
        [Enum.KeyCode.LeftControl] = "L-CTRL",
        [Enum.KeyCode.RightControl] = "R-CTRL",
        [Enum.KeyCode.Insert] = "INS",
        [Enum.KeyCode.Backspace] = "BACK",
        [Enum.KeyCode.Return] = "ENTER",
        [Enum.KeyCode.LeftAlt] = "L-ALT",
        [Enum.KeyCode.RightAlt] = "R-ALT",
        [Enum.KeyCode.CapsLock] = "CAPS",
        [Enum.KeyCode.One] = "1", [Enum.KeyCode.Two] = "2",
        [Enum.KeyCode.Three] = "3", [Enum.KeyCode.Four] = "4",
        [Enum.KeyCode.Five] = "5", [Enum.KeyCode.Six] = "6",
        [Enum.KeyCode.Seven] = "7", [Enum.KeyCode.Eight] = "8",
        [Enum.KeyCode.Nine] = "9", [Enum.KeyCode.Zero] = "0",
        [Enum.KeyCode.KeypadOne] = "NUM1", [Enum.KeyCode.KeypadTwo] = "NUM2",
        [Enum.KeyCode.KeypadThree] = "NUM3", [Enum.KeyCode.KeypadFour] = "NUM4",
        [Enum.KeyCode.KeypadFive] = "NUM5", [Enum.KeyCode.KeypadSix] = "NUM6",
        [Enum.KeyCode.KeypadSeven] = "NUM7", [Enum.KeyCode.KeypadEight] = "NUM8",
        [Enum.KeyCode.KeypadNine] = "NUM9", [Enum.KeyCode.KeypadZero] = "NUM0",
        [Enum.KeyCode.Minus] = "-", [Enum.KeyCode.Equals] = "=",
        [Enum.KeyCode.Tilde] = "~", [Enum.KeyCode.LeftBracket] = "[",
        [Enum.KeyCode.RightBracket] = "]", [Enum.KeyCode.Semicolon] = ";",
        [Enum.KeyCode.Quote] = "'", [Enum.KeyCode.BackSlash] = "\\",
        [Enum.KeyCode.Comma] = ",", [Enum.KeyCode.Period] = ".",
        [Enum.KeyCode.Slash] = "/", [Enum.KeyCode.Asterisk] = "*",
        [Enum.KeyCode.Plus] = "+", [Enum.KeyCode.Backquote] = "`",
        [Enum.UserInputType.MouseButton1] = "MOUSE1",
        [Enum.UserInputType.MouseButton2] = "MOUSE2",
        [Enum.UserInputType.MouseButton3] = "MOUSE3",
        [Enum.KeyCode.Escape] = "ESC",
        [Enum.KeyCode.Space] = "SPACE",
        [Enum.KeyCode.Tab] = "TAB",
        [Enum.KeyCode.Home] = "HOME",
        [Enum.KeyCode.End] = "END",
        [Enum.KeyCode.Delete] = "DEL",
    }
    
    Library.__index = Library

    for _, path in ipairs(Library.Folders) do 
        pcall(function()
            if not isfolder(Library.Directory .. path) then
                makefolder(Library.Directory .. path)
            end
        end)
    end

    local Flags = Library.Flags 
    local ConfigFlags = Library.ConfigFlags
    local Notifications = Library.Notifications 
--

-- Library functions 
    -- Misc functions
        function Library:GetTransparency(obj)
            if obj:IsA("Frame") then
                return {"BackgroundTransparency"}
            elseif obj:IsA("TextLabel") or obj:IsA("TextButton") then
                return {"TextTransparency", "BackgroundTransparency"}
            elseif obj:IsA("ImageLabel") or obj:IsA("ImageButton") then
                return {"BackgroundTransparency", "ImageTransparency"}
            elseif obj:IsA("ScrollingFrame") then
                return {"BackgroundTransparency", "ScrollBarImageTransparency"}
            elseif obj:IsA("TextBox") then
                return {"TextTransparency", "BackgroundTransparency"}
            elseif obj:IsA("UIStroke") then 
                return {"Transparency"}
            end
            return nil
        end

        function Library:Tween(Object, Properties, Info)
            local tween = TweenService:Create(Object, Info or TweenInfo.new(0.2, Enum.EasingStyle.Quart, Enum.EasingDirection.Out), Properties)
            tween:Play()
            return tween
        end

        function Library:Fade(obj, prop, vis, speed)
            if not (obj and prop) then return end
            local OldTransparency = obj[prop]
            obj[prop] = vis and 1 or OldTransparency
            local Tween = Library:Tween(obj, {[prop] = vis and OldTransparency or 1}, TweenInfo.new(speed or 0.2, Enum.EasingStyle.Quart, Enum.EasingDirection.Out))
            Library:Connection(Tween.Completed, function()
                if not vis then
                    task.wait()
                    obj[prop] = OldTransparency
                end
            end)
            return Tween
        end

        function Library:Ripple(button)
            local ripple = Library:Create("Frame", {
                Name = "Ripple",
                Parent = button,
                BackgroundColor3 = rgb(255, 255, 255),
                BackgroundTransparency = 0.85,
                BorderSizePixel = 0,
                Position = dim2(0.5, 0, 0.5, 0),
                Size = dim2(0, 0, 0, 0),
                AnchorPoint = vec2(0.5, 0.5),
                ZIndex = 10,
            })
            Library:Create("UICorner", {CornerRadius = dim(1, 0), Parent = ripple})
            
            local size = math.max(button.AbsoluteSize.X, button.AbsoluteSize.Y) * 2.5
            Library:Tween(ripple, {Size = dim_offset(size, size), BackgroundTransparency = 1}, TweenInfo.new(0.4))
            task.delay(0.4, function() ripple:Destroy() end)
        end

        function Library:Resizify(Parent, minSize)
            local Resizing = Library:Create("TextButton", {
                Position = dim2(1, -15, 1, -15),
                Size = dim2(0, 15, 0, 15),
                BorderSizePixel = 0,
                BackgroundTransparency = 1,
                Parent = Parent,
                Text = "",
                ZIndex = 100,
            })
            
            Library:Create("ImageLabel", {
                Parent = Resizing,
                Size = dim2(1, 0, 1, 0),
                BackgroundTransparency = 1,
                Image = "rbxassetid://3926305904",
                ImageRectOffset = vec2(284, 44),
                ImageRectSize = vec2(36, 36),
                ImageColor3 = themes.preset.deselected,
                ImageTransparency = 0.5,
            })
        
            local IsResizing = false 
            local Size, InputLost
            local MinSize = minSize or Parent.Size  
            
            Resizing.InputBegan:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 then
                    IsResizing = true
                    InputLost = input.Position
                    Size = Parent.Size
                end
            end)
        
            Resizing.InputEnded:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 then
                    IsResizing = false
                end
            end)
        
            Library:Connection(InputService.InputChanged, function(input) 
                if IsResizing and input.UserInputType == Enum.UserInputType.MouseMovement then            
                    Parent.Size = dim2(
                        Size.X.Scale,
                        math.clamp(Size.X.Offset + (input.Position.X - InputLost.X), MinSize.X.Offset, Camera.ViewportSize.X - 50), 
                        Size.Y.Scale, 
                        math.clamp(Size.Y.Offset + (input.Position.Y - InputLost.Y), MinSize.Y.Offset, Camera.ViewportSize.Y - 50)
                    )
                end
            end)
        end
        
        function Library:Hovering(Object)
            if type(Object) == "table" then 
                for _, obj in ipairs(Object) do 
                    if Library:Hovering(obj) then 
                        return true
                    end 
                end 
                return false
            else 
                local pos = Object.AbsolutePosition
                local size = Object.AbsoluteSize
                return mouse.X >= pos.X and mouse.X <= pos.X + size.X and
                       mouse.Y >= pos.Y and mouse.Y <= pos.Y + size.Y
            end 
        end  

        function Library:Draggify(Parent, Handle)
            Handle = Handle or Parent
            local Dragging = false 
            local InitialSize = Parent.Position
            local InitialPosition 

            Handle.InputBegan:Connect(function(Input)
                if Input.UserInputType == Enum.UserInputType.MouseButton1 then
                    Dragging = true
                    InitialPosition = Input.Position
                    InitialSize = Parent.Position
                end
            end)

            Handle.InputEnded:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 then
                    Dragging = false
                end
            end)

            Library:Connection(InputService.InputChanged, function(Input) 
                if Dragging and Input.UserInputType == Enum.UserInputType.MouseMovement then
                    local Horizontal = Camera.ViewportSize.X
                    local Vertical = Camera.ViewportSize.Y
                    Parent.Position = dim2(
                        0,
                        math.clamp(InitialSize.X.Offset + (Input.Position.X - InitialPosition.X), 0, Horizontal - Parent.Size.X.Offset),
                        0,
                        math.clamp(InitialSize.Y.Offset + (Input.Position.Y - InitialPosition.Y), 0, Vertical - Parent.Size.Y.Offset)
                    )
                end
            end)
        end 

        function Library:Convert(str)
            local Values = {}
            for Value in string.gmatch(str, "[^,]+") do
                table.insert(Values, tonumber(Value))
            end
            if #Values == 4 then return unpack(Values) end
        end
        
        function Library:Lerp(start, finish, t)
            return start * (1 - (t or 0.125)) + finish * (t or 0.125)
        end

        function Library:ConvertEnum(enum)
            if type(enum) ~= "string" then return enum end
            local EnumParts = {}
            for part in string.gmatch(tostring(enum), "[%w_]+") do
                table.insert(EnumParts, part)
            end
            local EnumTable = Enum
            for i = 2, #EnumParts do
                EnumTable = EnumTable[EnumParts[i]]
            end
            return EnumTable
        end

        function Library:ConvertHex(clr, alpha)
            return string.format("#%02X%02X%02X%02X",
                math.floor(clr.R * 255), math.floor(clr.G * 255),
                math.floor(clr.B * 255), alpha and math.floor(alpha * 255) or 255)
        end

        function Library:ConvertFromHex(clr)
            clr = clr:gsub("#", "")
            local r = tonumber(clr:sub(1, 2), 16) / 255
            local g = tonumber(clr:sub(3, 4), 16) / 255
            local b = tonumber(clr:sub(5, 6), 16) / 255
            local a = tonumber(clr:sub(7, 8), 16) and tonumber(clr:sub(7, 8), 16) / 255 or 1
            return Color3.new(r, g, b), a
        end

        local ConfigHolder
        function Library:UpdateConfigList() 
            if not ConfigHolder then return end
            local List = {}
            pcall(function()
                for _, file in ipairs(listfiles(Library.Directory .. "/configs")) do
                    local Name = file:match("([^/\\]+)%.cfg$") or file:match("([^/\\]+)%.json$")
                    if Name then List[#List + 1] = Name end
                end
            end)
            ConfigHolder.RefreshOptions(#List > 0 and List or {"No configs"})
        end

        function Library:GetConfig()
            local Config = {}
            for Idx, Value in pairs(Flags) do
                if type(Value) == "table" and (Value.Key or Value.key) then
                    Config[Idx] = {
                        Active = Value.Active or Value.active,
                        Mode = Value.Mode or Value.mode,
                        Key = tostring(Value.Key or Value.key)
                    }
                elseif type(Value) == "table" and (Value.Transparency or Value.Color) then
                    Config[Idx] = {
                        Transparency = Value.Transparency,
                        Color = Value.Color and Value.Color:ToHex() or nil
                    }
                else
                    Config[Idx] = Value
                end
            end
            return HttpService:JSONEncode(Config)
        end

        function Library:LoadConfig(JSON) 
            local success, Config = pcall(function() return HttpService:JSONDecode(JSON) end)
            if not success then return end
            
            for Idx, Value in pairs(Config) do
                if Idx:sub(1,1) == "_" then continue end
                local Function = ConfigFlags[Idx]
                if Function then
                    if type(Value) == "table" and Value.Transparency and Value.Color then
                        Function(hex(Value.Color), Value.Transparency)
                    elseif type(Value) == "table" and Value.Active ~= nil then
                        Function(Value)
                    else
                        Function(Value)
                    end
                end
            end
        end 
        
        function Library:Round(num, float)
            local mult = 1 / (float or 1)
            return math.floor(num * mult + 0.5) / mult
        end

        function Library:Themify(instance, theme, property)
            if not themes.utility[theme] then return end
            if not themes.utility[theme][property] then 
                themes.utility[theme][property] = {}
            end
            table.insert(themes.utility[theme][property], instance)
        end

        function Library:RefreshTheme(theme, clr)
            if not themes.utility[theme] then return end
            for property, instances in pairs(themes.utility[theme]) do
                for _, object in ipairs(instances) do
                    if object and object.Parent then
                        pcall(function() object[property] = clr end)
                    end
                end
            end
            themes.preset[theme] = clr
        end

        function Library:Connection(signal, callback)
            local connection = signal:Connect(callback)
            table.insert(Library.Connections, connection)
            return connection
        end

        function Library:Create(instance, options)
            local ins = Instance.new(instance)
            for prop, value in pairs(options) do
                if prop ~= "Parent" then ins[prop] = value end
            end
            if options.Parent then ins.Parent = options.Parent end
            return ins
        end

        function Library:Unload()
            if Library.ScreenGui then Library.ScreenGui:Destroy() end
            if Library.PopupGui then Library.PopupGui:Destroy() end
            for _, connection in ipairs(Library.Connections) do
                pcall(function() connection:Disconnect() end)
            end
            getgenv().Library = nil
            getgenv().Loaded = nil
        end
    --
    
    -- Colorpicker helper (shared between toggle and label)
    function Library:CreateColorpicker(parent, properties)
        local Cfg = {
            Name = properties.Name or "Color",
            Flag = properties.Flag or properties.Name or "Colorpicker",
            Callback = properties.Callback or function() end,
            Color = properties.Color or color(1, 1, 1),
            Alpha = properties.Alpha or properties.Transparency or 0,
            Open = false,
            Items = {},
        }

        local DraggingSat, DraggingHue, DraggingAlpha = false, false, false
        local h, s, v = Cfg.Color:ToHSV()
        local a = Cfg.Alpha

        Flags[Cfg.Flag] = {Color = Cfg.Color, Transparency = Cfg.Alpha}

        local Items = Cfg.Items

        -- Color preview button
        Items.Button = Library:Create("TextButton", {
            Parent = parent,
            Size = dim2(0, 26, 0, 26),
            BackgroundColor3 = Cfg.Color,
            AutoButtonColor = false,
            Text = "",
            LayoutOrder = 2,
        })
        Library:Create("UICorner", {CornerRadius = dim(0, 6), Parent = Items.Button})
        Library:Create("UIStroke", {Color = themes.preset.window_border, Thickness = 1, Parent = Items.Button})

        -- Popup window
        Items.Window = Library:Create("Frame", {
            Parent = Library.PopupGui,
            Size = dim2(0, 240, 0, 210),
            BackgroundColor3 = themes.preset.background,
            Visible = false,
            ZIndex = 100,
        })
        Library:Themify(Items.Window, "background", "BackgroundColor3")
        Library:Create("UICorner", {CornerRadius = dim(0, 8), Parent = Items.Window})
        Library:Create("UIStroke", {Color = themes.preset.window_border, Thickness = 1, Parent = Items.Window})

        -- Saturation/Value picker
        Items.SatValFrame = Library:Create("Frame", {
            Parent = Items.Window,
            Position = dim2(0, 10, 0, 10),
            Size = dim2(1, -50, 1, -55),
            BackgroundColor3 = hsv(h, 1, 1),
        })
        Library:Create("UICorner", {CornerRadius = dim(0, 6), Parent = Items.SatValFrame})

        Items.WhiteGradient = Library:Create("Frame", {
            Parent = Items.SatValFrame,
            Size = dim2(1, 0, 1, 0),
            BackgroundColor3 = rgb(255, 255, 255),
            ZIndex = 2,
        })
        Library:Create("UICorner", {CornerRadius = dim(0, 6), Parent = Items.WhiteGradient})
        Library:Create("UIGradient", {
            Parent = Items.WhiteGradient,
            Transparency = numseq{numkey(0, 0), numkey(1, 1)},
        })

        Items.BlackGradient = Library:Create("Frame", {
            Parent = Items.SatValFrame,
            Size = dim2(1, 0, 1, 0),
            BackgroundColor3 = rgb(0, 0, 0),
            ZIndex = 3,
        })
        Library:Create("UICorner", {CornerRadius = dim(0, 6), Parent = Items.BlackGradient})
        Library:Create("UIGradient", {
            Parent = Items.BlackGradient,
            Rotation = 90,
            Transparency = numseq{numkey(0, 1), numkey(1, 0)},
        })

        Items.SatValButton = Library:Create("TextButton", {
            Parent = Items.SatValFrame,
            Size = dim2(1, 0, 1, 0),
            BackgroundTransparency = 1,
            Text = "",
            ZIndex = 4,
        })

        Items.SatValCursor = Library:Create("Frame", {
            Parent = Items.SatValFrame,
            Size = dim2(0, 14, 0, 14),
            Position = dim2(s, 0, 1-v, 0),
            AnchorPoint = vec2(0.5, 0.5),
            BackgroundColor3 = rgb(255, 255, 255),
            ZIndex = 5,
        })
        Library:Create("UICorner", {CornerRadius = dim(1, 0), Parent = Items.SatValCursor})
        Library:Create("UIStroke", {Color = rgb(0, 0, 0), Thickness = 2, Parent = Items.SatValCursor})

        -- Hue slider
        Items.HueFrame = Library:Create("Frame", {
            Parent = Items.Window,
            Position = dim2(1, -30, 0, 10),
            Size = dim2(0, 18, 1, -55),
            BackgroundColor3 = rgb(255, 255, 255),
        })
        Library:Create("UICorner", {CornerRadius = dim(0, 4), Parent = Items.HueFrame})
        Library:Create("UIGradient", {
            Parent = Items.HueFrame,
            Rotation = 90,
            Color = rgbseq{
                rgbkey(0, rgb(255, 0, 0)), rgbkey(0.167, rgb(255, 255, 0)),
                rgbkey(0.333, rgb(0, 255, 0)), rgbkey(0.5, rgb(0, 255, 255)),
                rgbkey(0.667, rgb(0, 0, 255)), rgbkey(0.833, rgb(255, 0, 255)),
                rgbkey(1, rgb(255, 0, 0))
            },
        })

        Items.HueButton = Library:Create("TextButton", {
            Parent = Items.HueFrame,
            Size = dim2(1, 0, 1, 0),
            BackgroundTransparency = 1,
            Text = "",
        })

        Items.HueCursor = Library:Create("Frame", {
            Parent = Items.HueFrame,
            Size = dim2(1, 4, 0, 6),
            Position = dim2(0, -2, h, 0),
            AnchorPoint = vec2(0, 0.5),
            BackgroundColor3 = rgb(255, 255, 255),
        })
        Library:Create("UICorner", {CornerRadius = dim(0, 3), Parent = Items.HueCursor})
        Library:Create("UIStroke", {Color = rgb(0, 0, 0), Thickness = 1, Parent = Items.HueCursor})

        -- Bottom section
        Items.Preview = Library:Create("Frame", {
            Parent = Items.Window,
            Position = dim2(0, 10, 1, -35),
            Size = dim2(0, 60, 0, 25),
            BackgroundColor3 = Cfg.Color,
        })
        Library:Create("UICorner", {CornerRadius = dim(0, 4), Parent = Items.Preview})

        Items.HexInput = Library:Create("TextBox", {
            Parent = Items.Window,
            Position = dim2(0, 80, 1, -35),
            Size = dim2(1, -90, 0, 25),
            BackgroundColor3 = themes.preset.inline,
            Font = Enum.Font.GothamMedium,
            Text = Library:ConvertHex(Cfg.Color),
            TextColor3 = themes.preset.text_color,
            TextSize = 12,
            ClearTextOnFocus = false,
        })
        Library:Create("UICorner", {CornerRadius = dim(0, 4), Parent = Items.HexInput})
        Library:Create("UIPadding", {PaddingLeft = dim(0, 8), Parent = Items.HexInput})

        function Cfg.SetVisible(bool)
            Items.Window.Visible = bool
            if bool then
                local pos = Items.Button.AbsolutePosition
                Items.Window.Position = dim2(0, pos.X - 200, 0, pos.Y + 35)
            end
        end

        function Cfg.Set(newColor, alpha)
            if type(newColor) == "boolean" then return end
            if newColor then h, s, v = newColor:ToHSV() end
            if alpha then a = alpha end

            local finalColor = hsv(h, s, v)
            Items.SatValCursor.Position = dim2(s, 0, 1 - v, 0)
            Items.HueCursor.Position = dim2(0, -2, h, 0)
            Items.SatValFrame.BackgroundColor3 = hsv(h, 1, 1)
            Items.Button.BackgroundColor3 = finalColor
            Items.Preview.BackgroundColor3 = finalColor
            Items.HexInput.Text = Library:ConvertHex(finalColor)

            Flags[Cfg.Flag] = {Color = finalColor, Transparency = a}
            Cfg.Callback(finalColor, a)
        end

        function Cfg.UpdateColor()
            local mousePos = InputService:GetMouseLocation()
            local offset = vec2(mousePos.X, mousePos.Y - gui_offset)

            if DraggingSat then
                s = math.clamp((offset.X - Items.SatValFrame.AbsolutePosition.X) / Items.SatValFrame.AbsoluteSize.X, 0, 1)
                v = 1 - math.clamp((offset.Y - Items.SatValFrame.AbsolutePosition.Y) / Items.SatValFrame.AbsoluteSize.Y, 0, 1)
            elseif DraggingHue then
                h = math.clamp((offset.Y - Items.HueFrame.AbsolutePosition.Y) / Items.HueFrame.AbsoluteSize.Y, 0, 1)
            end
            Cfg.Set()
        end

        Items.Button.MouseButton1Click:Connect(function()
            Cfg.Open = not Cfg.Open
            Cfg.SetVisible(Cfg.Open)
        end)

        Items.SatValButton.MouseButton1Down:Connect(function() DraggingSat = true end)
        Items.HueButton.MouseButton1Down:Connect(function() DraggingHue = true end)

        Library:Connection(InputService.InputChanged, function(input)
            if (DraggingSat or DraggingHue) and input.UserInputType == Enum.UserInputType.MouseMovement then
                Cfg.UpdateColor()
            end
        end)

        Library:Connection(InputService.InputEnded, function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 then
                DraggingSat, DraggingHue, DraggingAlpha = false, false, false
                if Cfg.Open and not Library:Hovering({Items.Button, Items.Window}) then
                    Cfg.SetVisible(false)
                    Cfg.Open = false
                end
            end
        end)

        Items.HexInput.FocusLost:Connect(function()
            local success, newColor = pcall(hex, Items.HexInput.Text)
            if success then Cfg.Set(newColor) end
        end)

        Cfg.Set(Cfg.Color, Cfg.Alpha)
        ConfigFlags[Cfg.Flag] = Cfg.Set

        return Cfg
    end

    -- Library element functions
    function Library:Window(properties)
        local Cfg = {
            Prefix = properties.Prefix or "XEZIOS",
            Suffix = properties.Suffix or "UI",
            Size = properties.Size or dim2(0, 680, 0, 480),
            TabInfo = nil,
            Items = {},
            Visible = true,
            Tweening = false,
        }

        -- Main ScreenGui
        Library.ScreenGui = Library:Create("ScreenGui", {
            Name = "XeziosUI",
            Parent = CoreGui,
            ResetOnSpawn = false,
            ZIndexBehavior = Enum.ZIndexBehavior.Sibling,
            IgnoreGuiInset = true,
        })

        -- Popup holder (for dropdowns, colorpickers)
        Library.PopupGui = Library:Create("ScreenGui", {
            Name = "XeziosPopups",
            Parent = CoreGui,
            ResetOnSpawn = false,
            ZIndexBehavior = Enum.ZIndexBehavior.Sibling,
            IgnoreGuiInset = true,
        })

        local Items = Cfg.Items

        -- ═══════════════════════════════════════════════════════════════
        -- MAIN WINDOW FRAME
        -- ═══════════════════════════════════════════════════════════════
        
        Items.Window = Library:Create("Frame", {
            Name = "MainWindow",
            Parent = Library.ScreenGui,
            Position = dim2(0.5, -Cfg.Size.X.Offset/2, 0.5, -Cfg.Size.Y.Offset/2),
            Size = Cfg.Size,
            BackgroundColor3 = themes.preset.background,
            BorderSizePixel = 0,
            ClipsDescendants = true,
        })
        Items.Window.Position = dim2(0, Items.Window.AbsolutePosition.X, 0, Items.Window.AbsolutePosition.Y)
        Library:Themify(Items.Window, "background", "BackgroundColor3")

        Library:Create("UICorner", {CornerRadius = dim(0, 10), Parent = Items.Window})

        -- Border stroke
        Library:Create("UIStroke", {
            Parent = Items.Window,
            Color = themes.preset.window_border,
            Thickness = 1,
        })

        -- Shadow
        Items.Shadow = Library:Create("ImageLabel", {
            Name = "Shadow",
            Parent = Items.Window,
            Position = dim2(0, -25, 0, -25),
            Size = dim2(1, 50, 1, 50),
            BackgroundTransparency = 1,
            Image = "rbxassetid://5554236805",
            ImageColor3 = rgb(0, 0, 0),
            ImageTransparency = 0.4,
            ScaleType = Enum.ScaleType.Slice,
            SliceCenter = rect(23, 23, 277, 277),
            ZIndex = -1,
        })

        -- ═══════════════════════════════════════════════════════════════
        -- TOP BAR (Title + Close)
        -- ═══════════════════════════════════════════════════════════════

        Items.TopBar = Library:Create("Frame", {
            Name = "TopBar",
            Parent = Items.Window,
            Size = dim2(1, 0, 0, 50),
            BackgroundColor3 = themes.preset.topbar,
            BorderSizePixel = 0,
        })
        Library:Themify(Items.TopBar, "topbar", "BackgroundColor3")
        Library:Create("UICorner", {CornerRadius = dim(0, 10), Parent = Items.TopBar})

        -- Fix corner
        Library:Create("Frame", {
            Parent = Items.TopBar,
            Position = dim2(0, 0, 1, -10),
            Size = dim2(1, 0, 0, 10),
            BackgroundColor3 = themes.preset.topbar,
            BorderSizePixel = 0,
        })

        -- Title
        Items.Title = Library:Create("TextLabel", {
            Parent = Items.TopBar,
            Position = dim2(0, 20, 0, 0),
            Size = dim2(0.5, 0, 1, 0),
            BackgroundTransparency = 1,
            Font = Enum.Font.GothamBold,
            Text = Cfg.Prefix,
            TextColor3 = themes.preset.accent,
            TextSize = 18,
            TextXAlignment = Enum.TextXAlignment.Left,
        })
        Library:Themify(Items.Title, "accent", "TextColor3")

        Items.Subtitle = Library:Create("TextLabel", {
            Parent = Items.TopBar,
            Position = dim2(0, 20 + Items.Title.TextBounds.X + 8, 0, 0),
            Size = dim2(0.3, 0, 1, 0),
            BackgroundTransparency = 1,
            Font = Enum.Font.GothamMedium,
            Text = Cfg.Suffix,
            TextColor3 = themes.preset.text_dark,
            TextSize = 14,
            TextXAlignment = Enum.TextXAlignment.Left,
        })
        Library:Themify(Items.Subtitle, "text_dark", "TextColor3")

        -- Divider under topbar
        Items.TopDivider = Library:Create("Frame", {
            Parent = Items.Window,
            Position = dim2(0, 0, 0, 50),
            Size = dim2(1, 0, 0, 1),
            BackgroundColor3 = themes.preset.divider,
            BorderSizePixel = 0,
        })
        Library:Themify(Items.TopDivider, "divider", "BackgroundColor3")

        -- ═══════════════════════════════════════════════════════════════
        -- TAB BAR (Horizontal tabs at top)
        -- ═══════════════════════════════════════════════════════════════

        Items.TabBar = Library:Create("Frame", {
            Name = "TabBar",
            Parent = Items.Window,
            Position = dim2(0, 0, 0, 51),
            Size = dim2(1, 0, 0, 40),
            BackgroundColor3 = themes.preset.sidebar,
            BorderSizePixel = 0,
        })
        Library:Themify(Items.TabBar, "sidebar", "BackgroundColor3")

        Items.TabHolder = Library:Create("ScrollingFrame", {
            Parent = Items.TabBar,
            Position = dim2(0, 15, 0, 5),
            Size = dim2(1, -30, 1, -10),
            BackgroundTransparency = 1,
            ScrollBarThickness = 0,
            CanvasSize = dim2(0, 0, 0, 0),
            AutomaticCanvasSize = Enum.AutomaticSize.X,
            ScrollingDirection = Enum.ScrollingDirection.X,
        })

        Library:Create("UIListLayout", {
            Parent = Items.TabHolder,
            FillDirection = Enum.FillDirection.Horizontal,
            Padding = dim(0, 6),
            SortOrder = Enum.SortOrder.LayoutOrder,
        })

        -- Divider under tab bar
        Items.TabDivider = Library:Create("Frame", {
            Parent = Items.Window,
            Position = dim2(0, 0, 0, 91),
            Size = dim2(1, 0, 0, 1),
            BackgroundColor3 = themes.preset.divider,
            BorderSizePixel = 0,
        })
        Library:Themify(Items.TabDivider, "divider", "BackgroundColor3")

        -- ═══════════════════════════════════════════════════════════════
        -- PAGE CONTAINER
        -- ═══════════════════════════════════════════════════════════════

        Items.PageContainer = Library:Create("Frame", {
            Name = "PageContainer",
            Parent = Items.Window,
            Position = dim2(0, 0, 0, 92),
            Size = dim2(1, 0, 1, -92),
            BackgroundTransparency = 1,
            ClipsDescendants = true,
        })

        -- Fade overlay for tab transitions
        Items.Fade = Library:Create("Frame", {
            Name = "Fade",
            Parent = Items.PageContainer,
            Size = dim2(1, 0, 1, 0),
            BackgroundColor3 = themes.preset.background,
            BackgroundTransparency = 1,
            ZIndex = 50,
        })
        Library:Themify(Items.Fade, "background", "BackgroundColor3")

        -- Make window draggable
        Library:Draggify(Items.Window, Items.TopBar)
        Library:Resizify(Items.Window, dim2(0, 550, 0, 400))

        -- ═══════════════════════════════════════════════════════════════
        -- WINDOW METHODS
        -- ═══════════════════════════════════════════════════════════════

        function Cfg.ToggleMenu(bool)
            if Cfg.Tweening then return end
            Cfg.Tweening = true
            Cfg.Visible = bool
            Items.Window.Visible = true

            local children = Items.Window:GetDescendants()
            table.insert(children, Items.Window)

            local lastTween
            for _, obj in ipairs(children) do
                local props = Library:GetTransparency(obj)
                if props then
                    for _, prop in ipairs(props) do
                        lastTween = Library:Fade(obj, prop, bool)
                    end
                end
            end

            if lastTween then
                Library:Connection(lastTween.Completed, function()
                    task.wait()
                    Cfg.Tweening = false
                    Items.Window.Visible = bool
                end)
            else
                Cfg.Tweening = false
                Items.Window.Visible = bool
            end
        end

        function Cfg.ChangeMenuTitle(prefix, suffix)
            Items.Title.Text = prefix or Items.Title.Text
            Items.Subtitle.Text = suffix or Items.Subtitle.Text
        end

        return setmetatable(Cfg, Library)
    end

    -- ═══════════════════════════════════════════════════════════════════════
    -- TAB CREATION
    -- ═══════════════════════════════════════════════════════════════════════

    function Library:Tab(properties)
        local Cfg = {
            Name = properties.Name or properties.name or "Tab",
            Icon = properties.Icon or properties.icon or nil,
            Items = {},
            Active = false,
        }

        local Items = Cfg.Items

        -- Tab button (horizontal style)
        Items.Button = Library:Create("TextButton", {
            Name = Cfg.Name,
            Parent = self.Items.TabHolder,
            Size = dim2(0, 0, 1, 0),
            AutomaticSize = Enum.AutomaticSize.X,
            BackgroundColor3 = themes.preset.hover,
            BackgroundTransparency = 1,
            AutoButtonColor = false,
            Text = "",
        })
        Library:Create("UICorner", {CornerRadius = dim(0, 6), Parent = Items.Button})
        Library:Create("UIPadding", {
            Parent = Items.Button,
            PaddingLeft = dim(0, 14),
            PaddingRight = dim(0, 14),
        })

        -- Icon (optional)
        if Cfg.Icon then
            Items.Icon = Library:Create("ImageLabel", {
                Parent = Items.Button,
                Position = dim2(0, 0, 0.5, 0),
                AnchorPoint = vec2(0, 0.5),
                Size = dim2(0, 16, 0, 16),
                BackgroundTransparency = 1,
                Image = Cfg.Icon,
                ImageColor3 = themes.preset.deselected,
            })
            Library:Themify(Items.Icon, "deselected", "ImageColor3")
        end

        Items.Label = Library:Create("TextLabel", {
            Parent = Items.Button,
            Position = dim2(0, Cfg.Icon and 22 or 0, 0, 0),
            Size = dim2(1, Cfg.Icon and -22 or 0, 1, 0),
            BackgroundTransparency = 1,
            Font = Enum.Font.GothamMedium,
            Text = Cfg.Name,
            TextColor3 = themes.preset.deselected,
            TextSize = 13,
        })
        Library:Themify(Items.Label, "deselected", "TextColor3")

        -- Active indicator (bottom line)
        Items.Indicator = Library:Create("Frame", {
            Parent = Items.Button,
            Position = dim2(0, 0, 1, -2),
            Size = dim2(1, 0, 0, 2),
            BackgroundColor3 = themes.preset.accent,
            BackgroundTransparency = 1,
        })
        Library:Themify(Items.Indicator, "accent", "BackgroundColor3")
        Library:Create("UICorner", {CornerRadius = dim(0, 1), Parent = Items.Indicator})

        -- Page container
        Items.Page = Library:Create("ScrollingFrame", {
            Name = Cfg.Name .. "Page",
            Parent = self.Items.PageContainer,
            Size = dim2(1, 0, 1, 0),
            BackgroundTransparency = 1,
            ScrollBarThickness = 3,
            ScrollBarImageColor3 = themes.preset.accent,
            CanvasSize = dim2(0, 0, 0, 0),
            AutomaticCanvasSize = Enum.AutomaticSize.Y,
            Visible = false,
        })

        Library:Create("UIPadding", {
            Parent = Items.Page,
            PaddingTop = dim(0, 10),
            PaddingBottom = dim(0, 10),
            PaddingLeft = dim(0, 12),
            PaddingRight = dim(0, 12),
        })

        -- Two-column layout
        Items.ColumnContainer = Library:Create("Frame", {
            Parent = Items.Page,
            Size = dim2(1, 0, 0, 0),
            AutomaticSize = Enum.AutomaticSize.Y,
            BackgroundTransparency = 1,
        })

        Library:Create("UIListLayout", {
            Parent = Items.ColumnContainer,
            FillDirection = Enum.FillDirection.Horizontal,
            Padding = dim(0, 10),
            SortOrder = Enum.SortOrder.LayoutOrder,
        })

        Items.Left = Library:Create("Frame", {
            Name = "Left",
            Parent = Items.ColumnContainer,
            Size = dim2(0.5, -5, 0, 0),
            AutomaticSize = Enum.AutomaticSize.Y,
            BackgroundTransparency = 1,
            LayoutOrder = 1,
        })
        Library:Create("UIListLayout", {
            Parent = Items.Left,
            Padding = dim(0, 10),
            SortOrder = Enum.SortOrder.LayoutOrder,
        })

        Items.Right = Library:Create("Frame", {
            Name = "Right",
            Parent = Items.ColumnContainer,
            Size = dim2(0.5, -5, 0, 0),
            AutomaticSize = Enum.AutomaticSize.Y,
            BackgroundTransparency = 1,
            LayoutOrder = 2,
        })
        Library:Create("UIListLayout", {
            Parent = Items.Right,
            Padding = dim(0, 10),
            SortOrder = Enum.SortOrder.LayoutOrder,
        })

        function Cfg.OpenTab()
            -- Deselect previous tab
            if self.TabInfo and self.TabInfo ~= Items then
                local old = self.TabInfo
                old.Page.Visible = false
                Library:Tween(old.Button, {BackgroundTransparency = 1})
                Library:Tween(old.Label, {TextColor3 = themes.preset.deselected})
                Library:Tween(old.Indicator, {BackgroundTransparency = 1})
                if old.Icon then
                    Library:Tween(old.Icon, {ImageColor3 = themes.preset.deselected})
                end
            end

            -- Fade transition
            self.Items.Fade.BackgroundTransparency = 0
            Library:Tween(self.Items.Fade, {BackgroundTransparency = 1})

            -- Select new tab
            Cfg.Active = true
            Items.Page.Visible = true
            self.TabInfo = Items

            Library:Tween(Items.Button, {BackgroundTransparency = 0})
            Library:Tween(Items.Label, {TextColor3 = themes.preset.text_color})
            Library:Tween(Items.Indicator, {BackgroundTransparency = 0})
            if Items.Icon then
                Library:Tween(Items.Icon, {ImageColor3 = themes.preset.accent})
            end
        end

        -- Hover effect
        Items.Button.MouseEnter:Connect(function()
            if not Cfg.Active then
                Library:Tween(Items.Button, {BackgroundTransparency = 0.5})
            end
        end)

        Items.Button.MouseLeave:Connect(function()
            if not Cfg.Active then
                Library:Tween(Items.Button, {BackgroundTransparency = 1})
            end
        end)

        Items.Button.MouseButton1Click:Connect(function()
            Library:Ripple(Items.Button)
            Cfg.OpenTab()
        end)

        -- Select first tab
        if not self.TabInfo then
            Cfg.OpenTab()
        end

        return setmetatable(Cfg, Library)
    end

    -- ═══════════════════════════════════════════════════════════════════════
    -- SECTION CREATION
    -- ═══════════════════════════════════════════════════════════════════════

    function Library:Section(properties)
        local Cfg = {
            Name = properties.Name or properties.name or "Section",
            Side = properties.Side or properties.side or "Left",
            Items = {},
        }

        local parent = self.Items[Cfg.Side]

        local Items = Cfg.Items

        Items.Section = Library:Create("Frame", {
            Name = Cfg.Name,
            Parent = parent,
            Size = dim2(1, 0, 0, 0),
            AutomaticSize = Enum.AutomaticSize.Y,
            BackgroundColor3 = themes.preset.visible_backgrounds,
            BorderSizePixel = 0,
        })
        Library:Themify(Items.Section, "visible_backgrounds", "BackgroundColor3")
        Library:Create("UICorner", {CornerRadius = dim(0, 8), Parent = Items.Section})
        Library:Create("UIStroke", {
            Parent = Items.Section,
            Color = themes.preset.inline,
            Thickness = 1,
        })

        -- Header
        Items.Header = Library:Create("Frame", {
            Parent = Items.Section,
            Size = dim2(1, 0, 0, 32),
            BackgroundTransparency = 1,
        })

        Items.Title = Library:Create("TextLabel", {
            Parent = Items.Header,
            Position = dim2(0, 12, 0, 0),
            Size = dim2(1, -24, 1, 0),
            BackgroundTransparency = 1,
            Font = Enum.Font.GothamBold,
            Text = Cfg.Name:upper(),
            TextColor3 = themes.preset.text_dark,
            TextSize = 11,
            TextXAlignment = Enum.TextXAlignment.Left,
        })
        Library:Themify(Items.Title, "text_dark", "TextColor3")

        -- Header divider
        Items.Divider = Library:Create("Frame", {
            Parent = Items.Section,
            Position = dim2(0, 10, 0, 32),
            Size = dim2(1, -20, 0, 1),
            BackgroundColor3 = themes.preset.inline,
            BorderSizePixel = 0,
        })
        Library:Themify(Items.Divider, "inline", "BackgroundColor3")

        -- Content
        Items.Elements = Library:Create("Frame", {
            Parent = Items.Section,
            Position = dim2(0, 0, 0, 38),
            Size = dim2(1, 0, 0, 0),
            AutomaticSize = Enum.AutomaticSize.Y,
            BackgroundTransparency = 1,
        })

        Library:Create("UIListLayout", {
            Parent = Items.Elements,
            Padding = dim(0, 4),
            SortOrder = Enum.SortOrder.LayoutOrder,
        })

        Library:Create("UIPadding", {
            Parent = Items.Elements,
            PaddingTop = dim(0, 4),
            PaddingBottom = dim(0, 10),
            PaddingLeft = dim(0, 10),
            PaddingRight = dim(0, 10),
        })

        return setmetatable(Cfg, Library)
    end

    -- ═══════════════════════════════════════════════════════════════════════
    -- TOGGLE
    -- ═══════════════════════════════════════════════════════════════════════

    function Library:Toggle(properties)
        local Cfg = {
            Name = properties.Name or "Toggle",
            Flag = properties.Flag or properties.Name or "Toggle",
            Enabled = properties.Default or properties.Enabled or false,
            Callback = properties.Callback or function() end,
            Items = {},
        }

        Flags[Cfg.Flag] = Cfg.Enabled

        local Items = Cfg.Items

        Items.Container = Library:Create("Frame", {
            Parent = self.Items.Elements,
            Size = dim2(1, 0, 0, 32),
            BackgroundTransparency = 1,
        })

        Items.Label = Library:Create("TextLabel", {
            Parent = Items.Container,
            Size = dim2(1, -70, 1, 0),
            BackgroundTransparency = 1,
            Font = Enum.Font.GothamMedium,
            Text = Cfg.Name,
            TextColor3 = themes.preset.text_color,
            TextSize = 13,
            TextXAlignment = Enum.TextXAlignment.Left,
            TextTruncate = Enum.TextTruncate.AtEnd,
        })
        Library:Themify(Items.Label, "text_color", "TextColor3")

        -- Components holder (right side)
        Items.Components = Library:Create("Frame", {
            Parent = Items.Container,
            Position = dim2(1, 0, 0.5, 0),
            AnchorPoint = vec2(1, 0.5),
            Size = dim2(0, 0, 0, 26),
            AutomaticSize = Enum.AutomaticSize.X,
            BackgroundTransparency = 1,
        })

        Library:Create("UIListLayout", {
            Parent = Items.Components,
            FillDirection = Enum.FillDirection.Horizontal,
            HorizontalAlignment = Enum.HorizontalAlignment.Right,
            VerticalAlignment = Enum.VerticalAlignment.Center,
            Padding = dim(0, 8),
            SortOrder = Enum.SortOrder.LayoutOrder,
        })

        -- Toggle switch
        Items.Switch = Library:Create("TextButton", {
            Parent = Items.Components,
            Size = dim2(0, 44, 0, 24),
            BackgroundColor3 = themes.preset.inline,
            AutoButtonColor = false,
            Text = "",
            LayoutOrder = 100,
        })
        Library:Create("UICorner", {CornerRadius = dim(1, 0), Parent = Items.Switch})

        Items.Knob = Library:Create("Frame", {
            Parent = Items.Switch,
            Position = dim2(0, 3, 0.5, 0),
            AnchorPoint = vec2(0, 0.5),
            Size = dim2(0, 18, 0, 18),
            BackgroundColor3 = themes.preset.deselected,
        })
        Library:Create("UICorner", {CornerRadius = dim(1, 0), Parent = Items.Knob})

        function Cfg.Set(bool)
            if type(bool) ~= "boolean" then return end
            Cfg.Enabled = bool
            Flags[Cfg.Flag] = bool

            local accentColor = themes.preset.accent
            local inlineColor = themes.preset.inline

            Library:Tween(Items.Switch, {BackgroundColor3 = bool and accentColor or inlineColor})
            Library:Tween(Items.Knob, {
                Position = bool and dim2(1, -21, 0.5, 0) or dim2(0, 3, 0.5, 0),
                BackgroundColor3 = bool and rgb(255, 255, 255) or themes.preset.deselected,
            })

            Cfg.Callback(bool)
        end

        Items.Switch.MouseButton1Click:Connect(function()
            Cfg.Set(not Cfg.Enabled)
        end)

        Cfg.Set(Cfg.Enabled)
        ConfigFlags[Cfg.Flag] = Cfg.Set

        -- Keybind attachment
        function Cfg:Keybind(options)
            local kbFlag = options.Flag or options.Name or (Cfg.Flag .. "_Key")
            local kbKey = options.Key or nil
            local kbMode = options.Mode or "Toggle"
            local kbActive = options.Default or false
            local kbCallback = options.Callback or function() end

            Flags[kbFlag] = {Key = kbKey, Mode = kbMode, Active = kbActive}

            local KeybindBtn = Library:Create("TextButton", {
                Parent = Items.Components,
                Size = dim2(0, 50, 0, 24),
                BackgroundColor3 = themes.preset.inline,
                AutoButtonColor = false,
                Text = "",
                LayoutOrder = 1,
            })
            Library:Create("UICorner", {CornerRadius = dim(0, 6), Parent = KeybindBtn})

            local KeyLabel = Library:Create("TextLabel", {
                Parent = KeybindBtn,
                Size = dim2(1, 0, 1, 0),
                BackgroundTransparency = 1,
                Font = Enum.Font.GothamMedium,
                Text = Keys[kbKey] or (kbKey and tostring(kbKey):gsub("Enum.KeyCode.", "") or "NONE"),
                TextColor3 = themes.preset.text_dark,
                TextSize = 11,
            })

            local binding = false
            local bindConnection

            local function SetKeybind(input)
                if type(input) == "table" then
                    kbKey = input.Key
                    kbMode = input.Mode or kbMode
                    kbActive = input.Active or kbActive
                elseif type(input) == "userdata" then
                    kbKey = input == Enum.KeyCode.Escape and nil or input
                elseif type(input) == "boolean" then
                    kbActive = input
                end

                KeyLabel.Text = Keys[kbKey] or (kbKey and tostring(kbKey):gsub("Enum.KeyCode.", ""):gsub("Enum.UserInputType.", "") or "NONE")
                Flags[kbFlag] = {Key = kbKey, Mode = kbMode, Active = kbActive}
                kbCallback(kbActive)
            end

            KeybindBtn.MouseButton1Click:Connect(function()
                if binding then return end
                binding = true
                KeyLabel.Text = "..."

                bindConnection = Library:Connection(InputService.InputBegan, function(input, processed)
                    if processed then return end
                    local key = input.KeyCode ~= Enum.KeyCode.Unknown and input.KeyCode or input.UserInputType
                    SetKeybind(key)
                    binding = false
                    if bindConnection then bindConnection:Disconnect() end
                end)
            end)

            Library:Connection(InputService.InputBegan, function(input, processed)
                if processed or not kbKey then return end
                local key = input.KeyCode ~= Enum.KeyCode.Unknown and input.KeyCode or input.UserInputType
                if key == kbKey then
                    if kbMode == "Toggle" then
                        SetKeybind(not kbActive)
                    elseif kbMode == "Hold" then
                        SetKeybind(true)
                    end
                end
            end)

            Library:Connection(InputService.InputEnded, function(input)
                if not kbKey then return end
                local key = input.KeyCode ~= Enum.KeyCode.Unknown and input.KeyCode or input.UserInputType
                if key == kbKey and kbMode == "Hold" then
                    SetKeybind(false)
                end
            end)

            ConfigFlags[kbFlag] = SetKeybind
            return Cfg
        end

        -- Colorpicker attachment
        function Cfg:Colorpicker(options)
            local picker = Library:CreateColorpicker(Items.Components, options)
            return Cfg
        end

        return setmetatable(Cfg, Library)
    end

    -- ═══════════════════════════════════════════════════════════════════════
    -- SLIDER
    -- ═══════════════════════════════════════════════════════════════════════

    function Library:Slider(properties)
        local Cfg = {
            Name = properties.Name or "Slider",
            Flag = properties.Flag or properties.Name or "Slider",
            Min = properties.Min or 0,
            Max = properties.Max or 100,
            Default = properties.Default or properties.Value or 0,
            Decimal = properties.Decimal or properties.Increment or 1,
            Suffix = properties.Suffix or "",
            Callback = properties.Callback or function() end,
            Dragging = false,
            Items = {},
        }

        Flags[Cfg.Flag] = Cfg.Default

        local Items = Cfg.Items

        Items.Container = Library:Create("Frame", {
            Parent = self.Items.Elements,
            Size = dim2(1, 0, 0, 44),
            BackgroundTransparency = 1,
        })

        Items.Label = Library:Create("TextLabel", {
            Parent = Items.Container,
            Size = dim2(0.6, 0, 0, 20),
            BackgroundTransparency = 1,
            Font = Enum.Font.GothamMedium,
            Text = Cfg.Name,
            TextColor3 = themes.preset.text_color,
            TextSize = 13,
            TextXAlignment = Enum.TextXAlignment.Left,
        })
        Library:Themify(Items.Label, "text_color", "TextColor3")

        Items.Value = Library:Create("TextLabel", {
            Parent = Items.Container,
            Position = dim2(0.6, 0, 0, 0),
            Size = dim2(0.4, 0, 0, 20),
            BackgroundTransparency = 1,
            Font = Enum.Font.GothamMedium,
            Text = tostring(Cfg.Default) .. Cfg.Suffix,
            TextColor3 = themes.preset.accent,
            TextSize = 13,
            TextXAlignment = Enum.TextXAlignment.Right,
        })
        Library:Themify(Items.Value, "accent", "TextColor3")

        Items.Bar = Library:Create("TextButton", {
            Parent = Items.Container,
            Position = dim2(0, 0, 0, 26),
            Size = dim2(1, 0, 0, 10),
            BackgroundColor3 = themes.preset.inline,
            AutoButtonColor = false,
            Text = "",
        })
        Library:Create("UICorner", {CornerRadius = dim(0, 5), Parent = Items.Bar})

        Items.Fill = Library:Create("Frame", {
            Parent = Items.Bar,
            Size = dim2((Cfg.Default - Cfg.Min) / (Cfg.Max - Cfg.Min), 0, 1, 0),
            BackgroundColor3 = themes.preset.accent,
        })
        Library:Themify(Items.Fill, "accent", "BackgroundColor3")
        Library:Create("UICorner", {CornerRadius = dim(0, 5), Parent = Items.Fill})

        Items.Knob = Library:Create("Frame", {
            Parent = Items.Fill,
            Position = dim2(1, 0, 0.5, 0),
            AnchorPoint = vec2(0.5, 0.5),
            Size = dim2(0, 16, 0, 16),
            BackgroundColor3 = themes.preset.accent,
        })
        Library:Themify(Items.Knob, "accent", "BackgroundColor3")
        Library:Create("UICorner", {CornerRadius = dim(1, 0), Parent = Items.Knob})
        Library:Create("UIStroke", {Color = rgb(255, 255, 255), Thickness = 2, Parent = Items.Knob})

        function Cfg.Set(value)
            if type(value) ~= "number" then return end
            value = math.clamp(Library:Round(value, Cfg.Decimal), Cfg.Min, Cfg.Max)
            Cfg.Value = value
            Flags[Cfg.Flag] = value

            local percent = (value - Cfg.Min) / (Cfg.Max - Cfg.Min)
            Items.Fill.Size = dim2(percent, 0, 1, 0)
            Items.Value.Text = tostring(value) .. Cfg.Suffix

            Cfg.Callback(value)
        end

        Items.Bar.MouseButton1Down:Connect(function()
            Cfg.Dragging = true
        end)

        Library:Connection(InputService.InputEnded, function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 then
                Cfg.Dragging = false
            end
        end)

        Library:Connection(InputService.InputChanged, function(input)
            if Cfg.Dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
                local percent = math.clamp((input.Position.X - Items.Bar.AbsolutePosition.X) / Items.Bar.AbsoluteSize.X, 0, 1)
                local value = Cfg.Min + (Cfg.Max - Cfg.Min) * percent
                Cfg.Set(value)
            end
        end)

        Cfg.Set(Cfg.Default)
        ConfigFlags[Cfg.Flag] = Cfg.Set

        return setmetatable(Cfg, Library)
    end

    -- ═══════════════════════════════════════════════════════════════════════
    -- DROPDOWN
    -- ═══════════════════════════════════════════════════════════════════════

    function Library:Dropdown(properties)
        local Cfg = {
            Name = properties.Name or "Dropdown",
            Flag = properties.Flag or properties.Name or "Dropdown",
            Options = properties.Options or {},
            Default = properties.Default,
            Multi = properties.Multi or false,
            Callback = properties.Callback or function() end,
            Open = false,
            Selected = {},
            OptionButtons = {},
            Items = {},
        }

        if Cfg.Multi then
            Cfg.Selected = type(Cfg.Default) == "table" and Cfg.Default or {}
        else
            Cfg.Selected = Cfg.Default or Cfg.Options[1] or ""
        end
        Flags[Cfg.Flag] = Cfg.Selected

        local Items = Cfg.Items

        Items.Container = Library:Create("Frame", {
            Parent = self.Items.Elements,
            Size = dim2(1, 0, 0, 52),
            BackgroundTransparency = 1,
        })

        Items.Label = Library:Create("TextLabel", {
            Parent = Items.Container,
            Size = dim2(1, 0, 0, 18),
            BackgroundTransparency = 1,
            Font = Enum.Font.GothamMedium,
            Text = Cfg.Name,
            TextColor3 = themes.preset.text_color,
            TextSize = 13,
            TextXAlignment = Enum.TextXAlignment.Left,
        })
        Library:Themify(Items.Label, "text_color", "TextColor3")

        Items.Button = Library:Create("TextButton", {
            Parent = Items.Container,
            Position = dim2(0, 0, 0, 22),
            Size = dim2(1, 0, 0, 28),
            BackgroundColor3 = themes.preset.inline,
            AutoButtonColor = false,
            Text = "",
        })
        Library:Create("UICorner", {CornerRadius = dim(0, 6), Parent = Items.Button})

        Items.Selected = Library:Create("TextLabel", {
            Parent = Items.Button,
            Position = dim2(0, 10, 0, 0),
            Size = dim2(1, -35, 1, 0),
            BackgroundTransparency = 1,
            Font = Enum.Font.GothamMedium,
            Text = Cfg.Multi and table.concat(Cfg.Selected, ", ") or tostring(Cfg.Selected),
            TextColor3 = themes.preset.text_dark,
            TextSize = 12,
            TextXAlignment = Enum.TextXAlignment.Left,
            TextTruncate = Enum.TextTruncate.AtEnd,
        })

        Items.Arrow = Library:Create("ImageLabel", {
            Parent = Items.Button,
            Position = dim2(1, -25, 0.5, 0),
            AnchorPoint = vec2(0, 0.5),
            Size = dim2(0, 12, 0, 12),
            BackgroundTransparency = 1,
            Image = "rbxassetid://7072706663",
            ImageColor3 = themes.preset.deselected,
            Rotation = 0,
        })

        -- Popup
        Items.Popup = Library:Create("Frame", {
            Parent = Library.PopupGui,
            Size = dim2(0, 0, 0, 0),
            AutomaticSize = Enum.AutomaticSize.Y,
            BackgroundColor3 = themes.preset.visible_backgrounds,
            Visible = false,
            ZIndex = 100,
            ClipsDescendants = true,
        })
        Library:Themify(Items.Popup, "visible_backgrounds", "BackgroundColor3")
        Library:Create("UICorner", {CornerRadius = dim(0, 6), Parent = Items.Popup})
        Library:Create("UIStroke", {Color = themes.preset.window_border, Thickness = 1, Parent = Items.Popup})

        Items.PopupContent = Library:Create("Frame", {
            Parent = Items.Popup,
            Size = dim2(1, 0, 0, 0),
            AutomaticSize = Enum.AutomaticSize.Y,
            BackgroundTransparency = 1,
        })

        Library:Create("UIListLayout", {
            Parent = Items.PopupContent,
            Padding = dim(0, 2),
            SortOrder = Enum.SortOrder.LayoutOrder,
        })

        Library:Create("UIPadding", {
            Parent = Items.PopupContent,
            PaddingTop = dim(0, 4),
            PaddingBottom = dim(0, 4),
            PaddingLeft = dim(0, 4),
            PaddingRight = dim(0, 4),
        })

        local function UpdateDisplay()
            if Cfg.Multi then
                Items.Selected.Text = #Cfg.Selected > 0 and table.concat(Cfg.Selected, ", ") or "Select..."
            else
                Items.Selected.Text = Cfg.Selected ~= "" and tostring(Cfg.Selected) or "Select..."
            end
        end

        local function CreateOption(name)
            local OptionBtn = Library:Create("TextButton", {
                Parent = Items.PopupContent,
                Size = dim2(1, 0, 0, 26),
                BackgroundColor3 = themes.preset.hover,
                BackgroundTransparency = 1,
                AutoButtonColor = false,
                Text = "",
            })
            Library:Create("UICorner", {CornerRadius = dim(0, 4), Parent = OptionBtn})

            local OptionLabel = Library:Create("TextLabel", {
                Parent = OptionBtn,
                Position = dim2(0, 8, 0, 0),
                Size = dim2(1, -16, 1, 0),
                BackgroundTransparency = 1,
                Font = Enum.Font.GothamMedium,
                Text = name,
                TextColor3 = themes.preset.text_dark,
                TextSize = 12,
                TextXAlignment = Enum.TextXAlignment.Left,
            })

            local function UpdateVisual()
                local isSelected = Cfg.Multi and table.find(Cfg.Selected, name) or Cfg.Selected == name
                Library:Tween(OptionBtn, {BackgroundTransparency = isSelected and 0 or 1})
                Library:Tween(OptionLabel, {TextColor3 = isSelected and themes.preset.text_color or themes.preset.text_dark})
            end

            OptionBtn.MouseEnter:Connect(function()
                local isSelected = Cfg.Multi and table.find(Cfg.Selected, name) or Cfg.Selected == name
                if not isSelected then
                    Library:Tween(OptionBtn, {BackgroundTransparency = 0.5})
                end
            end)

            OptionBtn.MouseLeave:Connect(function()
                UpdateVisual()
            end)

            OptionBtn.MouseButton1Click:Connect(function()
                if Cfg.Multi then
                    local idx = table.find(Cfg.Selected, name)
                    if idx then
                        table.remove(Cfg.Selected, idx)
                    else
                        table.insert(Cfg.Selected, name)
                    end
                else
                    Cfg.Selected = name
                    Cfg.Open = false
                    Items.Popup.Visible = false
                    Library:Tween(Items.Arrow, {Rotation = 0})
                end

                UpdateDisplay()
                UpdateVisual()
                Flags[Cfg.Flag] = Cfg.Selected
                Cfg.Callback(Cfg.Selected)
            end)

            Cfg.OptionButtons[name] = {Button = OptionBtn, Label = OptionLabel, Update = UpdateVisual}
            UpdateVisual()
        end

        function Cfg.Set(value)
            if Cfg.Multi then
                Cfg.Selected = type(value) == "table" and value or {value}
            else
                Cfg.Selected = value
            end
            UpdateDisplay()
            for name, data in pairs(Cfg.OptionButtons) do
                data.Update()
            end
            Flags[Cfg.Flag] = Cfg.Selected
            Cfg.Callback(Cfg.Selected)
        end

        function Cfg.RefreshOptions(newOptions)
            for _, data in pairs(Cfg.OptionButtons) do
                data.Button:Destroy()
            end
            Cfg.OptionButtons = {}
            Cfg.Options = newOptions
            for _, name in ipairs(newOptions) do
                CreateOption(name)
            end
        end

        for _, name in ipairs(Cfg.Options) do
            CreateOption(name)
        end

        Items.Button.MouseButton1Click:Connect(function()
            Cfg.Open = not Cfg.Open
            Items.Popup.Visible = Cfg.Open
            Library:Tween(Items.Arrow, {Rotation = Cfg.Open and 180 or 0})

            if Cfg.Open then
                local pos = Items.Button.AbsolutePosition
                local size = Items.Button.AbsoluteSize
                Items.Popup.Position = dim2(0, pos.X, 0, pos.Y + size.Y + 5)
                Items.Popup.Size = dim_offset(size.X, 0)
            end
        end)

        Library:Connection(InputService.InputBegan, function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 then
                if Cfg.Open and not Library:Hovering({Items.Button, Items.Popup}) then
                    Cfg.Open = false
                    Items.Popup.Visible = false
                    Library:Tween(Items.Arrow, {Rotation = 0})
                end
            end
        end)

        UpdateDisplay()
        ConfigFlags[Cfg.Flag] = Cfg.Set

        return setmetatable(Cfg, Library)
    end

    -- ═══════════════════════════════════════════════════════════════════════
    -- TEXTBOX
    -- ═══════════════════════════════════════════════════════════════════════

    function Library:Textbox(properties)
        local Cfg = {
            Name = properties.Name or "Textbox",
            Flag = properties.Flag or properties.Name or "Textbox",
            Default = properties.Default or "",
            Placeholder = properties.Placeholder or properties.PlaceHolder or "Enter text...",
            Callback = properties.Callback or function() end,
            Items = {},
        }

        Flags[Cfg.Flag] = Cfg.Default

        local Items = Cfg.Items

        Items.Container = Library:Create("Frame", {
            Parent = self.Items.Elements,
            Size = dim2(1, 0, 0, 52),
            BackgroundTransparency = 1,
        })

        Items.Label = Library:Create("TextLabel", {
            Parent = Items.Container,
            Size = dim2(1, 0, 0, 18),
            BackgroundTransparency = 1,
            Font = Enum.Font.GothamMedium,
            Text = Cfg.Name,
            TextColor3 = themes.preset.text_color,
            TextSize = 13,
            TextXAlignment = Enum.TextXAlignment.Left,
        })
        Library:Themify(Items.Label, "text_color", "TextColor3")

        Items.Input = Library:Create("TextBox", {
            Parent = Items.Container,
            Position = dim2(0, 0, 0, 22),
            Size = dim2(1, 0, 0, 28),
            BackgroundColor3 = themes.preset.inline,
            Font = Enum.Font.GothamMedium,
            Text = Cfg.Default,
            PlaceholderText = Cfg.Placeholder,
            TextColor3 = themes.preset.text_color,
            PlaceholderColor3 = themes.preset.deselected,
            TextSize = 12,
            TextXAlignment = Enum.TextXAlignment.Left,
            ClearTextOnFocus = false,
        })
        Library:Create("UICorner", {CornerRadius = dim(0, 6), Parent = Items.Input})
        Library:Create("UIPadding", {PaddingLeft = dim(0, 10), PaddingRight = dim(0, 10), Parent = Items.Input})

        function Cfg.Set(text)
            Items.Input.Text = text
            Flags[Cfg.Flag] = text
            Cfg.Callback(text)
        end

        Items.Input.FocusLost:Connect(function()
            Flags[Cfg.Flag] = Items.Input.Text
            Cfg.Callback(Items.Input.Text)
        end)

        ConfigFlags[Cfg.Flag] = Cfg.Set

        return setmetatable(Cfg, Library)
    end

    -- ═══════════════════════════════════════════════════════════════════════
    -- BUTTON
    -- ═══════════════════════════════════════════════════════════════════════

    function Library:Button(properties)
        local Cfg = {
            Name = properties.Name or "Button",
            Callback = properties.Callback or function() end,
            Items = {},
        }

        local Items = Cfg.Items

        Items.Button = Library:Create("TextButton", {
            Parent = self.Items.Elements,
            Size = dim2(1, 0, 0, 32),
            BackgroundColor3 = themes.preset.inline,
            AutoButtonColor = false,
            Text = "",
            ClipsDescendants = true,
        })
        Library:Create("UICorner", {CornerRadius = dim(0, 6), Parent = Items.Button})

        Items.Label = Library:Create("TextLabel", {
            Parent = Items.Button,
            Size = dim2(1, 0, 1, 0),
            BackgroundTransparency = 1,
            Font = Enum.Font.GothamMedium,
            Text = Cfg.Name,
            TextColor3 = themes.preset.text_color,
            TextSize = 13,
        })
        Library:Themify(Items.Label, "text_color", "TextColor3")

        Items.Button.MouseEnter:Connect(function()
            Library:Tween(Items.Button, {BackgroundColor3 = themes.preset.hover})
        end)

        Items.Button.MouseLeave:Connect(function()
            Library:Tween(Items.Button, {BackgroundColor3 = themes.preset.inline})
        end)

        Items.Button.MouseButton1Click:Connect(function()
            Library:Ripple(Items.Button)
            Cfg.Callback()
        end)

        return setmetatable(Cfg, Library)
    end

    -- ═══════════════════════════════════════════════════════════════════════
    -- LABEL
    -- ═══════════════════════════════════════════════════════════════════════

    function Library:Label(properties)
        local Cfg = {
            Name = properties.Name or properties.Text or "Label",
            Items = {},
        }

        local Items = Cfg.Items

        Items.Container = Library:Create("Frame", {
            Parent = self.Items.Elements,
            Size = dim2(1, 0, 0, 28),
            BackgroundTransparency = 1,
        })

        Items.Label = Library:Create("TextLabel", {
            Parent = Items.Container,
            Size = dim2(1, -50, 1, 0),
            BackgroundTransparency = 1,
            Font = Enum.Font.GothamMedium,
            Text = Cfg.Name,
            TextColor3 = themes.preset.text_color,
            TextSize = 13,
            TextXAlignment = Enum.TextXAlignment.Left,
        })
        Library:Themify(Items.Label, "text_color", "TextColor3")

        Items.Components = Library:Create("Frame", {
            Parent = Items.Container,
            Position = dim2(1, 0, 0.5, 0),
            AnchorPoint = vec2(1, 0.5),
            Size = dim2(0, 0, 0, 26),
            AutomaticSize = Enum.AutomaticSize.X,
            BackgroundTransparency = 1,
        })

        Library:Create("UIListLayout", {
            Parent = Items.Components,
            FillDirection = Enum.FillDirection.Horizontal,
            HorizontalAlignment = Enum.HorizontalAlignment.Right,
            Padding = dim(0, 8),
            SortOrder = Enum.SortOrder.LayoutOrder,
        })

        function Cfg.Set(text)
            Items.Label.Text = text
        end

        function Cfg:Colorpicker(options)
            Library:CreateColorpicker(Items.Components, options)
            return Cfg
        end

        return setmetatable(Cfg, Library)
    end

    -- ═══════════════════════════════════════════════════════════════════════
    -- CONFIG TAB HELPER
    -- ═══════════════════════════════════════════════════════════════════════

    function Library:Configs(window)
        local Tab = window:Tab({Name = "Settings", Icon = "rbxassetid://7733715400"})

        local ConfigSection = Tab:Section({Name = "Configurations", Side = "Left"})
        ConfigHolder = ConfigSection:Dropdown({
            Name = "Config",
            Flag = "_config_selected",
            Options = Library:GetConfigs(),
            Callback = function(sel)
                if ConfigFlags["_config_name"] then
                    ConfigFlags["_config_name"](sel)
                end
            end
        })
        Library:UpdateConfigList()

        ConfigSection:Textbox({
            Name = "Config Name",
            Flag = "_config_name",
            Placeholder = "Enter name...",
        })

        ConfigSection:Button({
            Name = "Save Config",
            Callback = function()
                local name = Flags["_config_name"]
                if name and name ~= "" then
                    writefile(Library.Directory .. "/configs/" .. name .. ".cfg", Library:GetConfig())
                    Library:UpdateConfigList()
                    Notifications:Create({Name = "Saved: " .. name, Type = "Success"})
                end
            end
        })

        ConfigSection:Button({
            Name = "Load Config",
            Callback = function()
                local name = Flags["_config_name"]
                if name and name ~= "" then
                    local path = Library.Directory .. "/configs/" .. name .. ".cfg"
                    if isfile(path) then
                        Library:LoadConfig(readfile(path))
                        Notifications:Create({Name = "Loaded: " .. name, Type = "Success"})
                    end
                end
            end
        })

        ConfigSection:Button({
            Name = "Delete Config",
            Callback = function()
                local name = Flags["_config_name"]
                if name and name ~= "" then
                    pcall(function() delfile(Library.Directory .. "/configs/" .. name .. ".cfg") end)
                    Library:UpdateConfigList()
                    Notifications:Create({Name = "Deleted: " .. name, Type = "Warning"})
                end
            end
        })

        ConfigSection:Button({
            Name = "Refresh List",
            Callback = function()
                Library:UpdateConfigList()
            end
        })

        -- Theme Section
        local ThemeSection = Tab:Section({Name = "Theme", Side = "Right"})

        ThemeSection:Label({Name = "Accent"}):Colorpicker({
            Flag = "_theme_accent",
            Color = themes.preset.accent,
            Callback = function(c) Library:RefreshTheme("accent", c) end
        })

        ThemeSection:Label({Name = "Background"}):Colorpicker({
            Flag = "_theme_bg",
            Color = themes.preset.background,
            Callback = function(c) Library:RefreshTheme("background", c) end
        })

        ThemeSection:Label({Name = "Text Color"}):Colorpicker({
            Flag = "_theme_text",
            Color = themes.preset.text_color,
            Callback = function(c) Library:RefreshTheme("text_color", c) end
        })

        -- Menu Section
        local MenuSection = Tab:Section({Name = "Menu", Side = "Left"})

        window.Tweening = true
        MenuSection:Toggle({
            Name = "Menu Visible",
            Flag = "_menu_visible",
            Default = true,
        }):Keybind({
            Name = "Toggle Key",
            Flag = "_menu_key",
            Key = Enum.KeyCode.RightShift,
            Mode = "Toggle",
            Callback = function(active)
                if not window.Tweening then
                    window.ToggleMenu(active)
                end
            end
        })
        task.delay(0.5, function() window.Tweening = false end)

        -- Info Section
        local InfoSection = Tab:Section({Name = "Info", Side = "Right"})
        InfoSection:Label({Name = "Xezios UI - Revamped"})
        InfoSection:Label({Name = "Version 2.0"})

        InfoSection:Button({
            Name = "Unload",
            Callback = function()
                Library:Unload()
            end
        })
    end

    -- ═══════════════════════════════════════════════════════════════════════
    -- NOTIFICATIONS
    -- ═══════════════════════════════════════════════════════════════════════

    function Notifications:Create(options)
        local title = options.Name or options.Title or "Notification"
        local duration = options.Duration or options.Lifetime or 3
        local notifType = options.Type or "Info"

        local typeColors = {
            Info = themes.preset.accent,
            Success = themes.preset.success,
            Warning = rgb(251, 191, 36),
            Error = themes.preset.error,
        }

        local Notif = Library:Create("Frame", {
            Parent = Library.ScreenGui,
            Position = dim_offset(-300, 50),
            Size = dim2(0, 280, 0, 0),
            AutomaticSize = Enum.AutomaticSize.Y,
            BackgroundColor3 = themes.preset.visible_backgrounds,
            ClipsDescendants = true,
        })
        Library:Create("UICorner", {CornerRadius = dim(0, 8), Parent = Notif})
        Library:Create("UIStroke", {Color = themes.preset.window_border, Thickness = 1, Parent = Notif})

        local Accent = Library:Create("Frame", {
            Parent = Notif,
            Size = dim2(0, 4, 1, 0),
            BackgroundColor3 = typeColors[notifType] or themes.preset.accent,
        })
        Library:Create("UICorner", {CornerRadius = dim(0, 8), Parent = Accent})

        local Content = Library:Create("Frame", {
            Parent = Notif,
            Position = dim2(0, 12, 0, 0),
            Size = dim2(1, -16, 0, 0),
            AutomaticSize = Enum.AutomaticSize.Y,
            BackgroundTransparency = 1,
        })

        Library:Create("UIPadding", {
            Parent = Content,
            PaddingTop = dim(0, 12),
            PaddingBottom = dim(0, 12),
        })

        Library:Create("TextLabel", {
            Parent = Content,
            Size = dim2(1, 0, 0, 0),
            AutomaticSize = Enum.AutomaticSize.Y,
            BackgroundTransparency = 1,
            Font = Enum.Font.GothamMedium,
            Text = title,
            TextColor3 = themes.preset.text_color,
            TextSize = 13,
            TextWrapped = true,
            TextXAlignment = Enum.TextXAlignment.Left,
        })

        local idx = #Notifications.Notifs + 1
        Notifications.Notifs[idx] = Notif

        -- Position
        local yOffset = 50
        for i = 1, idx - 1 do
            local n = Notifications.Notifs[i]
            if n and n.Parent then
                yOffset = yOffset + n.AbsoluteSize.Y + 10
            end
        end

        Notif.Position = dim_offset(-300, yOffset)
        Library:Tween(Notif, {Position = dim_offset(20, yOffset)}, TweenInfo.new(0.4, Enum.EasingStyle.Back))

        task.spawn(function()
            task.wait(duration)
            Library:Tween(Notif, {Position = dim_offset(-300, Notif.Position.Y.Offset)}, TweenInfo.new(0.3))
            task.wait(0.3)
            Notifications.Notifs[idx] = nil
            Notif:Destroy()

            -- Reposition
            local newY = 50
            for _, n in pairs(Notifications.Notifs) do
                if n and n.Parent then
                    Library:Tween(n, {Position = dim_offset(20, newY)})
                    newY = newY + n.AbsoluteSize.Y + 10
                end
            end
        end)
    end

return Library
