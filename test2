-- ══════════════════════════════════════════════════════════════════════
-- AZRIX UI LIBRARY V2 - COMPACT DESIGN
-- ══════════════════════════════════════════════════════════════════════

local AzrixLibrary = {}
AzrixLibrary.__index = AzrixLibrary

-- Services
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local HttpService = game:GetService("HttpService")
local CoreGui = game:GetService("CoreGui")

local LocalPlayer = Players.LocalPlayer
local Mouse = LocalPlayer:GetMouse()

-- Configuration
local Config = {
    ToggleKey = Enum.KeyCode.Insert,
    ConfigFolder = "AzrixConfigs"
}

-- Color Scheme
local Colors = {
    Background = Color3.fromRGB(20, 20, 20),
    TopBar = Color3.fromRGB(15, 15, 15),
    TabBar = Color3.fromRGB(18, 18, 18),
    Section = Color3.fromRGB(25, 25, 25),
    SectionHeader = Color3.fromRGB(30, 30, 30),
    Element = Color3.fromRGB(32, 32, 32),
    ElementHover = Color3.fromRGB(38, 38, 38),
    Border = Color3.fromRGB(45, 45, 45),
    Accent = Color3.fromRGB(90, 120, 190),
    AccentHover = Color3.fromRGB(110, 140, 210),
    Text = Color3.fromRGB(210, 210, 210),
    TextDark = Color3.fromRGB(140, 140, 140),
    TextDisabled = Color3.fromRGB(80, 80, 80),
    Toggle = Color3.fromRGB(40, 40, 40),
    ToggleEnabled = Color3.fromRGB(90, 120, 190),
    Slider = Color3.fromRGB(35, 35, 35),
    SliderFill = Color3.fromRGB(90, 120, 190),
    Input = Color3.fromRGB(28, 28, 28),
    Success = Color3.fromRGB(70, 160, 90),
    Error = Color3.fromRGB(180, 70, 70),
    Warning = Color3.fromRGB(180, 150, 70)
}

-- Utility Functions
local function Tween(obj, time, props)
    local tween = TweenService:Create(obj, TweenInfo.new(time, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), props)
    tween:Play()
    return tween
end

local function Create(class, props)
    local obj = Instance.new(class)
    for k, v in pairs(props) do
        if k ~= "Parent" then
            obj[k] = v
        end
    end
    if props.Parent then
        obj.Parent = props.Parent
    end
    return obj
end

local function Corner(parent, radius)
    return Create("UICorner", {CornerRadius = UDim.new(0, radius or 4), Parent = parent})
end

local function Stroke(parent, color, thickness)
    return Create("UIStroke", {Color = color or Colors.Border, Thickness = thickness or 1, Parent = parent})
end

local function GetKeyName(key)
    if key == nil or key == Enum.KeyCode.Unknown then return "..." end
    return key.Name
end

local function GetKeyCode(name)
    if not name or name == "..." or name == "Unknown" then return Enum.KeyCode.Unknown end
    local s, r = pcall(function() return Enum.KeyCode[name] end)
    return s and r or Enum.KeyCode.Unknown
end

-- Library Core
AzrixLibrary.Windows = {}
AzrixLibrary.Flags = {}
AzrixLibrary.Connections = {}
AzrixLibrary.ToggleKey = Config.ToggleKey
AzrixLibrary.Visible = true
AzrixLibrary.ConfigFolder = Config.ConfigFolder

-- Notifications
AzrixLibrary.Notifications = {}

function AzrixLibrary.Notifications:Create(opts)
    opts = opts or {}
    local text = opts.Name or "Notification"
    local duration = opts.Lifetime or 3
    local nType = opts.Type or "Info"
    
    local container = AzrixLibrary._NotifContainer
    if not container then return end
    
    local notif = Create("Frame", {
        Size = UDim2.new(1, 0, 0, 32),
        BackgroundColor3 = Colors.Section,
        BorderSizePixel = 0,
        Position = UDim2.new(1, 20, 0, 0),
        Parent = container
    })
    Corner(notif, 4)
    Stroke(notif, Colors.Border)
    
    local accent = Create("Frame", {
        Size = UDim2.new(0, 3, 1, 0),
        BackgroundColor3 = nType == "Success" and Colors.Success or nType == "Error" and Colors.Error or Colors.Accent,
        BorderSizePixel = 0,
        Parent = notif
    })
    Corner(accent, 4)
    
    Create("TextLabel", {
        Size = UDim2.new(1, -15, 1, 0),
        Position = UDim2.new(0, 12, 0, 0),
        BackgroundTransparency = 1,
        Text = text,
        TextColor3 = Colors.Text,
        TextSize = 12,
        Font = Enum.Font.Gotham,
        TextXAlignment = Enum.TextXAlignment.Left,
        Parent = notif
    })
    
    Tween(notif, 0.25, {Position = UDim2.new(0, 0, 0, 0)})
    
    task.delay(duration, function()
        Tween(notif, 0.25, {Position = UDim2.new(1, 20, 0, 0)}).Completed:Wait()
        notif:Destroy()
    end)
end

-- Config System
function AzrixLibrary:SaveConfig(name)
    if not isfolder then return false end
    name = name or "default"
    if not isfolder(self.ConfigFolder) then makefolder(self.ConfigFolder) end
    
    local data = {}
    for flag, value in pairs(self.Flags) do
        if type(value) == "table" then
            if value.Color then
                data[flag] = {T = "Color", R = value.Color.R, G = value.Color.G, B = value.Color.B, A = value.Alpha}
            elseif value.Key then
                data[flag] = {T = "Key", K = GetKeyName(value.Key), M = value.Mode}
            else
                data[flag] = {T = "Tbl", V = value}
            end
        elseif typeof(value) == "Color3" then
            data[flag] = {T = "C3", R = value.R, G = value.G, B = value.B}
        else
            data[flag] = {T = "Val", V = value}
        end
    end
    
    local s = pcall(function() writefile(self.ConfigFolder .. "/" .. name .. ".json", HttpService:JSONEncode(data)) end)
    return s
end

function AzrixLibrary:LoadConfig(name)
    if not isfile then return false end
    name = name or "default"
    local path = self.ConfigFolder .. "/" .. name .. ".json"
    if not isfile(path) then return false end
    
    local s, data = pcall(function() return HttpService:JSONDecode(readfile(path)) end)
    if not s then return false end
    
    for flag, info in pairs(data) do
        if self.Flags[flag] ~= nil then
            if info.T == "Color" then
                self.Flags[flag] = {Color = Color3.new(info.R, info.G, info.B), Alpha = info.A}
            elseif info.T == "Key" then
                self.Flags[flag] = {Key = GetKeyCode(info.K), Mode = info.M}
            elseif info.T == "C3" then
                self.Flags[flag] = Color3.new(info.R, info.G, info.B)
            elseif info.T == "Tbl" then
                self.Flags[flag] = info.V
            else
                self.Flags[flag] = info.V
            end
        end
    end
    return true
end

function AzrixLibrary:GetConfigs()
    if not isfolder or not listfiles then return {} end
    if not isfolder(self.ConfigFolder) then makefolder(self.ConfigFolder) return {} end
    local configs = {}
    for _, f in pairs(listfiles(self.ConfigFolder)) do
        local n = f:match("([^/\\]+)%.json$")
        if n then table.insert(configs, n) end
    end
    return configs
end

function AzrixLibrary:DeleteConfig(name)
    if not isfile or not delfile then return false end
    local path = self.ConfigFolder .. "/" .. name .. ".json"
    if isfile(path) then delfile(path) return true end
    return false
end

-- Window
function AzrixLibrary:Window(opts)
    opts = opts or {}
    local title = opts.Title or "AZRIX"
    local subtitle = opts.Subtitle or "CLIENT"
    local size = opts.Size or UDim2.new(0, 650, 0, 450)
    
    local Window = {Tabs = {}, ActiveTab = nil}
    
    -- ScreenGui
    local gui = Create("ScreenGui", {
        Name = "AzrixUI",
        ZIndexBehavior = Enum.ZIndexBehavior.Sibling,
        ResetOnSpawn = false
    })
    
    if syn and syn.protect_gui then
        syn.protect_gui(gui)
        gui.Parent = CoreGui
    elseif gethui then
        gui.Parent = gethui()
    else
        pcall(function() gui.Parent = CoreGui end)
        if not gui.Parent then gui.Parent = LocalPlayer:WaitForChild("PlayerGui") end
    end
    
    -- Notifications
    local notifContainer = Create("Frame", {
        Size = UDim2.new(0, 220, 1, -20),
        Position = UDim2.new(1, -230, 0, 10),
        BackgroundTransparency = 1,
        Parent = gui
    })
    Create("UIListLayout", {Padding = UDim.new(0, 5), Parent = notifContainer})
    AzrixLibrary._NotifContainer = notifContainer
    
    -- Main Frame
    local main = Create("Frame", {
        Size = size,
        Position = UDim2.new(0.5, -size.X.Offset/2, 0.5, -size.Y.Offset/2),
        BackgroundColor3 = Colors.Background,
        BorderSizePixel = 0,
        Parent = gui
    })
    Corner(main, 6)
    Stroke(main, Colors.Border)
    
    -- Top Bar
    local topBar = Create("Frame", {
        Size = UDim2.new(1, 0, 0, 32),
        BackgroundColor3 = Colors.TopBar,
        BorderSizePixel = 0,
        Parent = main
    })
    Corner(topBar, 6)
    Create("Frame", {Size = UDim2.new(1, 0, 0, 6), Position = UDim2.new(0, 0, 1, -6), BackgroundColor3 = Colors.TopBar, BorderSizePixel = 0, Parent = topBar})
    
    -- Title
    Create("TextLabel", {
        Size = UDim2.new(0, 100, 1, 0),
        Position = UDim2.new(0, 12, 0, 0),
        BackgroundTransparency = 1,
        Text = title,
        TextColor3 = Colors.Accent,
        TextSize = 14,
        Font = Enum.Font.GothamBold,
        TextXAlignment = Enum.TextXAlignment.Left,
        Parent = topBar
    })
    
    Create("TextLabel", {
        Size = UDim2.new(0, 100, 1, 0),
        Position = UDim2.new(0, 12 + #title * 9, 0, 0),
        BackgroundTransparency = 1,
        Text = subtitle,
        TextColor3 = Colors.TextDark,
        TextSize = 14,
        Font = Enum.Font.Gotham,
        TextXAlignment = Enum.TextXAlignment.Left,
        Parent = topBar
    })
    
    -- Close Button
    local closeBtn = Create("TextButton", {
        Size = UDim2.new(0, 32, 0, 32),
        Position = UDim2.new(1, -32, 0, 0),
        BackgroundTransparency = 1,
        Text = "×",
        TextColor3 = Colors.TextDark,
        TextSize = 20,
        Font = Enum.Font.GothamBold,
        Parent = topBar
    })
    
    closeBtn.MouseEnter:Connect(function() Tween(closeBtn, 0.1, {TextColor3 = Colors.Error}) end)
    closeBtn.MouseLeave:Connect(function() Tween(closeBtn, 0.1, {TextColor3 = Colors.TextDark}) end)
    closeBtn.MouseButton1Click:Connect(function()
        AzrixLibrary.Visible = false
        main.Visible = false
    end)
    
    -- Tab Bar (Left Side)
    local tabBar = Create("Frame", {
        Size = UDim2.new(0, 120, 1, -42),
        Position = UDim2.new(0, 5, 0, 37),
        BackgroundColor3 = Colors.TabBar,
        BorderSizePixel = 0,
        Parent = main
    })
    Corner(tabBar, 4)
    
    local tabList = Create("Frame", {
        Size = UDim2.new(1, -10, 1, -10),
        Position = UDim2.new(0, 5, 0, 5),
        BackgroundTransparency = 1,
        Parent = tabBar
    })
    Create("UIListLayout", {Padding = UDim.new(0, 3), Parent = tabList})
    
    -- Content Area
    local content = Create("Frame", {
        Size = UDim2.new(1, -135, 1, -42),
        Position = UDim2.new(0, 130, 0, 37),
        BackgroundColor3 = Colors.TabBar,
        BorderSizePixel = 0,
        Parent = main
    })
    Corner(content, 4)
    
    -- Dragging
    local dragging, dragStart, startPos = false, nil, nil
    
    topBar.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = main.Position
        end
    end)
    
    topBar.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = false
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            local delta = input.Position - dragStart
            main.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        end
    end)
    
    -- Tab Function
    function Window:Tab(opts)
        opts = opts or {}
        local name = opts.Name or "Tab"
        
        local Tab = {}
        
        -- Tab Button
        local tabBtn = Create("TextButton", {
            Size = UDim2.new(1, 0, 0, 28),
            BackgroundColor3 = Colors.Element,
            BackgroundTransparency = 1,
            BorderSizePixel = 0,
            Text = name,
            TextColor3 = Colors.TextDark,
            TextSize = 12,
            Font = Enum.Font.Gotham,
            Parent = tabList
        })
        Corner(tabBtn, 4)
        
        -- Tab Content
        local tabContent = Create("Frame", {
            Size = UDim2.new(1, 0, 1, 0),
            BackgroundTransparency = 1,
            Visible = false,
            Parent = content
        })
        
        -- Two Columns
        local leftCol = Create("ScrollingFrame", {
            Size = UDim2.new(0.5, -5, 1, -10),
            Position = UDim2.new(0, 5, 0, 5),
            BackgroundTransparency = 1,
            BorderSizePixel = 0,
            ScrollBarThickness = 2,
            ScrollBarImageColor3 = Colors.Accent,
            CanvasSize = UDim2.new(0, 0, 0, 0),
            AutomaticCanvasSize = Enum.AutomaticSize.Y,
            Parent = tabContent
        })
        Create("UIListLayout", {Padding = UDim.new(0, 5), Parent = leftCol})
        Create("UIPadding", {PaddingRight = UDim.new(0, 5), Parent = leftCol})
        
        local rightCol = Create("ScrollingFrame", {
            Size = UDim2.new(0.5, -5, 1, -10),
            Position = UDim2.new(0.5, 0, 0, 5),
            BackgroundTransparency = 1,
            BorderSizePixel = 0,
            ScrollBarThickness = 2,
            ScrollBarImageColor3 = Colors.Accent,
            CanvasSize = UDim2.new(0, 0, 0, 0),
            AutomaticCanvasSize = Enum.AutomaticSize.Y,
            Parent = tabContent
        })
        Create("UIListLayout", {Padding = UDim.new(0, 5), Parent = rightCol})
        Create("UIPadding", {PaddingRight = UDim.new(0, 5), Parent = rightCol})
        
        local function SelectTab()
            for _, t in pairs(Window.Tabs) do
                t.Btn.BackgroundTransparency = 1
                t.Btn.TextColor3 = Colors.TextDark
                t.Content.Visible = false
            end
            tabBtn.BackgroundTransparency = 0
            tabBtn.BackgroundColor3 = Colors.Element
            tabBtn.TextColor3 = Colors.Text
            tabContent.Visible = true
            Window.ActiveTab = Tab
        end
        
        tabBtn.MouseButton1Click:Connect(SelectTab)
        tabBtn.MouseEnter:Connect(function()
            if Window.ActiveTab ~= Tab then
                Tween(tabBtn, 0.1, {BackgroundTransparency = 0.5})
            end
        end)
        tabBtn.MouseLeave:Connect(function()
            if Window.ActiveTab ~= Tab then
                Tween(tabBtn, 0.1, {BackgroundTransparency = 1})
            end
        end)
        
        -- Section Function
        function Tab:Section(opts)
            opts = opts or {}
            local sName = opts.Name or "Section"
            local side = opts.Side or "Left"
            local col = side == "Left" and leftCol or rightCol
            
            local Section = {}
            
            local sFrame = Create("Frame", {
                Size = UDim2.new(1, 0, 0, 0),
                AutomaticSize = Enum.AutomaticSize.Y,
                BackgroundColor3 = Colors.Section,
                BorderSizePixel = 0,
                Parent = col
            })
            Corner(sFrame, 4)
            Stroke(sFrame, Colors.Border)
            
            local sHeader = Create("Frame", {
                Size = UDim2.new(1, 0, 0, 24),
                BackgroundColor3 = Colors.SectionHeader,
                BorderSizePixel = 0,
                Parent = sFrame
            })
            Corner(sHeader, 4)
            Create("Frame", {Size = UDim2.new(1, 0, 0, 4), Position = UDim2.new(0, 0, 1, -4), BackgroundColor3 = Colors.SectionHeader, BorderSizePixel = 0, Parent = sHeader})
            
            Create("TextLabel", {
                Size = UDim2.new(1, -10, 1, 0),
                Position = UDim2.new(0, 8, 0, 0),
                BackgroundTransparency = 1,
                Text = sName:upper(),
                TextColor3 = Colors.Text,
                TextSize = 10,
                Font = Enum.Font.GothamMedium,
                TextXAlignment = Enum.TextXAlignment.Left,
                Parent = sHeader
            })
            
            local sContent = Create("Frame", {
                Size = UDim2.new(1, 0, 0, 0),
                Position = UDim2.new(0, 0, 0, 24),
                AutomaticSize = Enum.AutomaticSize.Y,
                BackgroundTransparency = 1,
                Parent = sFrame
            })
            Create("UIListLayout", {Padding = UDim.new(0, 2), Parent = sContent})
            Create("UIPadding", {PaddingTop = UDim.new(0, 4), PaddingBottom = UDim.new(0, 6), PaddingLeft = UDim.new(0, 6), PaddingRight = UDim.new(0, 6), Parent = sContent})
            
            -- Toggle
            function Section:Toggle(opts)
                opts = opts or {}
                local tName = opts.Name or "Toggle"
                local flag = opts.Flag or tName
                local default = opts.Default or false
                local callback = opts.Callback or function() end
                
                AzrixLibrary.Flags[flag] = default
                local Toggle = {}
                
                local tFrame = Create("Frame", {
                    Size = UDim2.new(1, 0, 0, 24),
                    BackgroundTransparency = 1,
                    Parent = sContent
                })
                
                Create("TextLabel", {
                    Size = UDim2.new(1, -45, 1, 0),
                    BackgroundTransparency = 1,
                    Text = tName,
                    TextColor3 = Colors.Text,
                    TextSize = 11,
                    Font = Enum.Font.Gotham,
                    TextXAlignment = Enum.TextXAlignment.Left,
                    Parent = tFrame
                })
                
                local tBg = Create("Frame", {
                    Size = UDim2.new(0, 32, 0, 16),
                    Position = UDim2.new(1, -32, 0.5, -8),
                    BackgroundColor3 = default and Colors.ToggleEnabled or Colors.Toggle,
                    BorderSizePixel = 0,
                    Parent = tFrame
                })
                Corner(tBg, 8)
                
                local tCircle = Create("Frame", {
                    Size = UDim2.new(0, 12, 0, 12),
                    Position = default and UDim2.new(1, -14, 0.5, -6) or UDim2.new(0, 2, 0.5, -6),
                    BackgroundColor3 = Colors.Text,
                    BorderSizePixel = 0,
                    Parent = tBg
                })
                Corner(tCircle, 6)
                
                local function SetValue(v)
                    AzrixLibrary.Flags[flag] = v
                    Tween(tBg, 0.15, {BackgroundColor3 = v and Colors.ToggleEnabled or Colors.Toggle})
                    Tween(tCircle, 0.15, {Position = v and UDim2.new(1, -14, 0.5, -6) or UDim2.new(0, 2, 0.5, -6)})
                    callback(v)
                end
                
                local tBtn = Create("TextButton", {
                    Size = UDim2.new(1, 0, 1, 0),
                    BackgroundTransparency = 1,
                    Text = "",
                    Parent = tFrame
                })
                tBtn.MouseButton1Click:Connect(function() SetValue(not AzrixLibrary.Flags[flag]) end)
                
                function Toggle:Set(v) SetValue(v) end
                function Toggle:Get() return AzrixLibrary.Flags[flag] end
                
                function Toggle:Keybind(kOpts)
                    kOpts = kOpts or {}
                    local kFlag = kOpts.Flag or flag .. "_Key"
                    local kDefault = kOpts.Key or Enum.KeyCode.Unknown
                    local kMode = kOpts.Mode or "Toggle"
                    local kCallback = kOpts.Callback or function() end
                    
                    AzrixLibrary.Flags[kFlag] = {Key = kDefault, Mode = kMode}
                    
                    local kBtn = Create("TextButton", {
                        Size = UDim2.new(0, 36, 0, 16),
                        Position = UDim2.new(1, -72, 0.5, -8),
                        BackgroundColor3 = Colors.Input,
                        BorderSizePixel = 0,
                        Text = GetKeyName(kDefault),
                        TextColor3 = Colors.TextDark,
                        TextSize = 9,
                        Font = Enum.Font.Gotham,
                        Parent = tFrame
                    })
                    Corner(kBtn, 4)
                    
                    local listening = false
                    kBtn.MouseButton1Click:Connect(function()
                        listening = true
                        kBtn.Text = "..."
                    end)
                    
                    local conn = UserInputService.InputBegan:Connect(function(input, gpe)
                        if listening then
                            if input.UserInputType == Enum.UserInputType.Keyboard then
                                if input.KeyCode == Enum.KeyCode.Escape then
                                    AzrixLibrary.Flags[kFlag].Key = Enum.KeyCode.Unknown
                                    kBtn.Text = "..."
                                else
                                    AzrixLibrary.Flags[kFlag].Key = input.KeyCode
                                    kBtn.Text = input.KeyCode.Name
                                end
                                listening = false
                            end
                        elseif not gpe then
                            local k = AzrixLibrary.Flags[kFlag].Key
                            if k and k ~= Enum.KeyCode.Unknown and input.KeyCode == k then
                                if kMode == "Toggle" then
                                    SetValue(not AzrixLibrary.Flags[flag])
                                    kCallback(AzrixLibrary.Flags[flag])
                                elseif kMode == "Hold" then
                                    SetValue(true)
                                    kCallback(true)
                                end
                            end
                        end
                    end)
                    table.insert(AzrixLibrary.Connections, conn)
                    
                    if kMode == "Hold" then
                        local conn2 = UserInputService.InputEnded:Connect(function(input)
                            local k = AzrixLibrary.Flags[kFlag].Key
                            if k and k ~= Enum.KeyCode.Unknown and input.KeyCode == k then
                                SetValue(false)
                                kCallback(false)
                            end
                        end)
                        table.insert(AzrixLibrary.Connections, conn2)
                    end
                    
                    return Toggle
                end
                
                if default then callback(default) end
                return Toggle
            end
            
            -- Slider
            function Section:Slider(opts)
                opts = opts or {}
                local sName = opts.Name or "Slider"
                local flag = opts.Flag or sName
                local min = opts.Min or 0
                local max = opts.Max or 100
                local default = opts.Default or min
                local suffix = opts.Suffix or ""
                local decimal = opts.Decimal or 1
                local callback = opts.Callback or function() end
                
                AzrixLibrary.Flags[flag] = default
                local Slider = {}
                
                local sFrame = Create("Frame", {
                    Size = UDim2.new(1, 0, 0, 32),
                    BackgroundTransparency = 1,
                    Parent = sContent
                })
                
                Create("TextLabel", {
                    Size = UDim2.new(1, -50, 0, 16),
                    BackgroundTransparency = 1,
                    Text = sName,
                    TextColor3 = Colors.Text,
                    TextSize = 11,
                    Font = Enum.Font.Gotham,
                    TextXAlignment = Enum.TextXAlignment.Left,
                    Parent = sFrame
                })
                
                local valLabel = Create("TextLabel", {
                    Size = UDim2.new(0, 45, 0, 16),
                    Position = UDim2.new(1, -45, 0, 0),
                    BackgroundTransparency = 1,
                    Text = default .. suffix,
                    TextColor3 = Colors.Accent,
                    TextSize = 11,
                    Font = Enum.Font.Gotham,
                    TextXAlignment = Enum.TextXAlignment.Right,
                    Parent = sFrame
                })
                
                local sBg = Create("Frame", {
                    Size = UDim2.new(1, 0, 0, 10),
                    Position = UDim2.new(0, 0, 0, 20),
                    BackgroundColor3 = Colors.Slider,
                    BorderSizePixel = 0,
                    Parent = sFrame
                })
                Corner(sBg, 5)
                
                local sFill = Create("Frame", {
                    Size = UDim2.new((default - min) / (max - min), 0, 1, 0),
                    BackgroundColor3 = Colors.SliderFill,
                    BorderSizePixel = 0,
                    Parent = sBg
                })
                Corner(sFill, 5)
                
                local function SetValue(v)
                    v = math.clamp(v, min, max)
                    v = math.floor(v / decimal + 0.5) * decimal
                    AzrixLibrary.Flags[flag] = v
                    valLabel.Text = v .. suffix
                    local pct = (v - min) / (max - min)
                    Tween(sFill, 0.05, {Size = UDim2.new(pct, 0, 1, 0)})
                    callback(v)
                end
                
                local sDragging = false
                sBg.InputBegan:Connect(function(input)
                    if input.UserInputType == Enum.UserInputType.MouseButton1 then
                        sDragging = true
                        local pct = math.clamp((input.Position.X - sBg.AbsolutePosition.X) / sBg.AbsoluteSize.X, 0, 1)
                        SetValue(min + (max - min) * pct)
                    end
                end)
                sBg.InputEnded:Connect(function(input)
                    if input.UserInputType == Enum.UserInputType.MouseButton1 then sDragging = false end
                end)
                
                local sConn = UserInputService.InputChanged:Connect(function(input)
                    if sDragging and input.UserInputType == Enum.UserInputType.MouseMovement then
                        local pct = math.clamp((input.Position.X - sBg.AbsolutePosition.X) / sBg.AbsoluteSize.X, 0, 1)
                        SetValue(min + (max - min) * pct)
                    end
                end)
                table.insert(AzrixLibrary.Connections, sConn)
                
                function Slider:Set(v) SetValue(v) end
                function Slider:Get() return AzrixLibrary.Flags[flag] end
                
                return Slider
            end
            
            -- Dropdown
            function Section:Dropdown(opts)
                opts = opts or {}
                local dName = opts.Name or "Dropdown"
                local flag = opts.Flag or dName
                local dOpts = opts.Options or {}
                local default = opts.Default or (opts.Multi and {} or (dOpts[1] or ""))
                local multi = opts.Multi or false
                local callback = opts.Callback or function() end
                
                AzrixLibrary.Flags[flag] = default
                local Dropdown = {}
                local isOpen = false
                
                local dFrame = Create("Frame", {
                    Size = UDim2.new(1, 0, 0, 38),
                    BackgroundTransparency = 1,
                    ClipsDescendants = true,
                    Parent = sContent
                })
                
                Create("TextLabel", {
                    Size = UDim2.new(1, 0, 0, 16),
                    BackgroundTransparency = 1,
                    Text = dName,
                    TextColor3 = Colors.Text,
                    TextSize = 11,
                    Font = Enum.Font.Gotham,
                    TextXAlignment = Enum.TextXAlignment.Left,
                    Parent = dFrame
                })
                
                local function GetText()
                    if multi then
                        local sel = AzrixLibrary.Flags[flag]
                        if type(sel) ~= "table" then sel = {} end
                        if #sel == 0 then return "None" end
                        if #sel <= 2 then return table.concat(sel, ", ") end
                        return sel[1] .. " +" .. (#sel - 1)
                    end
                    return AzrixLibrary.Flags[flag] or "None"
                end
                
                local dBtn = Create("TextButton", {
                    Size = UDim2.new(1, 0, 0, 20),
                    Position = UDim2.new(0, 0, 0, 18),
                    BackgroundColor3 = Colors.Input,
                    BorderSizePixel = 0,
                    Text = "  " .. GetText(),
                    TextColor3 = Colors.TextDark,
                    TextSize = 10,
                    Font = Enum.Font.Gotham,
                    TextXAlignment = Enum.TextXAlignment.Left,
                    Parent = dFrame
                })
                Corner(dBtn, 4)
                Stroke(dBtn, Colors.Border)
                
                local arrow = Create("TextLabel", {
                    Size = UDim2.new(0, 16, 1, 0),
                    Position = UDim2.new(1, -16, 0, 0),
                    BackgroundTransparency = 1,
                    Text = "▼",
                    TextColor3 = Colors.TextDark,
                    TextSize = 8,
                    Font = Enum.Font.Gotham,
                    Parent = dBtn
                })
                
                local optContainer = Create("Frame", {
                    Size = UDim2.new(1, 0, 0, 0),
                    Position = UDim2.new(0, 0, 0, 40),
                    BackgroundColor3 = Colors.Input,
                    BorderSizePixel = 0,
                    ClipsDescendants = true,
                    Visible = false,
                    Parent = dFrame
                })
                Corner(optContainer, 4)
                Stroke(optContainer, Colors.Border)
                Create("UIListLayout", {Parent = optContainer})
                
                local function RefreshOptions(newOpts)
                    for _, c in pairs(optContainer:GetChildren()) do
                        if c:IsA("TextButton") then c:Destroy() end
                    end
                    dOpts = newOpts or dOpts
                    
                    for i, opt in ipairs(dOpts) do
                        local oBtn = Create("TextButton", {
                            Size = UDim2.new(1, 0, 0, 20),
                            BackgroundTransparency = 1,
                            Text = "  " .. opt,
                            TextColor3 = Colors.TextDark,
                            TextSize = 10,
                            Font = Enum.Font.Gotham,
                            TextXAlignment = Enum.TextXAlignment.Left,
                            LayoutOrder = i,
                            Parent = optContainer
                        })
                        
                        oBtn.MouseEnter:Connect(function() Tween(oBtn, 0.1, {BackgroundTransparency = 0, BackgroundColor3 = Colors.ElementHover}) end)
                        oBtn.MouseLeave:Connect(function() Tween(oBtn, 0.1, {BackgroundTransparency = 1}) end)
                        
                        oBtn.MouseButton1Click:Connect(function()
                            if multi then
                                local sel = AzrixLibrary.Flags[flag]
                                if type(sel) ~= "table" then sel = {} end
                                local idx = table.find(sel, opt)
                                if idx then table.remove(sel, idx) else table.insert(sel, opt) end
                                AzrixLibrary.Flags[flag] = sel
                            else
                                AzrixLibrary.Flags[flag] = opt
                                isOpen = false
                                optContainer.Visible = false
                                Tween(dFrame, 0.15, {Size = UDim2.new(1, 0, 0, 38)})
                                Tween(arrow, 0.15, {Rotation = 0})
                            end
                            dBtn.Text = "  " .. GetText()
                            callback(AzrixLibrary.Flags[flag])
                        end)
                    end
                end
                RefreshOptions(dOpts)
                
                dBtn.MouseButton1Click:Connect(function()
                    isOpen = not isOpen
                    if isOpen then
                        optContainer.Visible = true
                        local h = math.min(#dOpts * 20, 80)
                        Tween(dFrame, 0.15, {Size = UDim2.new(1, 0, 0, 40 + h)})
                        Tween(optContainer, 0.15, {Size = UDim2.new(1, 0, 0, h)})
                        Tween(arrow, 0.15, {Rotation = 180})
                    else
                        Tween(dFrame, 0.15, {Size = UDim2.new(1, 0, 0, 38)})
                        Tween(optContainer, 0.15, {Size = UDim2.new(1, 0, 0, 0)})
                        Tween(arrow, 0.15, {Rotation = 0})
                        task.delay(0.15, function() optContainer.Visible = false end)
                    end
                end)
                
                function Dropdown:Set(v)
                    AzrixLibrary.Flags[flag] = v
                    dBtn.Text = "  " .. GetText()
                    callback(v)
                end
                function Dropdown:Get() return AzrixLibrary.Flags[flag] end
                Dropdown.RefreshOptions = RefreshOptions
                
                return Dropdown
            end
            
            -- Textbox
            function Section:Textbox(opts)
                opts = opts or {}
                local tName = opts.Name or "Textbox"
                local flag = opts.Flag or tName
                local placeholder = opts.PlaceHolder or ""
                local default = opts.Default or ""
                local callback = opts.Callback or function() end
                
                AzrixLibrary.Flags[flag] = default
                local Textbox = {}
                
                local tFrame = Create("Frame", {
                    Size = UDim2.new(1, 0, 0, 38),
                    BackgroundTransparency = 1,
                    Parent = sContent
                })
                
                Create("TextLabel", {
                    Size = UDim2.new(1, 0, 0, 16),
                    BackgroundTransparency = 1,
                    Text = tName,
                    TextColor3 = Colors.Text,
                    TextSize = 11,
                    Font = Enum.Font.Gotham,
                    TextXAlignment = Enum.TextXAlignment.Left,
                    Parent = tFrame
                })
                
                local tBox = Create("TextBox", {
                    Size = UDim2.new(1, 0, 0, 20),
                    Position = UDim2.new(0, 0, 0, 18),
                    BackgroundColor3 = Colors.Input,
                    BorderSizePixel = 0,
                    Text = default,
                    PlaceholderText = placeholder,
                    PlaceholderColor3 = Colors.TextDisabled,
                    TextColor3 = Colors.Text,
                    TextSize = 10,
                    Font = Enum.Font.Gotham,
                    ClearTextOnFocus = false,
                    Parent = tFrame
                })
                Corner(tBox, 4)
                local tStroke = Stroke(tBox, Colors.Border)
                Create("UIPadding", {PaddingLeft = UDim.new(0, 6), PaddingRight = UDim.new(0, 6), Parent = tBox})
                
                tBox.Focused:Connect(function() Tween(tStroke, 0.1, {Color = Colors.Accent}) end)
                tBox.FocusLost:Connect(function()
                    Tween(tStroke, 0.1, {Color = Colors.Border})
                    AzrixLibrary.Flags[flag] = tBox.Text
                    callback(tBox.Text)
                end)
                
                function Textbox:Set(v)
                    tBox.Text = v
                    AzrixLibrary.Flags[flag] = v
                    callback(v)
                end
                function Textbox:Get() return AzrixLibrary.Flags[flag] end
                
                return Textbox
            end
            
            -- Button
            function Section:Button(opts)
                opts = opts or {}
                local bName = opts.Name or "Button"
                local callback = opts.Callback or function() end
                
                local bBtn = Create("TextButton", {
                    Size = UDim2.new(1, 0, 0, 24),
                    BackgroundColor3 = Colors.Accent,
                    BorderSizePixel = 0,
                    Text = bName,
                    TextColor3 = Colors.Text,
                    TextSize = 11,
                    Font = Enum.Font.GothamMedium,
                    Parent = sContent
                })
                Corner(bBtn, 4)
                
                bBtn.MouseEnter:Connect(function() Tween(bBtn, 0.1, {BackgroundColor3 = Colors.AccentHover}) end)
                bBtn.MouseLeave:Connect(function() Tween(bBtn, 0.1, {BackgroundColor3 = Colors.Accent}) end)
                bBtn.MouseButton1Click:Connect(callback)
                
                return {}
            end
            
            -- Label
            function Section:Label(opts)
                opts = opts or {}
                local text = opts.Name or ""
                
                local lbl = Create("TextLabel", {
                    Size = UDim2.new(1, 0, 0, 16),
                    BackgroundTransparency = 1,
                    Text = text,
                    TextColor3 = Colors.TextDark,
                    TextSize = 10,
                    Font = Enum.Font.Gotham,
                    TextXAlignment = Enum.TextXAlignment.Left,
                    TextWrapped = true,
                    AutomaticSize = Enum.AutomaticSize.Y,
                    Parent = sContent
                })
                
                return {Set = function(_, t) lbl.Text = t end}
            end
            
            -- Colorpicker
            function Section:Colorpicker(opts)
                opts = opts or {}
                local cName = opts.Name or "Color"
                local flag = opts.Flag or cName
                local defaultColor = opts.Color or Color3.fromRGB(255, 255, 255)
                local defaultAlpha = opts.Alpha or 1
                local callback = opts.Callback or function() end
                
                AzrixLibrary.Flags[flag] = {Color = defaultColor, Alpha = defaultAlpha}
                
                local cFrame = Create("Frame", {
                    Size = UDim2.new(1, 0, 0, 24),
                    BackgroundTransparency = 1,
                    Parent = sContent
                })
                
                Create("TextLabel", {
                    Size = UDim2.new(1, -30, 1, 0),
                    BackgroundTransparency = 1,
                    Text = cName,
                    TextColor3 = Colors.Text,
                    TextSize = 11,
                    Font = Enum.Font.Gotham,
                    TextXAlignment = Enum.TextXAlignment.Left,
                    Parent = cFrame
                })
                
                local cBtn = Create("TextButton", {
                    Size = UDim2.new(0, 24, 0, 16),
                    Position = UDim2.new(1, -24, 0.5, -8),
                    BackgroundColor3 = defaultColor,
                    BorderSizePixel = 0,
                    Text = "",
                    Parent = cFrame
                })
                Corner(cBtn, 4)
                Stroke(cBtn, Colors.Border)
                
                local colors = {
                    Color3.fromRGB(255, 50, 50), Color3.fromRGB(255, 150, 50), Color3.fromRGB(255, 255, 50),
                    Color3.fromRGB(50, 255, 50), Color3.fromRGB(50, 255, 255), Color3.fromRGB(50, 150, 255),
                    Color3.fromRGB(50, 50, 255), Color3.fromRGB(150, 50, 255), Color3.fromRGB(255, 50, 255),
                    Color3.fromRGB(255, 255, 255), Color3.fromRGB(90, 120, 190)
                }
                
                cBtn.MouseButton1Click:Connect(function()
                    local idx = 1
                    for i, c in ipairs(colors) do
                        if c == cBtn.BackgroundColor3 then idx = i break end
                    end
                    local next = colors[(idx % #colors) + 1]
                    cBtn.BackgroundColor3 = next
                    AzrixLibrary.Flags[flag] = {Color = next, Alpha = defaultAlpha}
                    callback(next, defaultAlpha)
                end)
                
                return {
                    Set = function(_, c, a)
                        cBtn.BackgroundColor3 = c
                        AzrixLibrary.Flags[flag] = {Color = c, Alpha = a or defaultAlpha}
                        callback(c, a or defaultAlpha)
                    end,
                    Get = function() return AzrixLibrary.Flags[flag] end
                }
            end
            
            return Section
        end
        
        table.insert(Window.Tabs, {Btn = tabBtn, Content = tabContent, Tab = Tab})
        if #Window.Tabs == 1 then SelectTab() end
        
        return Tab
    end
    
    -- Config Section
    function Window:ConfigSection(tab)
        local cfgSec = tab:Section({Name = "Configuration", Side = "Left"})
        local cfgDropdown
        
        cfgSec:Textbox({
            Name = "Config Name",
            Flag = "ConfigName",
            PlaceHolder = "config name...",
            Default = "default"
        })
        
        cfgSec:Button({
            Name = "Save Config",
            Callback = function()
                local n = AzrixLibrary.Flags.ConfigName or "default"
                if AzrixLibrary:SaveConfig(n) then
                    AzrixLibrary.Notifications:Create({Name = "Saved: " .. n, Type = "Success", Lifetime = 2})
                    local cfgs = AzrixLibrary:GetConfigs()
                    if #cfgs == 0 then cfgs = {"No configs"} end
                    if cfgDropdown then cfgDropdown.RefreshOptions(cfgs) end
                else
                    AzrixLibrary.Notifications:Create({Name = "Failed to save", Type = "Error", Lifetime = 2})
                end
            end
        })
        
        local cfgs = AzrixLibrary:GetConfigs()
        if #cfgs == 0 then cfgs = {"No configs"} end
        
        cfgDropdown = cfgSec:Dropdown({
            Name = "Select Config",
            Flag = "SelectedConfig",
            Options = cfgs
        })
        
        cfgSec:Button({
            Name = "Load Config",
            Callback = function()
                local n = AzrixLibrary.Flags.SelectedConfig
                if n and n ~= "No configs" and AzrixLibrary:LoadConfig(n) then
                    AzrixLibrary.Notifications:Create({Name = "Loaded: " .. n, Type = "Success", Lifetime = 2})
                else
                    AzrixLibrary.Notifications:Create({Name = "Failed to load", Type = "Error", Lifetime = 2})
                end
            end
        })
        
        cfgSec:Button({
            Name = "Refresh Configs",
            Callback = function()
                local cfgs = AzrixLibrary:GetConfigs()
                if #cfgs == 0 then cfgs = {"No configs"} end
                cfgDropdown.RefreshOptions(cfgs)
                AzrixLibrary.Notifications:Create({Name = "Refreshed", Lifetime = 2})
            end
        })
        
        cfgSec:Button({
            Name = "Delete Config",
            Callback = function()
                local n = AzrixLibrary.Flags.SelectedConfig
                if n and n ~= "No configs" and AzrixLibrary:DeleteConfig(n) then
                    AzrixLibrary.Notifications:Create({Name = "Deleted: " .. n, Type = "Success", Lifetime = 2})
                    local cfgs = AzrixLibrary:GetConfigs()
                    if #cfgs == 0 then cfgs = {"No configs"} end
                    cfgDropdown.RefreshOptions(cfgs)
                end
            end
        })
    end
    
    -- Toggle Key
    local toggleConn = UserInputService.InputBegan:Connect(function(input, gpe)
        if gpe then return end
        if input.KeyCode == AzrixLibrary.ToggleKey then
            AzrixLibrary.Visible = not AzrixLibrary.Visible
            main.Visible = AzrixLibrary.Visible
        end
    end)
    table.insert(AzrixLibrary.Connections, toggleConn)
    
    -- Unload
    function AzrixLibrary:Unload()
        for _, c in pairs(self.Connections) do
            if c and c.Disconnect then c:Disconnect() end
        end
        gui:Destroy()
    end
    
    Window.Gui = gui
    Window.Main = main
    table.insert(AzrixLibrary.Windows, Window)
    
    return Window
end

return AzrixLibrary
